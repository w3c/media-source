<!DOCTYPE html><html lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="ReSpec 25.1.0"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><style>/* --- ISSUES/NOTES --- */
.issue-label {
    text-transform: initial;
}

.warning > p:first-child { margin-top: 0 }
.warning {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
span.warning { padding: .1em .5em .15em; }

.issue.closed span.issue-number {
    text-decoration: line-through;
}

.warning {
    border-color: #f11;
    border-width: .2em;
    border-style: solid;
    background: #fbe9e9;
}

.warning-title:before{
    content: "⚠"; /*U+26A0 WARNING SIGN*/
    font-size: 1.3em;
    float: left;
    padding-right: .3em;
    margin-top: -0.3em;
}

li.task-list-item {
    list-style: none;
}

input.task-list-item-checkbox {
    margin: 0 0.35em 0.25em -1.6em;
    vertical-align: middle;
}

.issue a.respec-gh-label {
  padding: 5px;
  margin: 0 2px 0 2px;
  font-size: 10px;
  text-transform: none;
  text-decoration: none;
  font-weight: bold;
  border-radius: 4px;
  position: relative;
  bottom: 2px;
  border: none;
  display: inline-block;
}

.issue a.respec-label-dark {
  color: #fff;
  background-color: #000;
}

.issue a.respec-label-light {
  color: #000;
  background-color: #fff;
}
</style><style>/* --- WEB IDL --- */

pre.idl {
  padding: 1em;
  position: relative;
}

@media print {
  pre.idl {
    white-space: pre-wrap;
  }
}

.idlHeader {
  display: block;
  width: 150px;
  background: #90b8de;
  color: #fff;
  font-family: sans-serif;
  font-weight: bold;
  margin: -1em 0 1em -1em;
  height: 28px;
  line-height: 28px;
}

.idlHeader a.self-link {
   color: #fff;
   margin-left: .3cm;
   text-decoration: none;
   border-bottom: none;
}

.idlID {
  font-weight: bold;
  color: #005a9c;
}

.idlType {
  color: #005a9c;
}

.idlName {
  color: #ff4500;
}

.idlName a {
  color: #ff4500;
  border-bottom: 1px dotted #ff4500;
  text-decoration: none;
}

a.idlEnumItem {
  color: #000;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
}

.idlSuperclass {
  font-style: italic;
  color: #005a9c;
}


/*.idlParam*/

.idlParamName,
.idlDefaultValue {
  font-style: italic;
}

.extAttr {
  color: #666;
}


/*.idlSectionComment*/

.idlSectionComment {
  color: gray;
}

.idlIncludes a {
  font-weight: bold;
}

.respec-button-copy-paste:focus {
  text-decoration: none;
  border-color: #51a7e8;
  outline: none;
  box-shadow: 0 0 5px rgba(81, 167, 232, 0.5);
}

.respec-button-copy-paste:focus:hover,
.respec-button-copy-paste.selected:focus {
  border-color: #51a7e8;
}

.respec-button-copy-paste:hover,
.respec-button-copy-paste:active,
.respec-button-copy-paste.zeroclipboard-is-hover,
.respec-button-copy-paste.zeroclipboard-is-active {
  text-decoration: none;
  background-color: #ddd;
  background-image: linear-gradient(#eee, #ddd);
  border-color: #ccc;
}

.respec-button-copy-paste:active,
.respec-button-copy-paste.selected,
.respec-button-copy-paste.zeroclipboard-is-active {
  background-color: #dcdcdc;
  background-image: none;
  border-color: #b5b5b5;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15)
}

.respec-button-copy-paste.selected:hover {
  background-color: #cfcfcf;
}

.respec-button-copy-paste:disabled,
.respec-button-copy-paste:disabled:hover,
.respec-button-copy-paste.disabled,
.respec-button-copy-paste.disabled:hover {
  color: rgba(102, 102, 102, 0.5);
  cursor: default;
  background-color: rgba(229, 229, 229, 0.5);
  background-image: none;
  border-color: rgba(197, 197, 197, 0.5);
  box-shadow: none;
}

@media print {
  .respec-button-copy-paste {
    visibility: hidden;
  }
}
</style><style>/* dfn popup panel that list all local references to a dfn */
dfn {
  cursor: pointer;
}

.dfn-panel {
  position: absolute;
  left: var(--left); /* set via JS */
  top: var(--top); /* set via JS */
  z-index: 35;
  height: auto;
  width: max-content;
  max-width: 300px;
  max-height: 500px;
  overflow: auto;
  padding: 0.5em 0.75em;
  font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
  background: #dddddd;
  color: black;
  border: outset 0.2em;
}

.dfn-panel * {
  margin: 0;
}

.dfn-panel > b {
  display: block;
}

.dfn-panel ul a[href] {
  color: black;
}

.dfn-panel a:not(:hover) {
  text-decoration: none !important;
  border-bottom: none !important;
}

.dfn-panel a[href]:hover {
  border-bottom-width: 1px;
}

.dfn-panel > b + b {
  margin-top: 0.25em;
}

.dfn-panel ul {
  padding: 0;
}

.dfn-panel li {
  list-style: inside;
}

.dfn-panel.docked {
  display: inline-block;
  position: fixed;
  left: 0.5em;
  top: unset;
  bottom: 2em;
  margin: 0 auto;
  /* 0.75em from padding (x2), 0.5em from left position, 0.2em border (x2) */
  max-width: calc(100vw - 0.75em * 2 - 0.5em - 0.2em * 2);
  max-height: 30vh;
}
</style>
    
    <title>Media Source Extensions™</title>
    <style id="respec-mainstyle">/*****************************************************************
 * ReSpec specific CSS
 *****************************************************************/
@keyframes pop {
  0% {
    transform: scale(1, 1);
  }
  25% {
    transform: scale(1.25, 1.25);
    opacity: 0.75;
  }
  100% {
    transform: scale(1, 1);
  }
}

/* Override code highlighter background */
.hljs {
  background: transparent !important;
}

/* --- INLINES --- */
h1 abbr,
h2 abbr,
h3 abbr,
h4 abbr,
h5 abbr,
h6 abbr,
a abbr {
  border: none;
}

dfn {
  font-weight: bold;
}

a.internalDFN {
  color: inherit;
  border-bottom: 1px solid #99c;
  text-decoration: none;
}

a.externalDFN {
  color: inherit;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
}

a.bibref {
  text-decoration: none;
}

.respec-offending-element:target {
  animation: pop 0.25s ease-in-out 0s 1;
}

.respec-offending-element,
a[href].respec-offending-element {
  text-decoration: red wavy underline;
}
@supports not (text-decoration: red wavy underline) {
  .respec-offending-element:not(pre) {
    display: inline-block;
  }
  .respec-offending-element {
    /* Red squiggly line */
    background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=)
      bottom repeat-x;
  }
}

#references :target {
  background: #eaf3ff;
  animation: pop 0.4s ease-in-out 0s 1;
}

cite .bibref {
  font-style: normal;
}

code {
  color: #c83500;
}

th code {
  color: inherit;
}

a[href].orcid {
    padding-left: 4px;
    padding-right: 4px;
}

a[href].orcid > svg {
    margin-bottom: -2px;
}

/* --- TOC --- */

.toc a,
.tof a {
  text-decoration: none;
}

a .secno,
a .figno {
  color: #000;
}

ul.tof,
ol.tof {
  list-style: none outside none;
}

.caption {
  margin-top: 0.5em;
  font-style: italic;
}

/* --- TABLE --- */

table.simple {
  border-spacing: 0;
  border-collapse: collapse;
  border-bottom: 3px solid #005a9c;
}

.simple th {
  background: #005a9c;
  color: #fff;
  padding: 3px 5px;
  text-align: left;
}

.simple th a {
  color: #fff;
  padding: 3px 5px;
  text-align: left;
}

.simple th[scope="row"] {
  background: inherit;
  color: inherit;
  border-top: 1px solid #ddd;
}

.simple td {
  padding: 3px 10px;
  border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
  background: #f0f6ff;
}

/* --- DL --- */

.section dd > p:first-child {
  margin-top: 0;
}

.section dd > p:last-child {
  margin-bottom: 0;
}

.section dd {
  margin-bottom: 1em;
}

.section dl.attrs dd,
.section dl.eldef dd {
  margin-bottom: 0;
}

#issue-summary > ul,
.respec-dfn-list {
  column-count: 2;
}

#issue-summary li,
.respec-dfn-list li {
  list-style: none;
}

details.respec-tests-details {
  margin-left: 1em;
  display: inline-block;
  vertical-align: top;
}

details.respec-tests-details > * {
  padding-right: 2em;
}

details.respec-tests-details[open] {
  z-index: 999999;
  position: absolute;
  border: thin solid #cad3e2;
  border-radius: 0.3em;
  background-color: white;
  padding-bottom: 0.5em;
}

details.respec-tests-details[open] > summary {
  border-bottom: thin solid #cad3e2;
  padding-left: 1em;
  margin-bottom: 1em;
  line-height: 2em;
}

details.respec-tests-details > ul {
  width: 100%;
  margin-top: -0.3em;
}

details.respec-tests-details > li {
  padding-left: 1em;
}

a[href].self-link:hover {
  opacity: 1;
  text-decoration: none;
  background-color: transparent;
}

h2,
h3,
h4,
h5,
h6 {
  position: relative;
}

aside.example .marker > a.self-link {
  color: inherit;
}

h2 > a.self-link,
h3 > a.self-link,
h4 > a.self-link,
h5 > a.self-link,
h6 > a.self-link {
  border: none;
  color: inherit;
  font-size: 83%;
  height: 2em;
  left: -1.6em;
  opacity: 0.5;
  position: absolute;
  text-align: center;
  text-decoration: none;
  top: 0;
  transition: opacity 0.2s;
  width: 2em;
}

h2 > a.self-link::before,
h3 > a.self-link::before,
h4 > a.self-link::before,
h5 > a.self-link::before,
h6 > a.self-link::before {
  content: "§";
  display: block;
}

@media (max-width: 767px) {
  dd {
    margin-left: 0;
  }

  /* Don't position self-link in headings off-screen */
  h2 > a.self-link,
  h3 > a.self-link,
  h4 > a.self-link,
  h5 > a.self-link,
  h6 > a.self-link {
    left: auto;
    top: auto;
  }
}

@media print {
  .removeOnSave {
    display: none;
  }
}
</style>
    
    
    

    
    

    <link rel="stylesheet" href="mse.css">
  <link rel="canonical" href="https://www.w3.org/TR/media-source/"><style>/*
Atom One Light by Daniel Gamage
Original One Light Syntax theme from https://github.com/atom/one-light-syntax
base:    #fafafa
mono-1:  #383a42
mono-2:  #686b77
mono-3:  #a0a1a7
hue-1:   #0184bb
hue-2:   #4078f2
hue-3:   #a626a4
hue-4:   #50a14f
hue-5:   #e45649
hue-5-2: #c91243
hue-6:   #986801
hue-6-2: #c18401
*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #383a42;
  background: #fafafa;
}

.hljs-comment,
.hljs-quote {
  color: #a0a1a7;
  font-style: italic;
}

.hljs-doctag,
.hljs-keyword,
.hljs-formula {
  color: #a626a4;
}

.hljs-section,
.hljs-name,
.hljs-selector-tag,
.hljs-deletion,
.hljs-subst {
  color: #e45649;
}

.hljs-literal {
  color: #0184bb;
}

.hljs-string,
.hljs-regexp,
.hljs-addition,
.hljs-attribute,
.hljs-meta-string {
  color: #50a14f;
}

.hljs-built_in,
.hljs-class .hljs-title {
  color: #c18401;
}

.hljs-attr,
.hljs-variable,
.hljs-template-variable,
.hljs-type,
.hljs-selector-class,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-number {
  color: #986801;
}

.hljs-symbol,
.hljs-bullet,
.hljs-link,
.hljs-meta,
.hljs-selector-id,
.hljs-title {
  color: #4078f2;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

.hljs-link {
  text-decoration: underline;
}
</style><style>var {
  position: relative;
  cursor: pointer;
}

var[data-type]::before,
var[data-type]::after {
  position: absolute;
  left: 50%;
  top: -6px;
  opacity: 0;
  transition: opacity 0.4s;
  pointer-events: none;
}

/* the triangle or arrow or caret or whatever */
var[data-type]::before {
  content: "";
  transform: translateX(-50%);
  border-width: 4px 6px 0 6px;
  border-style: solid;
  border-color: transparent;
  border-top-color: #000;
}

/* actual text */
var[data-type]::after {
  content: attr(data-type);
  transform: translateX(-50%) translateY(-100%);
  background: #000;
  text-align: center;
  /* additional styling */
  font-family: "Dank Mono", "Fira Code", monospace;
  font-style: normal;
  padding: 6px;
  border-radius: 3px;
  color: #daca88;
  text-indent: 0;
  font-weight: normal;
}

var[data-type]:hover::after,
var[data-type]:hover::before {
  opacity: 1;
}
</style><script id="initialUserConfig" type="application/json">{
  "specStatus": "ED",
  "useExperimentalStyles": true,
  "shortName": "media-source",
  "edDraftURI": "https://w3c.github.io/media-source/",
  "previousMaturity": "PR",
  "previousPublishDate": "2016-10-04",
  "errata": "https://w3c.github.io/media-source/mse-1-errata.html",
  "editors": [
    {
      "name": "Matthew Wolenetz",
      "url": "",
      "company": "Google Inc.",
      "companyURL": "http://www.google.com/"
    },
    {
      "name": "Mark Watson",
      "url": "",
      "company": "Netflix Inc.",
      "companyURL": "http://www.netflix.com/"
    }
  ],
  "formerEditors": [
    {
      "name": "Jerry Smith",
      "note": "Until September 2017",
      "url": "",
      "company": "Microsoft Corporation",
      "companyURL": "http://www.microsoft.com/"
    },
    {
      "name": "Aaron Colwell",
      "note": "Until April 2015",
      "url": "",
      "company": "Google Inc.",
      "companyURL": "http://www.google.com/"
    },
    {
      "name": "Adrian Bateman",
      "note": "Until April 2015",
      "url": "",
      "company": "Microsoft Corporation",
      "companyURL": "http://www.microsoft.com/"
    }
  ],
  "mseDefGroupName": "media-source",
  "mseContributors": [
    "Alex Giladi",
    "Bob Lund",
    "Chris Poole",
    "Cyril Concolato",
    "David Dorwin",
    "David Singer",
    "Duncan Rowden",
    "Frank Galligan",
    "Glenn Adams",
    "Jer Noble",
    "Joe Steele",
    "John Simmons",
    "Kevin Streeter",
    "Mark Vickers",
    "Matt Ward",
    "Matthew Gregan",
    "Michael Thornburgh",
    "Philip Jägenstedt",
    "Pierre Lemieux",
    "Ralph Giles",
    "Steven Robertson",
    "Tatsuya Igarashi"
  ],
  "wg": "HTML Media Extensions Working Group",
  "wgURI": "https://www.w3.org/html/wg/",
  "wgPublicList": "public-html-media",
  "license": "w3c-software-doc",
  "wgPatentURI": "https://www.w3.org/2004/01/pp-impl/40318/status",
  "lcEnd": "2016-08-10",
  "prEnd": "2016-11-01",
  "implementationReportURI": "http://tidoust.github.io/media-source-testcoverage/",
  "noIDLIn": true,
  "scheme": "https",
  "otherLinks": [
    {
      "key": "Repository",
      "data": [
        {
          "value": "We are on GitHub",
          "href": "https://github.com/w3c/media-source/"
        },
        {
          "value": "File a bug",
          "href": "https://github.com/w3c/media-source/issues"
        },
        {
          "value": "Commit history",
          "href": "https://github.com/w3c/media-source/commits/gh-pages/media-source-respec.html"
        }
      ]
    },
    {
      "key": "Mailing list",
      "data": [
        {
          "value": "public-html-media@w3.org",
          "href": "https://lists.w3.org/Archives/Public/public-html-media/"
        }
      ]
    },
    {
      "key": "Implementation",
      "data": [
        {
          "value": "Can I use Media Source Extensions?",
          "href": "http://caniuse.com/#feat=mediasource"
        },
        {
          "value": "Test Suite",
          "href": "http://w3c-test.org/media-source/"
        },
        {
          "value": "Test Suite repository",
          "href": "https://github.com/w3c/web-platform-tests/tree/master/media-source"
        }
      ]
    }
  ],
  "preProcess": [
    null
  ],
  "postProcess": [
    null
  ],
  "localBiblio": {
    "INBANDTRACKS": {
      "title": "Sourcing In-band Media Resource Tracks from Media Containers into HTML",
      "href": "https://dev.w3.org/html5/html-sourcing-inband-tracks/",
      "authors": [
        "Bob Lund",
        "Silvia Pfeiffer"
      ],
      "publisher": "W3C",
      "id": "inbandtracks"
    },
    "MEDIA-PLAYBACK-QUALITY": {
      "title": "Media Playback Quality",
      "href": "https://wicg.github.io/media-playback-quality/",
      "authors": [
        "Mounir Lamouri"
      ],
      "publisher": "W3C",
      "id": "media-playback-quality"
    },
    "MSE-REGISTRY": {
      "title": "Media Source Extensions™ Byte Stream Format Registry",
      "href": "byte-stream-format-registry.html",
      "authors": [
        "Matthew Wolenetz",
        "Jerry Smith",
        "Aaron Colwell"
      ],
      "publisher": "W3C",
      "id": "mse-registry"
    },
    "MSE-FORMAT-WEBM": {
      "title": "WebM Byte Stream Format",
      "href": "webm-byte-stream-format.html",
      "authors": [
        "Matthew Wolenetz",
        "Jerry Smith",
        "Aaron Colwell"
      ],
      "publisher": "W3C"
    },
    "MSE-FORMAT-ISOBMFF": {
      "title": "ISO BMFF Byte Stream Format",
      "href": "isobmff-byte-stream-format.html",
      "authors": [
        "Matthew Wolenetz",
        "Jerry Smith",
        "Mark Watson",
        "Aaron Colwell",
        "Adrian Bateman"
      ],
      "publisher": "W3C"
    },
    "MSE-FORMAT-MP2T": {
      "title": "MPEG-2 Transport Streams Byte Stream Format",
      "href": "mp2t-byte-stream-format.html",
      "authors": [
        "Matthew Wolenetz",
        "Jerry Smith",
        "Mark Watson",
        "Aaron Colwell",
        "Adrian Bateman"
      ],
      "publisher": "W3C"
    },
    "MSE-FORMAT-MPEG-AUDIO": {
      "title": "MPEG Audio Byte Stream Format",
      "href": "mpeg-audio-byte-stream-format.html",
      "authors": [
        "Dale Curtis",
        "Matthew Wolenetz",
        "Aaron Colwell"
      ],
      "publisher": "W3C"
    }
  },
  "publishISODate": "2020-01-27T00:00:00.000Z",
  "generatedSubtitle": "Editor's Draft 27 January 2020"
}</script><link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED"></head>
  <body class="h-entry" data-cite="WebIDL"><div class="head">
      <a class="logo" href="https://www.w3.org/"><img alt="W3C" width="72" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C"></a> <h1 id="title" class="title p-name">Media Source Extensions™</h1>
      
      <h2>
        W3C Editor's Draft
        <time class="dt-published" datetime="2020-01-27">27 January 2020</time>
      </h2>
      <dl>
        <dt>This version:</dt><dd>
                <a class="u-url" href="https://w3c.github.io/media-source/">https://w3c.github.io/media-source/</a>
              </dd><dt>Latest published version:</dt><dd>
                <a href="https://www.w3.org/TR/media-source/">https://www.w3.org/TR/media-source/</a>
              </dd>
        <dt>Latest editor's draft:</dt><dd><a href="https://w3c.github.io/media-source/">https://w3c.github.io/media-source/</a></dd>
        
        <dt>Implementation report:</dt><dd>
                <a href="http://tidoust.github.io/media-source-testcoverage/">http://tidoust.github.io/media-source-testcoverage/</a>
              </dd>
        
        
        
        <dt>Editors:</dt>
        <dd class="p-author h-card vcard"><span class="p-name fn">Matthew Wolenetz</span>
            (<a class="p-org org h-org h-card" href="http://www.google.com/">Google Inc.</a>)
          </dd><dd class="p-author h-card vcard"><span class="p-name fn">Mark Watson</span>
            (<a class="p-org org h-org h-card" href="http://www.netflix.com/">Netflix Inc.</a>)
          </dd>
        <dt>
                Former editors:
              </dt><dd class="p-author h-card vcard"><span class="p-name fn">Jerry Smith</span>
            (<a class="p-org org h-org h-card" href="http://www.microsoft.com/">Microsoft Corporation</a>)
           (Until September 2017)</dd><dd class="p-author h-card vcard"><span class="p-name fn">Aaron Colwell</span>
            (<a class="p-org org h-org h-card" href="http://www.google.com/">Google Inc.</a>)
           (Until April 2015)</dd><dd class="p-author h-card vcard"><span class="p-name fn">Adrian Bateman</span>
            (<a class="p-org org h-org h-card" href="http://www.microsoft.com/">Microsoft Corporation</a>)
           (Until April 2015)</dd>
        
        <dt>Repository:</dt><dd>
      <a href="https://github.com/w3c/media-source/">We are on GitHub</a>
    </dd><dd>
      <a href="https://github.com/w3c/media-source/issues">File a bug</a>
    </dd><dd>
      <a href="https://github.com/w3c/media-source/commits/gh-pages/media-source-respec.html">Commit history</a>
    </dd><dt>Mailing list:</dt><dd>
      <a href="https://lists.w3.org/Archives/Public/public-html-media/">public-html-media@w3.org</a>
    </dd><dt>Implementation:</dt><dd>
      <a href="http://caniuse.com/#feat=mediasource">Can I use Media Source Extensions?</a>
    </dd><dd>
      <a href="http://w3c-test.org/media-source/">Test Suite</a>
    </dd><dd>
      <a href="https://github.com/w3c/web-platform-tests/tree/master/media-source">Test Suite repository</a>
    </dd>
      </dl>
      <p>
              Please check the
              <a href="https://w3c.github.io/media-source/mse-1-errata.html"><strong>errata</strong></a> for any
              errors or issues reported since publication.
            </p>
      
      
      <p class="copyright">
      <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
      ©
      2020
      
      <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
      <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>,
      <a href="https://ev.buaa.edu.cn/">Beihang</a>). 
      W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
      <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a rel="license" href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">permissive document license</a> rules
      apply.
    </p>
      <hr title="Separator for header">
    </div>

    <section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at https://www.w3.org/TR/.</em></p>
        <p>The working group maintains <a href="https://github.com/w3c/media-source/issues">a list of all bug reports</a>. New features for this specification are expected to be incubated in the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.</p>
        <p>One editorial issue (<a href="https://github.com/w3c/media-source/issues/168">removing the exposure of <code>createObjectURL(mediaSource)</code> in workers</a>) was addressed since the previous publication. For the list of changes done since the previous version, see the <a href="https://github.com/w3c/media-source/commits/gh-pages">commits</a>.</p>
        <p>
          By publishing this Recommendation, <abbr title="World Wide Web Consortium">W3C</abbr> expects the functionality specified in this Recommendation will not be affected by changes to File API. The Working Group will continue to track these specifications.
        </p>

    <p>
      This document was published by the <a href="https://www.w3.org/html/wg/">HTML Media Extensions Working Group</a> as an
      Editor's Draft.
      
    </p><p>
      
      Comments regarding this document are welcome.
            Please send them to
            <a href="mailto:public-html-media@w3.org">public-html-media@w3.org</a>
            (<a href="https://lists.w3.org/Archives/Public/public-html-media/">archives</a>).
          
    </p><p>
      Please see the Working Group's
      <a href="http://tidoust.github.io/media-source-testcoverage/">implementation report</a>.
    </p><p>
      Publication as an Editor's Draft does not imply endorsement by the
      <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may be updated, replaced or
      obsoleted by other documents at any time. It is inappropriate to cite this
      document as other than work in progress.
    </p><p>
      
        This document was produced by a group
        operating under the
        <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
       
      
                  <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                  <a rel="disclosure" href="https://www.w3.org/2004/01/pp-impl/40318/status">public list of any patent disclosures</a>
            made in connection with the deliverables of
            the group; that page also includes
            instructions for disclosing a patent. An individual who has actual
            knowledge of a patent which the individual believes contains
            <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a>
            must disclose the information in accordance with
            <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
          
      
    </p><p>
                  This document is governed by the
                  <a id="w3c_process_revision" href="https://www.w3.org/2019/Process-20190301/">1 March 2019 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#goals"><bdi class="secno">1.1 </bdi>Goals</a></li><li class="tocline"><a class="tocxref" href="#definitions"><bdi class="secno">1.2 </bdi>Definitions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#mediasource"><bdi class="secno">2. </bdi>MediaSource Object</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#attributes"><bdi class="secno">2.1 </bdi>Attributes</a></li><li class="tocline"><a class="tocxref" href="#methods"><bdi class="secno">2.2 </bdi>Methods</a></li><li class="tocline"><a class="tocxref" href="#mediasource-events"><bdi class="secno">2.3 </bdi>Event Summary</a></li><li class="tocline"><a class="tocxref" href="#mediasource-algorithms"><bdi class="secno">2.4 </bdi>Algorithms</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#mediasource-attach"><bdi class="secno">2.4.1 </bdi>Attaching to a media element</a></li><li class="tocline"><a class="tocxref" href="#mediasource-detach"><bdi class="secno">2.4.2 </bdi>Detaching from a media element</a></li><li class="tocline"><a class="tocxref" href="#mediasource-seeking"><bdi class="secno">2.4.3 </bdi>Seeking</a></li><li class="tocline"><a class="tocxref" href="#buffer-monitoring"><bdi class="secno">2.4.4 </bdi>SourceBuffer Monitoring</a></li><li class="tocline"><a class="tocxref" href="#active-source-buffer-changes"><bdi class="secno">2.4.5 </bdi>Changes to selected/enabled track state</a></li><li class="tocline"><a class="tocxref" href="#duration-change-algorithm"><bdi class="secno">2.4.6 </bdi>Duration change</a></li><li class="tocline"><a class="tocxref" href="#end-of-stream-algorithm"><bdi class="secno">2.4.7 </bdi>End of stream algorithm</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#sourcebuffer"><bdi class="secno">3. </bdi>SourceBuffer Object</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#attributes-0"><bdi class="secno">3.1 </bdi>Attributes</a></li><li class="tocline"><a class="tocxref" href="#methods-0"><bdi class="secno">3.2 </bdi>Methods</a></li><li class="tocline"><a class="tocxref" href="#track-buffers"><bdi class="secno">3.3 </bdi>Track Buffers</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-events"><bdi class="secno">3.4 </bdi>Event Summary</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-algorithms"><bdi class="secno">3.5 </bdi>Algorithms</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#sourcebuffer-segment-parser-loop"><bdi class="secno">3.5.1 </bdi>Segment Parser Loop</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-reset-parser-state"><bdi class="secno">3.5.2 </bdi>Reset Parser State</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-append-error"><bdi class="secno">3.5.3 </bdi>Append Error Algorithm</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-prepare-append"><bdi class="secno">3.5.4 </bdi>Prepare Append Algorithm</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-buffer-append"><bdi class="secno">3.5.5 </bdi>Buffer Append Algorithm</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-range-removal"><bdi class="secno">3.5.6 </bdi>Range Removal</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-init-segment-received"><bdi class="secno">3.5.7 </bdi>Initialization Segment Received</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-coded-frame-processing"><bdi class="secno">3.5.8 </bdi>Coded Frame Processing</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-coded-frame-removal"><bdi class="secno">3.5.9 </bdi>Coded Frame Removal Algorithm</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-coded-frame-eviction"><bdi class="secno">3.5.10 </bdi>Coded Frame Eviction Algorithm</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-audio-splice-frame-algorithm"><bdi class="secno">3.5.11 </bdi>Audio Splice Frame Algorithm</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-audio-splice-rendering-algorithm"><bdi class="secno">3.5.12 </bdi>Audio Splice Rendering Algorithm</a></li><li class="tocline"><a class="tocxref" href="#sourcebuffer-text-splice-frame-algorithm"><bdi class="secno">3.5.13 </bdi>Text Splice Frame Algorithm</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#sourcebufferlist"><bdi class="secno">4. </bdi>SourceBufferList Object</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#attributes-1"><bdi class="secno">4.1 </bdi>Attributes</a></li><li class="tocline"><a class="tocxref" href="#methods-1"><bdi class="secno">4.2 </bdi>Methods</a></li><li class="tocline"><a class="tocxref" href="#sourcebufferlist-events"><bdi class="secno">4.3 </bdi>Event Summary</a></li></ol></li><li class="tocline"><a class="tocxref" href="#url"><bdi class="secno">5. </bdi>URL Object Extensions</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#methods-2"><bdi class="secno">5.1 </bdi>Methods</a></li></ol></li><li class="tocline"><a class="tocxref" href="#htmlmediaelement-extensions"><bdi class="secno">6. </bdi>HTMLMediaElement Extensions</a></li><li class="tocline"><a class="tocxref" href="#audio-track-extensions"><bdi class="secno">7. </bdi>AudioTrack Extensions</a></li><li class="tocline"><a class="tocxref" href="#video-track-extensions"><bdi class="secno">8. </bdi>VideoTrack Extensions</a></li><li class="tocline"><a class="tocxref" href="#text-track-extensions"><bdi class="secno">9. </bdi>TextTrack Extensions</a></li><li class="tocline"><a class="tocxref" href="#byte-stream-formats"><bdi class="secno">10. </bdi>Byte Stream Formats</a></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">11. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#examples"><bdi class="secno">12. </bdi>Examples</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">13. </bdi>Acknowledgments</a></li><li class="tocline"><a class="tocxref" href="#VideoPlaybackQuality"><bdi class="secno">A. </bdi>VideoPlaybackQuality</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1 </bdi>Normative references</a></li><li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">B.2 </bdi>Informative references</a></li></ol></li></ol></nav>

    <section id="abstract" class="introductory"><h2>Abstract</h2>
      This specification extends <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#htmlmediaelement-htmlmediaelement">HTMLMediaElement</a></code> [<cite class="respec-offending-element" title="Normative references in informative sections are not allowed. Remove '!' from the start of the reference `[[!HTML51]]`" id="respec-offender-normative-references-in-informative-sections-are-not-allowed-remove-from-the-start-of-the-reference-html51"><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] to allow
      JavaScript to generate media streams for playback.
      Allowing JavaScript to generate streams facilitates a variety of use
      cases like adaptive streaming and time shifting live streams.
    </section>

    <section id="introduction" class="informative">
      <h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction<a class="self-link" aria-label="§" href="#introduction"></a></h2><p><em>This section is non-normative.</em></p>
      <p>This specification allows JavaScript to dynamically construct media streams for &lt;audio&gt; and &lt;video&gt;. It defines a MediaSource object that can serve as a source of media data for an HTMLMediaElement. MediaSource objects have one or more <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects.  Applications append data segments to the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects, and can adapt the quality of appended data based on system performance and other factors. Data from the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects is managed as track buffers for audio, video and text data that is decoded and played. Byte stream specifications used with these extensions are available in the byte stream format registry [<cite><a class="bibref" data-link-type="biblio" href="#bib-mse-registry" title="Media Source Extensions™ Byte Stream Format Registry">MSE-REGISTRY</a></cite>].</p>
      <img src="pipeline_model.svg" alt="Media Source Pipeline Model Diagram" longdesc="pipeline_model_description.html#pipelinedesc" height="150" width="150">
      <section id="goals">
        <h3 id="x1-1-goals"><bdi class="secno">1.1 </bdi>Goals<a class="self-link" aria-label="§" href="#goals"></a></h3>
        <p>This specification was designed with the following goals in mind:</p>
        <ul>
          <li>Allow JavaScript to construct media streams independent of how the media is fetched.</li>
          <li>Define a splicing and buffering model that facilitates use cases like adaptive streaming, ad-insertion, time-shifting, and video editing.</li>
          <li>Minimize the need for media parsing in JavaScript.</li>
          <li>Leverage the browser cache as much as possible.</li>
          <li>Provide requirements for byte stream format specifications.</li>
          <li>Not require support for any particular media format or codec.</li>
        </ul>
        <p>This specification defines:</p>
        <ul>
          <li>Normative behavior for user agents to enable interoperability between user agents and web applications when processing media data.</li>
          <li>Normative requirements to enable other specifications to define media formats to be used within this specification.</li>
        </ul>
      </section>

      <section id="definitions">
        <h3 id="x1-2-definitions"><bdi class="secno">1.2 </bdi>Definitions<a class="self-link" aria-label="§" href="#definitions"></a></h3>

        <dl>
          <dt id="active-track-buffers">Active Track Buffers</dt>
          <dd><p>The <a href="#track-buffer">track buffers</a> that provide <a href="#coded-frame">coded frames</a> for the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-enabled">enabled</a></code>
              <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-audiotracks">audioTracks</a></code>, the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-selected">selected</a></code> <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-videotracks">videoTracks</a></code>, and the
              <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-showing">"showing"</a></code> or <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-hidden">"hidden"</a></code> <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-texttracks">textTracks</a></code>. All these tracks are associated with
            <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in the <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code> list.</p>
          </dd>

          <dt id="append-window">Append Window</dt>
          <dd><p>A <a href="#presentation-timestamp">presentation timestamp</a> range used to filter out <a href="#coded-frame">coded frames</a> while appending. The append window represents a single
            continuous time range with a single start time and end time. Coded frames with <a href="#presentation-timestamp">presentation timestamp</a> within this range are allowed to be appended
            to the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> while coded frames outside this range are filtered out. The append window start and end times are controlled by
            the <code><a href="#dom-sourcebuffer-appendwindowstart">appendWindowStart</a></code> and <code><a href="#dom-sourcebuffer-appendwindowend">appendWindowEnd</a></code> attributes respectively.</p></dd>

          <dt id="coded-frame">Coded Frame</dt>
          <dd><p>A unit of media data that has a <a href="#presentation-timestamp">presentation timestamp</a>, a <a href="#decode-timestamp">decode timestamp</a>, and a <a href="#coded-frame-duration">coded frame duration</a>.</p></dd>

          <dt id="coded-frame-duration">Coded Frame Duration</dt>
          <dd>
            <p>The duration of a <a href="#coded-frame">coded frame</a>. For video and text, the duration indicates how long the video frame or text <em class="rfc2119" title="SHOULD">SHOULD</em> be displayed. For audio, the duration represents the sum of all the samples contained within the coded frame. For example, if an audio frame contained 441 samples @44100Hz the frame duration would be 10 milliseconds.</p>
          </dd>

          <dt id="coded-frame-end-timestamp">Coded Frame End Timestamp</dt>
          <dd>
            <p>The sum of a <a href="#coded-frame">coded frame</a> <a href="#presentation-timestamp">presentation timestamp</a> and its
                <a href="#coded-frame-duration">coded frame duration</a>. It represents the <a href="#presentation-timestamp">presentation timestamp</a> that immediately follows the coded frame.</p>
          </dd>

          <dt id="coded-frame-group">Coded Frame Group</dt>
          <dd><p>A group of <a href="#coded-frame">coded frames</a> that are adjacent and have monotonically increasing <a href="#decode-timestamp">decode timestamps</a> without any gaps. Discontinuities detected by the
              <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a> and <code><a href="#dom-sourcebuffer-abort">abort()</a></code> calls trigger the start of a new coded frame group.</p>
          </dd>

          <dt id="decode-timestamp">Decode Timestamp</dt>
          <dd>
            <p> The decode timestamp indicates the latest time at which the frame needs to be decoded assuming instantaneous decoding and rendering of this and any dependant frames (this is equal to the <a href="#presentation-timestamp">presentation timestamp</a> of the earliest frame, in <a href="#presentation-order">presentation order</a>, that is dependant on this frame). If frames can be decoded out of <a href="#presentation-order">presentation order</a>, then the decode timestamp <em class="rfc2119" title="MUST">MUST</em> be present in or derivable from the byte stream. The user agent <em class="rfc2119" title="MUST">MUST</em> run the <a href="#sourcebuffer-append-error">append error algorithm</a> if this is not the case. If frames cannot be decoded out of  <a href="#presentation-order">presentation order</a> and a decode timestamp is not present in the byte stream, then the decode timestamp is equal to the <a href="#presentation-timestamp">presentation timestamp</a>.</p>
          </dd>

          <dt id="init-segment">Initialization Segment</dt>
          <dd>
            <p>A sequence of bytes that contain all of the initialization information required to decode a sequence of <a href="#media-segment">media segments</a>. This includes codec initialization data, <a href="#track-id">Track ID</a> mappings for multiplexed segments, and timestamp offsets (e.g., edit lists).</p>
            <div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>Note</span></div><p class="">The <a href="#byte-stream-format-specs">byte stream format specifications</a> in the byte stream format registry [<cite><a class="bibref" data-link-type="biblio" href="#bib-mse-registry" title="Media Source Extensions™ Byte Stream Format Registry">MSE-REGISTRY</a></cite>] contain format specific examples.</p></div>

          </dd><dt id="media-segment">Media Segment</dt>
          <dd>
            <p>A sequence of bytes that contain packetized &amp; timestamped media data for a portion of the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-timeline">media timeline</a>. Media segments are always associated with the most recently appended <a href="#init-segment">initialization segment</a>.</p>
            <div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="4"><span>Note</span></div><p class="">The <a href="#byte-stream-format-specs">byte stream format specifications</a> in the byte stream format registry [<cite><a class="bibref" data-link-type="biblio" href="#bib-mse-registry" title="Media Source Extensions™ Byte Stream Format Registry">MSE-REGISTRY</a></cite>] contain format specific examples.</p></div>
          </dd>

          <dt id="mediasource-object-url">MediaSource object URL</dt>
          <dd>
            <p>A MediaSource object URL is a unique <a href="https://www.w3.org/TR/FileAPI/#url">Blob URI</a> [<cite class="respec-offending-element" title="Normative references in informative sections are not allowed. Remove '!' from the start of the reference `[[!FILE-API]]`" id="respec-offender-normative-references-in-informative-sections-are-not-allowed-remove-from-the-start-of-the-reference-file-api"><a class="bibref" data-link-type="biblio" href="#bib-file-api" title="File API">FILE-API</a></cite>] created by <code><a href="#dom-url-createobjecturl">createObjectURL()</a></code>. It is used to attach a <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object to an HTMLMediaElement.</p>
            <p>These URLs are the same as a <a href="https://www.w3.org/TR/FileAPI/#url">Blob URI</a>, except that anything in the definition of that feature that refers to <a href="https://www.w3.org/TR/FileAPI/#dfn-file">File</a> and <a href="https://www.w3.org/TR/FileAPI/#dfn-Blob">Blob</a> objects is hereby extended to also apply to <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> objects.</p>
            <p>The <a href="https://www.w3.org/TR/html51/browsers.html#section-origin">origin</a> of the MediaSource object URL is the <a href="https://www.w3.org/TR/html51/webappapis.html#relevant-settings-object">relevant settings object</a> of <code>this</code> during the call to <code><a href="#dom-url-createobjecturl">createObjectURL()</a></code>.</p>
            <div class="note" role="note" id="issue-container-generatedID-1"><div role="heading" class="note-title marker" id="h-note-1" aria-level="4"><span>Note</span></div><p class="">For example, the <a href="https://www.w3.org/TR/html51/browsers.html#section-origin">origin</a> of the MediaSource object URL affects the way that the media element is <a href="https://www.w3.org/TR/html51/semantics-scripting.html#security-with-canvas-elements">consumed by canvas</a>.</p></div>
          </dd>

          <dt id="parent-media-source">Parent Media Source</dt>
          <dd><p>The parent media source of a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object is the <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object that created it.</p></dd>

          <dt id="presentation-start-time">Presentation Start Time</dt>
          <dd><p>The presentation start time is the earliest time point in the presentation and specifies the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#initial-playback-position">initial playback position</a> and <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#earliest-possible-position">earliest possible position</a>. All presentations created using this specification have a presentation start time of 0.</p>

          <div class="note" role="note" id="issue-container-generatedID-2"><div role="heading" class="note-title marker" id="h-note-2" aria-level="4"><span>Note</span></div><p class="">For the purposes of determining if <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> contains a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> that includes the current playback position, implementations <em class="rfc2119" title="MAY">MAY</em> choose to allow a current playback position at or after <a href="#presentation-start-time">presentation start time</a> and before the first <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> to play the first <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> if that <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> starts within a reasonably short time, like 1 second, after <a href="#presentation-start-time">presentation start time</a>. This allowance accommodates the reality that muxed streams commonly do not begin all tracks precisely at <a href="#presentation-start-time">presentation start time</a>. Implementations <em class="rfc2119" title="MUST">MUST</em> report the actual buffered range, regardless of this allowance.</p></div>
          </dd>
          <dt id="presentation-interval">Presentation Interval</dt>
          <dd>
            <p>The presentation interval of a <a href="#coded-frame">coded frame</a> is the time interval from its <a href="#presentation-timestamp">presentation timestamp</a> to the <a href="#presentation-timestamp">presentation timestamp</a> plus the <a href="#coded-frame-duration">coded frame's duration</a>. For example, if a coded frame has a presentation timestamp of 10 seconds and a <a href="#coded-frame-duration">coded frame duration</a> of 100 milliseconds, then the presentation interval would be [10-10.1). Note that the start of the range is inclusive, but the end of the range is exclusive.</p>
          </dd>

          <dt id="presentation-order">Presentation Order</dt>
          <dd>
            <p>The order that <a href="#coded-frame">coded frames</a> are rendered in the presentation. The presentation order is achieved by ordering <a href="#coded-frame">coded frames</a> in monotonically increasing order by their <a href="#presentation-timestamp">presentation timestamps</a>.</p>
          </dd>

          <dt id="presentation-timestamp">Presentation Timestamp</dt>
          <dd>
             <p>A reference to a specific time in the presentation. The presentation timestamp in a <a href="#coded-frame">coded frame</a> indicates when the frame <em class="rfc2119" title="SHOULD">SHOULD</em> be rendered.</p>
          </dd>

          <dt id="random-access-point">Random Access Point</dt>
          <dd><p>A position in a <a href="#media-segment">media segment</a> where decoding and continuous playback can begin without relying on any previous data in the segment. For video this tends to be the location of I-frames. In the case of audio, most audio frames can be treated as a random access point. Since video tracks tend to have a more sparse distribution of random access points, the location of these points are usually considered the random access points for multiplexed streams.</p></dd>

          <dt id="sourcebuffer-byte-stream-format-spec">SourceBuffer byte stream format specification</dt>
          <dd><p>The specific <a href="#byte-stream-format-specs">byte stream format specification</a> that describes the format of the byte stream accepted by a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> instance. The
              <a href="#byte-stream-format-specs">byte stream format specification</a>, for a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object, is selected based on the <var>type</var> passed to the
              <code><a href="#dom-mediasource-addsourcebuffer">addSourceBuffer()</a></code> call that created the object.</p></dd>

          <dt id="sourcebuffer-configuration">SourceBuffer configuration</dt>
          <dd><p>A specific set of tracks distributed across one or more <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>
              objects owned by a single <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> instance.</p>
            <p>Implementations <em class="rfc2119" title="MUST">MUST</em> support at least 1 <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object with the following
            configurations:</p>
            <ul>
              <li>A single SourceBuffer with 1 audio track and/or 1 video track.</li>
              <li>Two SourceBuffers with one handling a single audio track and the other handling a single video track.</li>
            </ul>
            <p>MediaSource objects <em class="rfc2119" title="MUST">MUST</em> support each of the configurations above, but they are only
              required to support one configuration at a time. Supporting multiple configurations at once
              or additional configurations is a quality of implementation issue.</p>
          </dd>

          <dt id="track-description">Track Description</dt>
          <dd><p>A byte stream format specific structure that provides the <a href="#track-id">Track ID</a>, codec configuration, and other metadata for a single track. Each track description inside a single <a href="#init-segment">initialization segment</a> has a unique <a href="#track-id">Track ID</a>. The user agent <em class="rfc2119" title="MUST">MUST</em> run the <a href="#sourcebuffer-append-error">append error algorithm</a> if the <a href="#track-id">Track ID</a> is not unique within the <a href="#init-segment">initialization segment</a>.</p></dd>

          <dt id="track-id">Track ID</dt>
          <dd><p>A Track ID is a byte stream format specific identifier that marks sections of the byte stream as being part of a specific track. The Track ID in a <a href="#track-description">track description</a> identifies which sections of a <a href="#media-segment">media segment</a> belong to that track.</p></dd>

        </dl>
      </section>
    </section>

    <section id="mediasource">
      <h2 id="x2-mediasource-object"><bdi class="secno">2. </bdi>MediaSource Object<a class="self-link" aria-label="§" href="#mediasource"></a></h2>
      <p>The MediaSource object represents a source of media data for an HTMLMediaElement. It keeps track of the <code><a href="#dom-readystate">readyState</a></code> for this source as well as a list of <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects that can be used to add media data to the presentation. MediaSource objects are created by the web application and then attached to an HTMLMediaElement. The application uses the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> to add media data to this source. The HTMLMediaElement fetches this media data from the <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object when it is needed during playback.</p>

      <p>Each <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object has a <dfn id="live-seekable-range" data-dfn-type="dfn">live seekable range</dfn> variable that stores a <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#normalized-timeranges-object">normalized TimeRanges object</a>.  This variable is initialized to an empty <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code> object when the <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object is created, is maintained by <code><a href="#dom-mediasource-setliveseekablerange">setLiveSeekableRange()</a></code> and <code><a href="#dom-mediasource-clearliveseekablerange">clearLiveSeekableRange()</a></code>, and is used in <a href="#htmlmediaelement-extensions">HTMLMediaElement Extensions</a> to modify <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-seekable">HTMLMediaElement.seekable</a></code> behavior.</p>

      <div><pre class="idl def" id="webidl-x1246068066"><span class="idlHeader"><a class="self-link" href="#webidl-x1246068066">WebIDL</a></span><span data-idl="" class="idlEnum" id="idl-def-readystate" data-title="ReadyState">enum <dfn data-export="" data-dfn-type="enum" id="dom-readystate" data-idl="enum" data-title="ReadyState" data-dfn-for="ReadyState" class="idlID"><code>ReadyState</code></dfn> {
    <span class="idlEnumItem">"<a class="internalDFN" data-link-for="ReadyState" data-link-type="enum-value" href="#dom-readystate-closed"><code>closed</code></a>"</span>,
    <span class="idlEnumItem">"<a class="internalDFN" data-link-for="ReadyState" data-link-type="enum-value" href="#dom-readystate-open"><code>open</code></a>"</span>,
    <span class="idlEnumItem">"<a class="internalDFN" data-link-for="ReadyState" data-link-type="enum-value" href="#dom-readystate-ended"><code>ended</code></a>"</span>
};</span></pre><table class="simple" data-dfn-for="ReadyState" data-link-for="ReadyState"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><dfn data-dfn-type="enum-value" data-export="" id="dom-readystate-closed" data-idl="enum-value" data-title="closed" data-dfn-for="ReadyState"><code id="idl-def-ReadyState.closed">closed</code></dfn></td><td>
          Indicates the source is not currently attached to a media element.
        </td></tr><tr><td><dfn data-dfn-type="enum-value" data-export="" id="dom-readystate-open" data-idl="enum-value" data-title="open" data-dfn-for="ReadyState"><code id="idl-def-ReadyState.open">open</code></dfn></td><td>
          The source has been opened by a media element and is ready for data to be appended to the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.
        </td></tr><tr><td><dfn data-dfn-type="enum-value" data-export="" id="dom-readystate-ended" data-idl="enum-value" data-title="ended" data-dfn-for="ReadyState"><code id="idl-def-ReadyState.ended">ended</code></dfn></td><td>
          The source is still attached to a media element, but <code><a href="#dom-mediasource-endofstream">endOfStream()</a></code> has been called.
        </td></tr></tbody></table></div>

      <div><pre class="idl def" id="webidl-x1490762926"><span class="idlHeader"><a class="self-link" href="#webidl-x1490762926">WebIDL</a></span><span data-idl="" class="idlEnum" id="idl-def-endofstreamerror" data-title="EndOfStreamError">enum <dfn data-export="" data-dfn-type="enum" id="dom-endofstreamerror" data-idl="enum" data-title="EndOfStreamError" data-dfn-for="EndOfStreamError" class="idlID"><code>EndOfStreamError</code></dfn> {
    <span class="idlEnumItem">"<a class="internalDFN" data-link-for="EndOfStreamError" data-link-type="enum-value" href="#dom-endofstreamerror-network"><code>network</code></a>"</span>,
    <span class="idlEnumItem">"<a class="internalDFN" data-link-for="EndOfStreamError" data-link-type="enum-value" href="#dom-endofstreamerror-decode"><code>decode</code></a>"</span>
};</span></pre><table class="simple" data-dfn-for="EndOfStreamError" data-link-for="EndOfStreamError"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><dfn data-dfn-type="enum-value" data-export="" id="dom-endofstreamerror-network" data-idl="enum-value" data-title="network" data-dfn-for="EndOfStreamError"><code id="idl-def-EndOfStreamError.network">network</code></dfn></td><td>
          <p>Terminates playback and signals that a network error has occured.</p>
          <div class="note" role="note" id="issue-container-generatedID-3"><div role="heading" class="note-title marker" id="h-note-3" aria-level="3"><span>Note</span></div><p class="">JavaScript applications <em class="rfc2119" title="SHOULD">SHOULD</em> use this status code to terminate playback with a network error. For example, if a network error occurs while fetching media data.</p></div>
        </td></tr><tr><td><dfn data-dfn-type="enum-value" data-export="" id="dom-endofstreamerror-decode" data-idl="enum-value" data-title="decode" data-dfn-for="EndOfStreamError"><code id="idl-def-EndOfStreamError.decode">decode</code></dfn></td><td>
          <p>Terminates playback and signals that a decoding error has occured.</p>
          <div class="note" role="note" id="issue-container-generatedID-4"><div role="heading" class="note-title marker" id="h-note-4" aria-level="3"><span>Note</span></div><p class="">JavaScript applications <em class="rfc2119" title="SHOULD">SHOULD</em> use this status code to terminate playback with a decode error. For example, if a parsing error occurs while processing out-of-band media data.</p></div>
        </td></tr></tbody></table></div>

<pre class="idl def respec-offending-element" id="webidl-x2062826858" title="Interfaces must have `[Exposed]` extended attribute. To fix, add, for example, `[Exposed=Window]`. Please also consider carefully if your interface should also be exposed in a Worker scope. Refer to the [WebIDL spec section on Exposed](https://heycam.github.io/webidl/#Exposed) for more information."><span class="idlHeader"><a class="self-link" href="#webidl-x2062826858">WebIDL</a></span><span data-idl="" class="idlInterface" id="idl-def-mediasource" data-title="MediaSource">[<span class="extAttr"><a data-xref-type="extended-attribute" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found">Constructor</a></span>]
interface <dfn data-export="" data-dfn-type="interface" id="dom-mediasource" data-idl="interface" data-title="MediaSource" data-dfn-for="MediaSource" class="idlID"><code>MediaSource</code></dfn> : <span class="idlSuperclass"><a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-0">EventTarget</a></span> {<span data-idl="" class="idlAttribute" id="idl-def-mediasource-sourcebuffers" data-title="sourceBuffers" data-dfn-for="MediaSource">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-sourcebufferlist" class="internalDFN" data-link-type="idl"><code>SourceBufferList</code></a></span>    <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="attribute" href="#dom-mediasource-sourcebuffers"><code>sourceBuffers</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-mediasource-activesourcebuffers" data-title="activeSourceBuffers" data-dfn-for="MediaSource">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-sourcebufferlist" class="internalDFN" data-link-type="idl"><code>SourceBufferList</code></a></span>    <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="attribute" href="#dom-mediasource-activesourcebuffers"><code>activeSourceBuffers</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-mediasource-readystate" data-title="readyState" data-dfn-for="MediaSource">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-readystate" class="internalDFN" data-link-type="idl"><code>ReadyState</code></a></span>          <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="attribute" href="#dom-mediasource-readystate"><code>readyState</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-mediasource-duration" data-title="duration" data-dfn-for="MediaSource">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-unrestricted-double">unrestricted double</a></span> <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="attribute" href="#dom-mediasource-duration"><code>duration</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-mediasource-onsourceopen" data-title="onsourceopen" data-dfn-for="MediaSource">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-1">EventHandler</a></span>        <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="attribute" href="#dom-mediasource-onsourceopen"><code>onsourceopen</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-mediasource-onsourceended" data-title="onsourceended" data-dfn-for="MediaSource">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-2">EventHandler</a></span>        <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="attribute" href="#dom-mediasource-onsourceended"><code>onsourceended</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-mediasource-onsourceclose" data-title="onsourceclose" data-dfn-for="MediaSource">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-3">EventHandler</a></span>        <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="attribute" href="#dom-mediasource-onsourceclose"><code>onsourceclose</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-mediasource-addsourcebuffer-type" data-title="addSourceBuffer" data-dfn-for="MediaSource"><span class="idlType">
    <a data-xref-type="_IDL_" href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a></span>   <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="method" href="#dom-mediasource-addsourcebuffer"><code>addSourceBuffer</code></a> (<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">type</span>);</span><span data-idl="" class="idlMethod" id="idl-def-mediasource-removesourcebuffer-sourcebuffer" data-title="removeSourceBuffer" data-dfn-for="MediaSource"><span class="idlType">
    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span>           <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="method" href="#dom-mediasource-removesourcebuffer"><code>removeSourceBuffer</code></a> (<span class="idlType"><a data-xref-type="_IDL_" href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a></span> <span class="idlParamName">sourceBuffer</span>);</span><span data-idl="" class="idlMethod" id="idl-def-mediasource-endofstream-error" data-title="endOfStream" data-dfn-for="MediaSource"><span class="idlType">
    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span>           <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="method" href="#dom-mediasource-endofstream"><code>endOfStream</code></a> (optional<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-endofstreamerror" class="internalDFN" data-link-type="idl"><code>EndOfStreamError</code></a></span> <span class="idlParamName">error</span>);</span><span data-idl="" class="idlMethod" id="idl-def-mediasource-setliveseekablerange-start-end" data-title="setLiveSeekableRange" data-dfn-for="MediaSource"><span class="idlType">
    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span>           <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="method" href="#dom-mediasource-setliveseekablerange"><code>setLiveSeekableRange</code></a> (<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-double">double</a></span> <span class="idlParamName">start</span>,<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-double">double</a></span> <span class="idlParamName">end</span>);</span><span data-idl="" class="idlMethod" id="idl-def-mediasource-clearliveseekablerange" data-title="clearLiveSeekableRange" data-dfn-for="MediaSource"><span class="idlType">
    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span>           <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="method" href="#dom-mediasource-clearliveseekablerange"><code>clearLiveSeekableRange</code></a> ();</span><span data-idl="" class="idlMethod" id="idl-def-mediasource-istypesupported-type" data-title="isTypeSupported" data-dfn-for="MediaSource">
    static<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-for="MediaSource" data-link-type="method" href="#dom-mediasource-istypesupported"><code>isTypeSupported</code></a> (<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">type</span>);</span>
};</span></pre>
      <section id="attributes">
        <h3 id="x2-1-attributes"><bdi class="secno">2.1 </bdi>Attributes<a class="self-link" aria-label="§" href="#attributes"></a></h3>
        <dl class="attributes" data-dfn-for="MediaSource" data-link-for="MediaSource"><dt><dfn data-dfn-type="attribute" data-export="" id="dom-mediasource-sourcebuffers" data-idl="attribute" data-title="sourceBuffers" data-dfn-for="MediaSource" data-type="SourceBufferList" data-lt="sourceBuffers" data-local-lt="MediaSource.sourceBuffers"><code>sourceBuffers</code></dfn> of type <span class="idlAttrType"><a href="#idl-def-sourcebufferlist" class="internalDFN" data-link-type="idl"><code>SourceBufferList</code></a></span>, readonly       </dt><dd>
          Contains the list of <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects associated with this <a href="#dom-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a>. When <code><a href="#dom-readystate">readyState</a></code> equals <code><a href="#idl-def-ReadyState.closed">"closed"</a></code> this list will be empty. Once <code><a href="#dom-readystate">readyState</a></code> transitions to <code><a href="#idl-def-ReadyState.open">"open"</a></code> SourceBuffer objects can be added to this list by using <code><a href="#dom-mediasource-addsourcebuffer">addSourceBuffer()</a></code>.
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-mediasource-activesourcebuffers" data-idl="attribute" data-title="activeSourceBuffers" data-dfn-for="MediaSource" data-type="SourceBufferList" data-lt="activeSourceBuffers" data-local-lt="MediaSource.activeSourceBuffers"><code>activeSourceBuffers</code></dfn> of type <span class="idlAttrType"><a href="#idl-def-sourcebufferlist" class="internalDFN" data-link-type="idl"><code>SourceBufferList</code></a></span>, readonly       </dt><dd>
          <p>Contains the subset of <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> that are providing the
            <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-selected">selected video track</a>, the
            <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-enabled">enabled audio track(s)</a>, and the
            <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-showing">"showing"</a></code> or <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-hidden">"hidden"</a></code> text track(s).
          </p>
          <p><a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in this list <em class="rfc2119" title="MUST">MUST</em> appear in the same order as they appear in
            the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute; e.g., if only sourceBuffers[0] and
            sourceBuffers[3] are in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>, then activeSourceBuffers[0] <em class="rfc2119" title="MUST">MUST</em>
            equal sourceBuffers[0] and activeSourceBuffers[1] <em class="rfc2119" title="MUST">MUST</em> equal sourceBuffers[3].
          </p>
          <div class="note" role="note" id="issue-container-generatedID-5"><div role="heading" class="note-title marker" id="h-note-5" aria-level="4"><span>Note</span></div><p class="">The <a href="#active-source-buffer-changes">Changes to selected/enabled track state</a> section describes how this attribute gets
            updated.</p></div>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-mediasource-readystate" data-idl="attribute" data-title="readyState" data-dfn-for="MediaSource" data-type="ReadyState" data-lt="readyState" data-local-lt="MediaSource.readyState"><code>readyState</code></dfn> of type <span class="idlAttrType"><a href="#dom-mediasource-readystate" class="internalDFN" data-link-type="idl">ReadyState</a></span>, readonly       </dt><dd>
          <p>Indicates the current state of the <a href="#dom-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object. When the <a href="#dom-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> is created <code><a href="#dom-readystate">readyState</a></code> <em class="rfc2119" title="MUST">MUST</em> be set to <code><a href="#idl-def-ReadyState.closed">"closed"</a></code>.
        </p></dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-mediasource-duration" data-idl="attribute" data-title="duration" data-dfn-for="MediaSource" data-type="unrestricted double" data-lt="duration" data-local-lt="MediaSource.duration"><code>duration</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-unrestricted-double">unrestricted double</a></code></span></dt><dd>
          <p>Allows the web application to set the presentation duration. The duration is initially set to NaN when the <a href="#dom-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object is created.</p>
          <p>On getting, run the following steps:</p>
          <ol>
            <li>If the <code><a href="#dom-readystate">readyState</a></code> attribute is <code><a href="#idl-def-ReadyState.closed">"closed"</a></code> then return NaN and abort these steps.</li>
            <li>Return the current value of the attribute.</li>
          </ol>
          <p>On setting, run the following steps:</p>
          <ol>
            <li>If the value being set is negative or NaN then throw a <code>TypeError</code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-readystate">readyState</a></code> attribute is not <code><a href="#idl-def-ReadyState.open">"open"</a></code> then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true on any <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>Run the <a href="#duration-change-algorithm">duration change algorithm</a> with <var>new duration</var> set to the value being assigned to this attribute.
              <div class="note" role="note" id="issue-container-generatedID-6"><div role="heading" class="note-title marker" id="h-note-6" aria-level="4"><span>Note</span></div><p class="">The <a href="#duration-change-algorithm">duration change algorithm</a> will adjust <var>new duration</var> higher if there is any currently buffered coded frame with a higher end time.</p></div>
              <div class="note" role="note" id="issue-container-generatedID-7"><div role="heading" class="note-title marker" id="h-note-7" aria-level="4"><span>Note</span></div><p class=""><code><a href="#dom-sourcebuffer-appendbuffer">appendBuffer()</a></code> and <code><a href="#dom-mediasource-endofstream">endOfStream()</a></code> can update the duration under certain circumstances.</p></div>
            </li>
          </ol>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-mediasource-onsourceopen" data-idl="attribute" data-title="onsourceopen" data-dfn-for="MediaSource" data-type="EventHandler" data-lt="onsourceopen" data-local-lt="MediaSource.onsourceopen"><code>onsourceopen</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt><dd>
          <p>The event handler for the <code><a href="#dom-evt-sourceopen">sourceopen</a></code> event.</p>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-mediasource-onsourceended" data-idl="attribute" data-title="onsourceended" data-dfn-for="MediaSource" data-type="EventHandler" data-lt="onsourceended" data-local-lt="MediaSource.onsourceended"><code>onsourceended</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt><dd>
          <p>The event handler for the <code><a href="#dom-evt-sourceended">sourceended</a></code> event.</p>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-mediasource-onsourceclose" data-idl="attribute" data-title="onsourceclose" data-dfn-for="MediaSource" data-type="EventHandler" data-lt="onsourceclose" data-local-lt="MediaSource.onsourceclose"><code>onsourceclose</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt><dd>
          <p>The event handler for the <code><a href="#dom-evt-sourceclose">sourceclose</a></code> event.</p>
        </dd></dl></section><section id="methods"><h3 id="x2-2-methods"><bdi class="secno">2.2 </bdi>Methods<a class="self-link" aria-label="§" href="#methods"></a></h3><dl class="methods" data-dfn-for="MediaSource" data-link-for="MediaSource"><dt><dfn data-dfn-type="method" data-export="" id="dom-mediasource-addsourcebuffer" data-idl="operation" data-title="addSourceBuffer" data-dfn-for="MediaSource" data-type="SourceBuffer" data-lt="addSourceBuffer()|addSourceBuffer(type)" data-local-lt="MediaSource.addSourceBuffer|MediaSource.addSourceBuffer()|addSourceBuffer"><code>addSourceBuffer</code></dfn></dt><dd>
          <p>Adds a new <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> to <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.</p>
          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">type</td><td class="prmType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-DOMString">DOMString</a></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>If <var>type</var> is an empty string then throw a <code>TypeError</code> exception and abort these steps.</li>
            <li>If <var>type</var> contains a MIME type that is not supported or contains a MIME type that is not supported with the types specified for the other <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>, then throw a <code><a href="https://www.w3.org/TR/WebIDL-1/#notsupportederror">NotSupportedError</a></code> exception and abort these steps.</li>
            <li>If the user agent can't handle any more SourceBuffer objects or if creating a SourceBuffer
              based on <var>type</var> would result in an unsupported <a href="#sourcebuffer-configuration">SourceBuffer configuration</a>,
              then throw a <code><a href="https://www.w3.org/TR/WebIDL-1/#quotaexceedederror">QuotaExceededError</a></code> exception and abort these steps.
              <div class="note" role="note" id="issue-container-generatedID-8"><div role="heading" class="note-title marker" id="h-note-8" aria-level="4"><span>Note</span></div><p class="">For example, a user agent <em class="rfc2119" title="MAY">MAY</em> throw a <code><a href="https://www.w3.org/TR/WebIDL-1/#quotaexceedederror">QuotaExceededError</a></code> exception if the media element has reached the
                <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code> readyState. This can occur if the user agent's media engine does not support adding more tracks during
                playback.
              </p></div>
            </li>
            <li>If the <code><a href="#dom-readystate">readyState</a></code> attribute is not in the <code><a href="#idl-def-ReadyState.open">"open"</a></code> state then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>Create a new <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object and associated resources.</li>
            <li>Set the <var><a href="#sourcebuffer-generate-timestamps-flag">generate timestamps flag</a></var> on the new object to the value in the
               "Generate Timestamps Flag" column of the byte stream format registry [<cite><a class="bibref" data-link-type="biblio" href="#bib-mse-registry" title="Media Source Extensions™ Byte Stream Format Registry">MSE-REGISTRY</a></cite>] entry
              that is associated with <var>type</var>.
            </li><li>
              <dl class="switch">
                <dt>If the <var><a href="#sourcebuffer-generate-timestamps-flag">generate timestamps flag</a></var> equals true:</dt>
                <dd>
                  Set the <code><a href="#dom-sourcebuffer-mode">mode</a></code> attribute on the new object to
                  <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code>.
                </dd>
                <dt>Otherwise:</dt>
                <dd>
                  Set the <code><a href="#dom-sourcebuffer-mode">mode</a></code> attribute on the new object to
                  <code><a href="#idl-def-AppendMode.segments">"segments"</a></code>.
                </dd>
              </dl>
            </li>
            <li>Add the new object to <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> and <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-addsourcebuffer">addsourcebuffer</a></code> at <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.</li>
            <li>Return the new object.</li>
          </ol></dd><dt><dfn data-dfn-type="method" data-export="" id="dom-mediasource-removesourcebuffer" data-idl="operation" data-title="removeSourceBuffer" data-dfn-for="MediaSource" data-type="void" data-lt="removeSourceBuffer()|removeSourceBuffer(sourceBuffer)" data-local-lt="MediaSource.removeSourceBuffer|MediaSource.removeSourceBuffer()|removeSourceBuffer"><code>removeSourceBuffer</code></dfn></dt><dd>
          <p>Removes a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> from <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.</p>

          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">sourceBuffer</td><td class="prmType"><code>SourceBuffer</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-void" class="idlType">void</a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>If <var>sourceBuffer</var> specifies an object that is not in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> then throw a <code><a href="https://www.w3.org/TR/WebIDL-1/#notfounderror">NotFoundError</a></code> exception and abort these steps.</li>
            <li>If the <var>sourceBuffer</var>.<code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true, then run the following steps:
              <ol>
                <li>Abort the <a href="#sourcebuffer-buffer-append">buffer append</a> algorithm if it is running.</li>
                <li>Set the <var>sourceBuffer</var>.<code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute to false.</li>
                <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-abort">abort</a></code> at <var>sourceBuffer</var>.</li>
                <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-updateend">updateend</a></code> at <var>sourceBuffer</var>.</li>
              </ol>
            </li>

            <li>Let <var>SourceBuffer audioTracks list</var> equal the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> object returned by <var>sourceBuffer</var>.<code><a href="#dom-sourcebuffer-audiotracks">audioTracks</a></code>.</li>
            <li>If the <var>SourceBuffer audioTracks list</var> is not empty, then run the following steps:
              <ol>
                <li>Let <var>HTMLMediaElement audioTracks list</var> equal the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> object returned by the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-audiotracks">audioTracks</a></code> attribute on the HTMLMediaElement.</li>
                <li>For each <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object in the <var>SourceBuffer audioTracks list</var>, run the following steps:
                  <ol>
                    <li>Set the <code><a href="#dom-audiotrack-sourcebuffer">sourceBuffer</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object to null.</li>
                    <li>Remove the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object from the <var>HTMLMediaElement audioTracks list</var>.
                    <div class="note" role="note" id="issue-container-generatedID-9"><div role="heading" class="note-title marker" id="h-note-9" aria-level="4"><span>Note</span></div><p class="">
                      This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onremovetrack">removetrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object, at the <var>HTMLMediaElement audioTracks list</var>.
                      If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-enabled">enabled</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object was true at the beginning of this removal step, then this should also trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onchange">change</a></code> at the <var>HTMLMediaElement audioTracks list</var>
                    </p></div>
                    </li>
                    <li>Remove the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object from the <var>SourceBuffer audioTracks list</var>.
                    <div class="note" role="note" id="issue-container-generatedID-10"><div role="heading" class="note-title marker" id="h-note-10" aria-level="4"><span>Note</span></div><p class="">
                      This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onremovetrack">removetrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object, at the <var>SourceBuffer audioTracks list</var>.
                      If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-enabled">enabled</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object was true at the beginning of this removal step, then this should also trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onchange">change</a></code> at the <var>SourceBuffer audioTracks list</var>
                    </p></div>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>

            <li>Let <var>SourceBuffer videoTracks list</var> equal the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> object returned by <var>sourceBuffer</var>.<code><a href="#dom-sourcebuffer-videotracks">videoTracks</a></code>.</li>
            <li>If the <var>SourceBuffer videoTracks list</var> is not empty, then run the following steps:
              <ol>
                <li>Let <var>HTMLMediaElement videoTracks list</var> equal the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> object returned by the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-videotracks">videoTracks</a></code> attribute on the HTMLMediaElement.</li>
                <li>For each <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object in the <var>SourceBuffer videoTracks list</var>, run the following steps:
                  <ol>
                    <li>Set the <code><a href="#dom-videotrack-sourcebuffer">sourceBuffer</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object to null.</li>
                    <li>Remove the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object from the <var>HTMLMediaElement videoTracks list</var>.
                    <div class="note" role="note" id="issue-container-generatedID-11"><div role="heading" class="note-title marker" id="h-note-11" aria-level="4"><span>Note</span></div><p class="">
                      This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onremovetrack">removetrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object, at the <var>HTMLMediaElement videoTracks list</var>.
                      If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-selected">selected</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object was true at the beginning of this removal step, then this should also trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onchange">change</a></code> at the <var>HTMLMediaElement videoTracks list</var>
                    </p></div>
                    </li>
                    <li>Remove the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object from the <var>SourceBuffer videoTracks list</var>.
                    <div class="note" role="note" id="issue-container-generatedID-12"><div role="heading" class="note-title marker" id="h-note-12" aria-level="4"><span>Note</span></div><p class="">
                      This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onremovetrack">removetrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object, at the <var>SourceBuffer videoTracks list</var>.
                      If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-selected">selected</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object was true at the beginning of this removal step, then this should also trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onchange">change</a></code> at the <var>SourceBuffer videoTracks list</var>
                    </p></div>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>


            <li>Let <var>SourceBuffer textTracks list</var> equal the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> object returned by <var>sourceBuffer</var>.<code><a href="#dom-sourcebuffer-texttracks">textTracks</a></code>.</li>
            <li>If the <var>SourceBuffer textTracks list</var> is not empty, then run the following steps:
              <ol>
                <li>Let <var>HTMLMediaElement textTracks list</var> equal the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> object returned by the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-texttracks">textTracks</a></code> attribute on the HTMLMediaElement.</li>
                <li>For each <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object in the <var>SourceBuffer textTracks list</var>, run the following steps:
                  <ol>
                    <li>Set the <code><a href="#dom-texttrack-sourcebuffer">sourceBuffer</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object to null.</li>
                    <li>Remove the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object from the <var>HTMLMediaElement textTracks list</var>.
                    <div class="note" role="note" id="issue-container-generatedID-13"><div role="heading" class="note-title marker" id="h-note-13" aria-level="4"><span>Note</span></div><p class="">
                      This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttracklist-onremovetrack">removetrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object, at the <var>HTMLMediaElement textTracks list</var>.
                      If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-mode">mode</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object was <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-showing">"showing"</a></code> or <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-hidden">"hidden"</a></code> at the beginning of this removal step, then this should also trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttracklist-onchange">change</a></code> at the <var>HTMLMediaElement textTracks list</var>.
                    </p></div>
                    </li>
                    <li>Remove the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object from the <var>SourceBuffer textTracks list</var>.
                    <div class="note" role="note" id="issue-container-generatedID-14"><div role="heading" class="note-title marker" id="h-note-14" aria-level="4"><span>Note</span></div><p class="">
                      This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttracklist-onremovetrack">removetrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object, at the <var>SourceBuffer textTracks list</var>.
                      If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-mode">mode</a></code> attribute on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object was <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-showing">"showing"</a></code> or <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-hidden">"hidden"</a></code> at the beginning of this removal step, then this should also trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttracklist-onchange">change</a></code> at the <var>SourceBuffer textTracks list</var>.
                    </p></div>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>

            <li>If <var>sourceBuffer</var> is in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>, then remove <var>sourceBuffer</var> from <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code> and
              <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-removesourcebuffer">removesourcebuffer</a></code> at the <a href="#idl-def-sourcebufferlist" class="internalDFN" data-link-type="idl"><code>SourceBufferList</code></a> returned by <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.</li>
            <li>Remove <var>sourceBuffer</var> from <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> and <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-removesourcebuffer">removesourcebuffer</a></code> at
              the <a href="#idl-def-sourcebufferlist" class="internalDFN" data-link-type="idl"><code>SourceBufferList</code></a> returned by <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.</li>
            <li>Destroy all resources for <var>sourceBuffer</var>.</li>
          </ol></dd><dt><dfn data-dfn-type="method" data-export="" id="dom-mediasource-endofstream" data-idl="operation" data-title="endOfStream" data-dfn-for="MediaSource" data-type="void" data-lt="endOfStream()|endOfStream(, error)" data-local-lt="MediaSource.endOfStream|MediaSource.endOfStream()|endOfStream"><code>endOfStream</code></dfn></dt><dd>
          <p>Signals the end of the stream.</p>

          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">error</td><td class="prmType"><code>EndOfStreamError</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptTrue"><span role="img" aria-label="True">✔</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-void" class="idlType">void</a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>If the <code><a href="#dom-readystate">readyState</a></code> attribute is not in the <code><a href="#idl-def-ReadyState.open">"open"</a></code> state then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true on any <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>Run the <a href="#end-of-stream-algorithm">end of stream algorithm</a> with the <var>error</var> parameter set to <var>error</var>.</li>
          </ol></dd><dt><dfn data-dfn-type="method" data-export="" id="dom-mediasource-setliveseekablerange" data-idl="operation" data-title="setLiveSeekableRange" data-dfn-for="MediaSource" data-type="void" data-lt="setLiveSeekableRange()|setLiveSeekableRange(start, end)" data-local-lt="MediaSource.setLiveSeekableRange|MediaSource.setLiveSeekableRange()|setLiveSeekableRange"><code>setLiveSeekableRange</code></dfn></dt><dd>

          <p>Updates the <var><a href="#live-seekable-range">live seekable range</a></var> variable used in <a href="#htmlmediaelement-extensions">HTMLMediaElement Extensions</a> to modify <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-seekable">HTMLMediaElement.seekable</a></code> behavior.</p>
          
          <table class="parameters">
            <tbody>
              <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Nullable</th>
                <th>Optional</th>
                <th>Description</th>
              </tr>
              <tr>
                <td class="prmName">start</td>
                <td class="prmType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-double">double</a></code></td>
                <td class="prmNullFalse"><span aria-label="False" role="img">✘</span></td>
                <td class="prmOptFalse"><span aria-label="False" role="img">✘</span></td>
                <td class="prmDesc">The start of the range, in seconds measured from <a href="#presentation-start-time">presentation start time</a>. While set, and if <code><a href="#dom-mediasource-duration">duration</a></code> equals positive Infinity, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-seekable">HTMLMediaElement.seekable</a></code> will return a non-empty TimeRanges object with a lowest range start timestamp no greater than <var>start</var>.</td>
              </tr>
              <tr>
                <td class="prmName">end</td>
                <td class="prmType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-double">double</a></code></td>
                <td class="prmNullFalse"><span aria-label="False" role="img">✘</span></td>
                <td class="prmOptFalse"><span aria-label="False" role="img">✘</span></td>
                <td class="prmDesc">The end of range, in seconds measured from <a href="#presentation-start-time">presentation start time</a>. While set, and if <code><a href="#dom-mediasource-duration">duration</a></code> equals positive Infinity, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-seekable">HTMLMediaElement.seekable</a></code> will return a non-empty TimeRanges object with a highest range end timestamp no less than <var>end</var>.</td>
              </tr>
            </tbody>
          </table>
        <div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-void" class="idlType">void</a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>If the <code><a href="#dom-readystate">readyState</a></code> attribute is not <code><a href="#idl-def-ReadyState.open">"open"</a></code> then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If <var>start</var> is negative or greater than <var>end</var>, then throw a <code>TypeError</code> exception and abort these steps.</li>
            <li>Set <var><a href="#live-seekable-range">live seekable range</a></var> to be a new <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#normalized-timeranges-object">normalized TimeRanges object</a> containing a single range whose start position is <var>start</var> and end position is <var>end</var>.
          </li></ol></dd><dt><dfn data-dfn-type="method" data-export="" id="dom-mediasource-clearliveseekablerange" data-idl="operation" data-title="clearLiveSeekableRange" data-dfn-for="MediaSource" data-type="void" data-lt="clearLiveSeekableRange()" data-local-lt="MediaSource.clearLiveSeekableRange|MediaSource.clearLiveSeekableRange()|clearLiveSeekableRange"><code>clearLiveSeekableRange</code></dfn></dt><dd>
          <p>Updates the <var><a href="#live-seekable-range">live seekable range</a></var> variable used in <a href="#htmlmediaelement-extensions">HTMLMediaElement Extensions</a> to modify <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-seekable">HTMLMediaElement.seekable</a></code> behavior.</p>

          
        <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-void" class="idlType">void</a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>If the <code><a href="#dom-readystate">readyState</a></code> attribute is not <code><a href="#idl-def-ReadyState.open">"open"</a></code> then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If <var><a href="#live-seekable-range">live seekable range</a></var> contains a range, then set <var><a href="#live-seekable-range">live seekable range</a></var> to be a new empty <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code> object.
          </li></ol></dd><dt><dfn data-dfn-type="method" data-export="" id="dom-mediasource-istypesupported" data-idl="operation" data-title="isTypeSupported" data-dfn-for="MediaSource" data-type="boolean" data-lt="isTypeSupported()|isTypeSupported(type)" data-local-lt="MediaSource.isTypeSupported|MediaSource.isTypeSupported()|isTypeSupported"><code>isTypeSupported</code></dfn>, static</dt><dd>
          <p>Check to see whether the <a href="#dom-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> is capable of creating <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects for the specified MIME type.</p>

          
          <div class="note" role="note" id="issue-container-generatedID-15"><div role="heading" class="note-title marker" id="h-note-15" aria-level="4"><span>Note</span></div><p class="">
            If true is returned from this method, it only indicates that the <a href="#dom-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> implementation is capable of creating <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects for the specified MIME type. An <code><a href="#dom-mediasource-addsourcebuffer">addSourceBuffer()</a></code> call <em class="rfc2119" title="SHOULD">SHOULD</em> still fail if sufficient resources are not available to support the addition of a new <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>.
          </p></div>
          <div class="note" role="note" id="issue-container-generatedID-16"><div role="heading" class="note-title marker" id="h-note-16" aria-level="4"><span>Note</span></div><p class="">
            This method returning true implies that HTMLMediaElement.canPlayType() will return "maybe" or "probably" since it does not make sense for a <a href="#dom-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> to support a type the HTMLMediaElement knows it cannot play.
          </p></div>
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">type</td><td class="prmType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-DOMString">DOMString</a></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-boolean" class="idlType">boolean</a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>If <var>type</var> is an empty string, then return false.</li>
            <li>If <var>type</var> does not contain a valid MIME type string, then return false.</li>
            <li>If <var>type</var> contains a media type or media subtype that the MediaSource does not support, then return false.</li>
            <li>If <var>type</var> contains a codec that the MediaSource does not support, then return false.</li>
            <li>If the MediaSource does not support the specified combination of media type, media subtype, and codecs then return false.</li>
            <li>Return true.</li>
          </ol></dd></dl>
      </section>

      <section id="mediasource-events">
        <h3 id="x2-3-event-summary"><bdi class="secno">2.3 </bdi>Event Summary<a class="self-link" aria-label="§" href="#mediasource-events"></a></h3>
        <table class="old-table">
          <thead>
            <tr>
              <th>Event name</th>
              <th>Interface</th>
              <th>Dispatched when...</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><dfn id="dom-evt-sourceopen"><code>sourceopen</code></dfn></td>
              <td><code>Event</code></td>
              <td><code><a href="#dom-readystate">readyState</a></code> transitions from <code><a href="#idl-def-ReadyState.closed">"closed"</a></code> to <code><a href="#idl-def-ReadyState.open">"open"</a></code> or from <code><a href="#idl-def-ReadyState.ended">"ended"</a></code> to <code><a href="#idl-def-ReadyState.open">"open"</a></code>.</td>
            </tr>
            <tr>
              <td><dfn id="dom-evt-sourceended"><code>sourceended</code></dfn></td>
              <td><code>Event</code></td>
              <td><code><a href="#dom-readystate">readyState</a></code> transitions from <code><a href="#idl-def-ReadyState.open">"open"</a></code> to <code><a href="#idl-def-ReadyState.ended">"ended"</a></code>.</td>
            </tr>
            <tr>
              <td><dfn id="dom-evt-sourceclose"><code>sourceclose</code></dfn></td>
              <td><code>Event</code></td>
              <td><code><a href="#dom-readystate">readyState</a></code> transitions from <code><a href="#idl-def-ReadyState.open">"open"</a></code> to <code><a href="#idl-def-ReadyState.closed">"closed"</a></code> or <code><a href="#idl-def-ReadyState.ended">"ended"</a></code> to <code><a href="#idl-def-ReadyState.closed">"closed"</a></code>.</td>
            </tr>
          </tbody>
        </table>
      </section>

      <section id="mediasource-algorithms">
        <h3 id="x2-4-algorithms"><bdi class="secno">2.4 </bdi>Algorithms<a class="self-link" aria-label="§" href="#mediasource-algorithms"></a></h3>

        <section id="mediasource-attach">
          <h4 id="x2-4-1-attaching-to-a-media-element"><bdi class="secno">2.4.1 </bdi>Attaching to a media element<a class="self-link" aria-label="§" href="#mediasource-attach"></a></h4>
          <p> A <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> object can be attached to a media element by assigning a <a href="#mediasource-object-url">MediaSource object URL</a> to the media element <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#element-attrdef-media-src">src</a></code> attribute or the src attribute of a &lt;source&gt; inside a media element. A <a href="#mediasource-object-url">MediaSource object URL</a> is created by passing a MediaSource object to <code><a href="#dom-url-createobjecturl">createObjectURL()</a></code>.</p>

          <p>If the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a> was invoked with
          a media provider object that is a MediaSource object or a URL record whose object is a MediaSource object,
          then let mode be local, skip the first step in the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>
          (which may otherwise set mode to remote) and add the steps and clarifications below to the <span>"<i>Otherwise (mode is local)</i>"</span> section of the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>.
          </p><div class="note" role="note" id="issue-container-generatedID-17"><div role="heading" class="note-title marker" id="h-note-17" aria-level="5"><span>Note</span></div><p class="">The <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>'s first step is expected to eventually align with selecting local mode for URL records whose objects are media provider objects. The intent is that if the HTMLMediaElement's <code>src</code> attribute or selected child <code>&lt;source&gt;</code>'s <code>src</code> attribute is a <code>blob:</code> URL matching a <a href="#mediasource-object-url">MediaSource object URL</a> when the respective <code>src</code> attribute was last changed, then that MediaSource object is used as the media provider object and current media resource in the local mode logic in the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>. This also means that the remote mode logic that includes observance of any preload attribute is skipped when a MediaSource object is attached. Even with that eventual change to [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>], the execution of the following steps at the beginning of the local mode logic is still required when the current media resource is a MediaSource object.</p></div>
          <div class="note" role="note" id="issue-container-generatedID-18"><div role="heading" class="note-title marker" id="h-note-18" aria-level="5"><span>Note</span></div><p class="">Relative to the action which triggered the media element's resource selection algorithm, these steps are asynchronous. The resource fetch algorithm is run after the task that invoked the resource selection algorithm is allowed to continue and a stable state is reached. Implementations may delay the steps in the "<i>Otherwise</i>" clause, below, until the MediaSource object is ready for use.</p></div>
          <dl class="switch">
            <dt>If <code><a href="#dom-readystate">readyState</a></code> is NOT set to <code><a href="#idl-def-ReadyState.closed">"closed"</a></code></dt>
            <dd>Run the <span>"<i>If the media data cannot be fetched at all, due to network errors, causing the user agent to give up trying to fetch the resource</i>"</span> steps of the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>'s <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-data-processing-steps-list">media data processing steps list</a>.</dd>
            <dt>Otherwise</dt>
            <dd>
              <ol>
                <li>Set the media element's <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#delaying-the-load-event-flag">delaying-the-load-event-flag</a> to false.</li>
                <li>Set the <code><a href="#dom-readystate">readyState</a></code> attribute to <code><a href="#idl-def-ReadyState.open">"open"</a></code>.</li>
                <li>
                  <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-sourceopen">sourceopen</a></code> at the <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a>.</li>
                <li>Continue the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a> by running the remaining <span>"<i>Otherwise (mode is local)</i>"</span> steps, with these clarifications:
                  <ol>
                    <li>Text in the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a> or the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-data-processing-steps-list">media data processing steps list</a> that refers to "the download", "bytes received", or "whenever new data for the current media resource becomes available" refers to data passed in via <code><a href="#dom-sourcebuffer-appendbuffer">appendBuffer()</a></code>.</li>
                    <li>References to HTTP in the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a> and the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-data-processing-steps-list">media data processing steps list</a> do not apply because the HTMLMediaElement does not fetch media data via HTTP when a <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> is attached.</li>
                  </ol>
                </li>
              </ol>
            </dd>
          </dl>
          <div class="note" role="note" id="issue-container-generatedID-19"><div role="heading" class="note-title marker" id="h-note-19" aria-level="5"><span>Note</span></div><p class="">An attached MediaSource does not use the remote mode steps in the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>, so the media element will not fire "suspend" events. Though future versions of this specification will likely remove "progress" and "stalled" events from a media element with an attached MediaSource, user agents conforming to this version of the specification may still fire these two events as these [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] references changed after implementations of this specification stabilized.</p></div>
        </section>

        <section id="mediasource-detach">
          <h4 id="x2-4-2-detaching-from-a-media-element"><bdi class="secno">2.4.2 </bdi>Detaching from a media element<a class="self-link" aria-label="§" href="#mediasource-detach"></a></h4>
          <p>The following steps are run in any case where the media element is going to transition to <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-network_empty">NETWORK_EMPTY</a> and <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#eventdef-media-emptied">emptied</a> at the media element. These steps <em class="rfc2119" title="SHOULD">SHOULD</em> be run right before the transition.</p>

          <ol>
            <li>Set the <code><a href="#dom-readystate">readyState</a></code> attribute to <code><a href="#idl-def-ReadyState.closed">"closed"</a></code>.</li>
            <li>Update <code><a href="#dom-mediasource-duration">duration</a></code> to NaN.</li>
            <li>Remove all the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects from <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.</li>
            <li>
              <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-removesourcebuffer">removesourcebuffer</a></code> at <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.</li>
            <li>Remove all the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects from <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.</li>
            <li>
              <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-removesourcebuffer">removesourcebuffer</a></code> at <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.</li>
            <li>
              <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-sourceclose">sourceclose</a></code> at the <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a>.</li>
          </ol>
          <div class="note" role="note" id="issue-container-generatedID-20"><div role="heading" class="note-title marker" id="h-note-20" aria-level="5"><span>Note</span></div><p class="">Going forward, this algorithm is intended to be externally called and run in any case where the attached <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a>, if any, must be detached from the media element.  It <em class="rfc2119" title="MAY">MAY</em> be called on HTMLMediaElement [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] operations like load() and resource fetch algorithm failures in addition to, or in place of, when the media element transitions to <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-network_empty">NETWORK_EMPTY</a>. Resource fetch algorithm failures are those which abort either the resource fetch algorithm or the resource selection algorithm, with the exception that the "Final step" [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] is not considered a failure that triggers detachment.</p></div>
        </section>

        <section id="mediasource-seeking">
          <h4 id="x2-4-3-seeking"><bdi class="secno">2.4.3 </bdi>Seeking<a class="self-link" aria-label="§" href="#mediasource-seeking"></a></h4>
          <p>Run the following steps as part of the "<i>Wait until the user agent has established whether or not the media data for the new playback position is available, and, if it is, until it has decoded enough data to play back that position"</i> step of the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#seek">seek algorithm</a>:</p>
          <ol>
            <li>
            <div class="note" role="note" id="issue-container-generatedID-21"><div role="heading" class="note-title marker" id="h-note-21" aria-level="5"><span>Note</span></div><p class="">The media element looks for <a href="#media-segment">media segments</a> containing the <var>new playback position</var> in each <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.
            Any position within a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> in the current value of the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> attribute has all necessary media segments buffered for that position.</p></div>
              <dl class="switch">
                <dt>If <var>new playback position</var> is not in any <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> of <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code></dt>
                  <dd>
                  <ol>
                    <li>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute is greater than
                      <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code>, then set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute
                      to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code>.
                    <div class="note" role="note" id="issue-container-generatedID-22"><div role="heading" class="note-title marker" id="h-note-22" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div>
                    </li>
                    <li>The media element waits until an <code><a href="#dom-sourcebuffer-appendbuffer">appendBuffer()</a></code> call causes the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a> to set
                      the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to a value greater than <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code>.
                      <div class="note" role="note" id="issue-container-generatedID-23"><div role="heading" class="note-title marker" id="h-note-23" aria-level="5"><span>Note</span></div><p class="">The web application can use <code><a href="#dom-sourcebuffer-buffered">buffered</a></code> and <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> to determine what the media element needs to resume playback.</p></div>
                    </li>
                  </ol>
                </dd>
                <dt>Otherwise</dt>
                <dd>Continue
                <div class="note" role="note" id="issue-container-generatedID-24"><div role="heading" class="note-title marker" id="h-note-24" aria-level="5"><span>Note</span></div><p class="">If the <code><a href="#dom-readystate">readyState</a></code> attribute is <code><a href="#idl-def-ReadyState.ended">"ended"</a></code> and the <var>new playback position</var> is within a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> currently in <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code>, then the seek operation must continue to completion here even if one or more currently selected or enabled track buffers' largest range end timestamp is less than <var>new playback position</var>. This condition should only occur due to logic in <code><a href="#dom-sourcebuffer-buffered">buffered</a></code> when <code><a href="#dom-readystate">readyState</a></code> is <code><a href="#idl-def-ReadyState.ended">"ended"</a></code>.</p></div>
                </dd>
              </dl>
            </li>
            <li>The media element resets all decoders and initializes each one with data from the appropriate <a href="#init-segment">initialization segment</a>.</li>
            <li>The media element feeds <a href="#coded-frame">coded frames</a> from the <a href="#active-track-buffers">active track buffers</a> into the decoders starting with the
              closest <a href="#random-access-point">random access point</a> before the <var>new playback position</var>.</li>
            <li>Resume the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#seek">seek algorithm</a> at the "<i>Await a stable state</i>" step.</li>
          </ol>
        </section>

        <section id="buffer-monitoring">
          <h4 id="x2-4-4-sourcebuffer-monitoring"><bdi class="secno">2.4.4 </bdi>SourceBuffer Monitoring<a class="self-link" aria-label="§" href="#buffer-monitoring"></a></h4>
          <p>The following steps are periodically run during playback to make sure that all of the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code> have <a href="#enough-data">enough data to ensure uninterrupted playback</a>. Changes to <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code> also cause these steps to run because they affect the conditions that trigger state transitions.</p>

          <p>Having <dfn id="enough-data" data-dfn-type="dfn">enough data to ensure uninterrupted playback</dfn> is an implementation specific condition where the user agent
          determines that it currently has enough data to play the presentation without stalling for a meaningful period of time. This condition is
          constantly evaluated to determine when to transition the media element into and out of the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_enough_data">HAVE_ENOUGH_DATA</a></code> ready state.
          These transitions indicate when the user agent believes it has enough data buffered or it needs more data respectively.</p>

          <div class="note" role="note" id="issue-container-generatedID-25"><div role="heading" class="note-title marker" id="h-note-25" aria-level="5"><span>Note</span></div><p class="">An implementation <em class="rfc2119" title="MAY">MAY</em> choose to use bytes buffered, time buffered, the append rate, or any other metric it sees fit to
            determine when it has enough data. The metrics used <em class="rfc2119" title="MAY">MAY</em> change during playback so web applications <em class="rfc2119" title="SHOULD">SHOULD</em> only rely on the value of
            <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> to determine whether more data is needed or not.</p></div>

          <div class="note" role="note" id="issue-container-generatedID-26"><div role="heading" class="note-title marker" id="h-note-26" aria-level="5"><span>Note</span></div><p class="">When the media element needs more data, the user agent <em class="rfc2119" title="SHOULD">SHOULD</em> transition it from <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_enough_data">HAVE_ENOUGH_DATA</a></code> to
            <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_future_data">HAVE_FUTURE_DATA</a></code> early enough for a web application to be able to respond without causing an interruption in playback.
            For example, transitioning when the current playback position is 500ms before the end of the buffered data gives the application roughly
            500ms to append more data before playback stalls.</p></div>

          <dl class="switch">
            <dt>If the the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute equals <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_nothing">HAVE_NOTHING</a></code>:</dt>
            <dd>
              <ol>
                <li>Abort these steps.</li>
              </ol>
            </dd>
            <dt>If <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> does not contain a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> for the current playback position:</dt>
            <dd>
              <ol>
                <li>Set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code>.
                <div class="note" role="note" id="issue-container-generatedID-27"><div role="heading" class="note-title marker" id="h-note-27" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div></li>
                <li>Abort these steps.</li>
              </ol>
            </dd>
            <dt>If <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> contains a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> that includes the current playback position and <a href="#enough-data">enough data to ensure uninterrupted playback</a>:</dt>
            <dd>
              <ol>
                <li>Set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_enough_data">HAVE_ENOUGH_DATA</a></code>.
                <div class="note" role="note" id="issue-container-generatedID-28"><div role="heading" class="note-title marker" id="h-note-28" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div></li>
                <li>Playback may resume at this point if it was previously suspended by a transition to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_current_data">HAVE_CURRENT_DATA</a></code>.</li>
                <li>Abort these steps.</li>
              </ol>
            </dd>
            <dt>If <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> contains a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> that includes the current playback position and some time beyond the current playback position, then run the following steps:</dt>
            <dd>
              <ol>
                <li>Set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_future_data">HAVE_FUTURE_DATA</a></code>.
                <div class="note" role="note" id="issue-container-generatedID-29"><div role="heading" class="note-title marker" id="h-note-29" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div>
                </li>
                <li>Playback may resume at this point if it was previously suspended by a transition to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_current_data">HAVE_CURRENT_DATA</a></code>.</li>
                <li>Abort these steps.</li>
              </ol>
            </dd>
            <dt>If <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> contains a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> that ends at the current playback position and does not have a range covering the time immediately after the current position:</dt>
            <dd>
              <ol>
                <li>Set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_current_data">HAVE_CURRENT_DATA</a></code>.
                <div class="note" role="note" id="issue-container-generatedID-30"><div role="heading" class="note-title marker" id="h-note-30" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div>
                </li>
                <li>Playback is suspended at this point since the media element doesn't have enough data to advance the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-timeline">media timeline</a>.</li>
                <li>Abort these steps.</li>
              </ol>
            </dd>
          </dl>
        </section>

        <section id="active-source-buffer-changes">
          <h4 id="x2-4-5-changes-to-selected-enabled-track-state"><bdi class="secno">2.4.5 </bdi>Changes to selected/enabled track state<a class="self-link" aria-label="§" href="#active-source-buffer-changes"></a></h4>
          <p>During playback <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code> needs to be updated if the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-selected">selected video track</a>, the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-enabled">enabled audio track(s)</a>, or a text track <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-mode">mode</a> changes. When one or more of these changes occur the following steps need to be followed.</p>
          <dl class="switch">
            <dt>If the selected video track changes, then run the following steps:</dt>
            <dd>
              <ol>
                <li>If the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with the previously selected video track is not associated with any other enabled tracks, run the following steps:
                  <ol>
                    <li>Remove the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> from <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.</li>
                    <li>
                      <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-removesourcebuffer">removesourcebuffer</a></code> at <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                    </li>
                  </ol>
                </li>
                <li>If the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with the newly selected video track is not already in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>, run the following steps:
                  <ol>
                    <li>Add the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> to <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.</li>
                    <li>
                      <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-addsourcebuffer">addsourcebuffer</a></code> at <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                    </li>
                  </ol>
                </li>
              </ol>
            </dd>
            <dt>If an audio track becomes disabled and the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with this track is not associated with any other enabled or selected track, then run the following steps:</dt>
            <dd>
              <ol>
                <li>Remove the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with the audio track from <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                </li>
                <li>
                  <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-removesourcebuffer">removesourcebuffer</a></code> at <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                </li>
              </ol>
            </dd>
            <dt>If an audio track becomes enabled and the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with this track is not already in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>, then run the following steps:
            </dt>
            <dd>
              <ol>
                <li>Add the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with the audio track to <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                </li>
                <li>
                  <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-addsourcebuffer">addsourcebuffer</a></code> at <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                </li>
              </ol>
            </dd>
            <dt>If a text track <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-mode">mode</a> becomes <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-disabled">"disabled"</a></code> and the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with this track is not associated with any other enabled or selected track, then run the following steps:</dt>
            <dd>
              <ol>
                <li>Remove the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with the text track from <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                </li>
                <li>
                  <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-removesourcebuffer">removesourcebuffer</a></code> at <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                </li>
              </ol>
            </dd>
            <dt>If a text track <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-mode">mode</a> becomes <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-showing">"showing"</a></code> or <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-hidden">"hidden"</a></code> and the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with this track is not already in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>, then run the following steps:
            </dt>
            <dd>
              <ol>
                <li>Add the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> associated with the text track to <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                </li>
                <li>
                  <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-addsourcebuffer">addsourcebuffer</a></code> at <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>
                </li>
              </ol>
            </dd>
          </dl>
        </section>

        <section id="duration-change-algorithm">
          <h4 id="x2-4-6-duration-change"><bdi class="secno">2.4.6 </bdi>Duration change<a class="self-link" aria-label="§" href="#duration-change-algorithm"></a></h4>
          <p>Follow these steps when <code><a href="#dom-mediasource-duration">duration</a></code> needs to change to a <var>new duration</var>.</p>
          <ol>
            <li>If the current value of <code><a href="#dom-mediasource-duration">duration</a></code> is equal to <var>new duration</var>, then return.</li>
            <li>If <var>new duration</var> is less than the highest <a href="#presentation-timestamp">presentation timestamp</a> of any buffered <a href="#coded-frame">coded frames</a> for all <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.
            <div class="note" role="note" id="issue-container-generatedID-31"><div role="heading" class="note-title marker" id="h-note-31" aria-level="5"><span>Note</span></div><p class="">Duration reductions that would truncate currently buffered media are disallowed. When truncation is necessary, use <code><a href="#dom-sourcebuffer-remove">remove()</a></code> to reduce the buffered range before updating <code><a href="#dom-mediasource-duration">duration</a></code>.</p></div>
            </li>
            <li>Let <var>highest end time</var> be the largest <a href="#track-buffer-ranges">track buffer ranges</a> end time across all the <a href="#track-buffer">track buffers</a> across all <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.</li>
            <li>If <var>new duration</var> is less than <var>highest end time</var>, then
              <div class="note" role="note" id="issue-container-generatedID-32"><div role="heading" class="note-title marker" id="h-note-32" aria-level="5"><span>Note</span></div><p class="">This condition can occur because the <a href="#sourcebuffer-coded-frame-removal">coded frame removal algorithm</a> preserves coded frames that start before the start of the removal range.</p></div>
              <ol>

                <li>Update <var>new duration</var> to equal <var>highest end time</var>.</li>
              </ol>
            </li>
            <li>Update <code><a href="#dom-mediasource-duration">duration</a></code> to <var>new duration</var>.</li>
            <li>Update the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-duration">media duration</a></code> to <var>new duration</var> and run the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#durationChange">HTMLMediaElement duration change algorithm</a>.</li>
          </ol>
        </section>

        <section id="end-of-stream-algorithm">
          <h4 id="x2-4-7-end-of-stream-algorithm"><bdi class="secno">2.4.7 </bdi>End of stream algorithm<a class="self-link" aria-label="§" href="#end-of-stream-algorithm"></a></h4>
          <p>This algorithm gets called when the application signals the end of stream via an <code><a href="#dom-mediasource-endofstream">endOfStream()</a></code> call or an algorithm needs to
            signal a decode error. This algorithm takes an <var>error</var> parameter that indicates whether an error will be signalled.</p>
          <ol>
            <li>Change the <code><a href="#dom-readystate">readyState</a></code> attribute value to <code><a href="#idl-def-ReadyState.ended">"ended"</a></code>.</li>
            <li>
              <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-sourceended">sourceended</a></code> at the <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a>.</li>
            <li><dl class="switch">
                <dt>If <var>error</var> is not set</dt>
                <dd>
                  <ol>
                    <li>Run the <a href="#duration-change-algorithm">duration change algorithm</a> with <var>new duration</var> set to
                      the largest <a href="#track-buffer-ranges">track buffer ranges</a> end time across all the <a href="#track-buffer">track buffers</a> across all <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code>.
                      <div class="note" role="note" id="issue-container-generatedID-33"><div role="heading" class="note-title marker" id="h-note-33" aria-level="5"><span>Note</span></div><p class="">This allows the duration to properly reflect the end of the appended media segments. For example, if the duration was explicitly set to 10 seconds and only media segments for 0 to 5 seconds were appended before endOfStream() was called, then the duration will get updated to 5 seconds.</p></div>
                    </li>
                    <li>Notify the media element that it now has all of the media data.</li>
                  </ol>
                </dd>
                <dt>If <var>error</var> is set to <code><a href="#idl-def-EndOfStreamError.network">"network"</a></code>
                </dt>
                <dd>
                  <dl class="switch">
                    <dt>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute equals <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_nothing">HAVE_NOTHING</a></code>
                    </dt>
                    <dd>Run the <span>"<i>If the media data cannot be fetched at all, due to network errors, causing the user agent to give up trying to fetch the resource</i>"</span> steps of the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>'s <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-data-processing-steps-list">media data processing steps list</a>.</dd>
                    <dt>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute is greater than <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_nothing">HAVE_NOTHING</a></code>
                    </dt>
                    <dd>Run the "<i>If the connection is interrupted after some media data has been received, causing the user agent to give up trying to fetch the resource</i>" steps of the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>'s <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-data-processing-steps-list">media data processing steps list</a>.</dd>
                  </dl>
                </dd>
                <dt>If <var>error</var> is set to <code><a href="#idl-def-EndOfStreamError.decode">"decode"</a></code>
                </dt>
                <dd>
                  <dl class="switch">
                    <dt>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute equals <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_nothing">HAVE_NOTHING</a></code>
                    </dt>
                    <dd>Run the "<i>If the media data can be fetched but is found by inspection to be in an unsupported format, or can otherwise not be rendered at all</i>" steps of the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>'s <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-data-processing-steps-list">media data processing steps list</a>.</dd>
                    <dt>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute is greater than <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_nothing">HAVE_NOTHING</a></code>
                    </dt>
                    <dd>Run the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#fatal-decode-error">media data is corrupted</a> steps of the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#resource-fetch-algorithm">resource fetch algorithm</a>'s <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-data-processing-steps-list">media data processing steps list</a>.</dd>
                  </dl>
                </dd>
              </dl>
            </li>
          </ol>
        </section>
      </section>
    </section>

    <section id="sourcebuffer">
      <h2 id="x3-sourcebuffer-object"><bdi class="secno">3. </bdi>SourceBuffer Object<a class="self-link" aria-label="§" href="#sourcebuffer"></a></h2>


<pre class="idl def" id="webidl-x723564574"><span class="idlHeader"><a class="self-link" href="#webidl-x723564574">WebIDL</a></span><span data-idl="" class="idlEnum" id="idl-def-appendmode" data-title="AppendMode">enum <dfn data-export="" data-dfn-type="enum" id="dom-appendmode" data-idl="enum" data-title="AppendMode" data-dfn-for="AppendMode" class="idlID"><code>AppendMode</code></dfn> {
    <span class="idlEnumItem">"<a class="internalDFN" data-link-for="AppendMode" data-link-type="enum-value" href="#dom-appendmode-segments"><code>segments</code></a>"</span>,
    <span class="idlEnumItem">"<a class="internalDFN" data-link-for="AppendMode" data-link-type="enum-value" href="#dom-appendmode-sequence"><code>sequence</code></a>"</span>
};</span></pre><table class="simple" data-dfn-for="AppendMode" data-link-for="AppendMode"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><dfn data-dfn-type="enum-value" data-export="" id="dom-appendmode-segments" data-idl="enum-value" data-title="segments" data-dfn-for="AppendMode"><code id="idl-def-AppendMode.segments">segments</code></dfn></td><td>
          <p>The timestamps in the media segment determine where the <a href="#coded-frame">coded frames</a> are placed in the presentation. Media segments can be appended in any order.</p>
        </td></tr><tr><td><dfn data-dfn-type="enum-value" data-export="" id="dom-appendmode-sequence" data-idl="enum-value" data-title="sequence" data-dfn-for="AppendMode"><code id="idl-def-AppendMode.sequence">sequence</code></dfn></td><td>
          <p>Media segments will be treated as adjacent in time independent of the timestamps in the media segment. Coded frames in a new media segment will be placed immediately after the coded
            frames in the previous media segment. The <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> attribute will be updated if a new offset is needed to make the new media segments adjacent to the previous media segment.
            Setting the <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> attribute in <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code> mode allows a media segment to be placed at a specific position in the timeline without any knowledge
            of the timestamps in the media segment.
          </p>
        </td></tr></tbody></table>

<pre class="idl def respec-offending-element" id="webidl-x932069893" title="Interfaces must have `[Exposed]` extended attribute. To fix, add, for example, `[Exposed=Window]`. Please also consider carefully if your interface should also be exposed in a Worker scope. Refer to the [WebIDL spec section on Exposed](https://heycam.github.io/webidl/#Exposed) for more information."><span class="idlHeader"><a class="self-link" href="#webidl-x932069893">WebIDL</a></span><span data-idl="" class="idlInterface" id="idl-def-sourcebuffer" data-title="SourceBuffer">interface <dfn data-export="" data-dfn-type="interface" id="dom-sourcebuffer" data-idl="interface" data-title="SourceBuffer" data-dfn-for="SourceBuffer" class="idlID"><code>SourceBuffer</code></dfn> : <span class="idlSuperclass"><a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-4">EventTarget</a></span> {<span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-mode" data-title="mode" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-appendmode" class="internalDFN" data-link-type="idl"><code>AppendMode</code></a></span>          <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-mode"><code>mode</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-updating" data-title="updating" data-dfn-for="SourceBuffer">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-boolean">boolean</a></span>             <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-updating"><code>updating</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-buffered" data-title="buffered" data-dfn-for="SourceBuffer">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-5">TimeRanges</a></span>          <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-buffered"><code>buffered</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-timestampoffset" data-title="timestampOffset" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-double">double</a></span>              <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-timestampoffset"><code>timestampOffset</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-audiotracks" data-title="audioTracks" data-dfn-for="SourceBuffer">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-6">AudioTrackList</a></span>      <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-audiotracks"><code>audioTracks</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-videotracks" data-title="videoTracks" data-dfn-for="SourceBuffer">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-7">VideoTrackList</a></span>      <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-videotracks"><code>videoTracks</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-texttracks" data-title="textTracks" data-dfn-for="SourceBuffer">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-8">TextTrackList</a></span>       <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-texttracks"><code>textTracks</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-appendwindowstart" data-title="appendWindowStart" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-double">double</a></span>              <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-appendwindowstart"><code>appendWindowStart</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-appendwindowend" data-title="appendWindowEnd" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-unrestricted-double">unrestricted double</a></span> <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-appendwindowend"><code>appendWindowEnd</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-onupdatestart" data-title="onupdatestart" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-9">EventHandler</a></span>        <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-onupdatestart"><code>onupdatestart</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-onupdate" data-title="onupdate" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-10">EventHandler</a></span>        <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-onupdate"><code>onupdate</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-onupdateend" data-title="onupdateend" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-11">EventHandler</a></span>        <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-onupdateend"><code>onupdateend</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-onerror" data-title="onerror" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-12">EventHandler</a></span>        <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-onerror"><code>onerror</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebuffer-onabort" data-title="onabort" data-dfn-for="SourceBuffer">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-13">EventHandler</a></span>        <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="attribute" href="#dom-sourcebuffer-onabort"><code>onabort</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-sourcebuffer-appendbuffer-data" data-title="appendBuffer" data-dfn-for="SourceBuffer"><span class="idlType">
    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="method" href="#dom-sourcebuffer-appendbuffer"><code>appendBuffer</code></a> (<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="typedef" href="https://heycam.github.io/webidl/#BufferSource">BufferSource</a></span> <span class="idlParamName">data</span>);</span><span data-idl="" class="idlMethod" id="idl-def-sourcebuffer-abort" data-title="abort" data-dfn-for="SourceBuffer"><span class="idlType">
    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="method" href="#dom-sourcebuffer-abort"><code>abort</code></a> ();</span><span data-idl="" class="idlMethod" id="idl-def-sourcebuffer-remove-start-end" data-title="remove" data-dfn-for="SourceBuffer"><span class="idlType">
    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="SourceBuffer" data-link-type="method" href="#dom-sourcebuffer-remove"><code>remove</code></a> (<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-double">double</a></span> <span class="idlParamName">start</span>,<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-unrestricted-double">unrestricted double</a></span> <span class="idlParamName">end</span>);</span>
};</span></pre><section id="attributes-0"><h3 id="x3-1-attributes"><bdi class="secno">3.1 </bdi>Attributes<a class="self-link" aria-label="§" href="#attributes-0"></a></h3><dl class="attributes" data-dfn-for="SourceBuffer" data-link-for="SourceBuffer"><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-mode" data-idl="attribute" data-title="mode" data-dfn-for="SourceBuffer" data-type="AppendMode" data-lt="mode" data-local-lt="SourceBuffer.mode"><code>mode</code></dfn> of type <span class="idlAttrType"><a href="#idl-def-appendmode" class="internalDFN" data-link-type="idl"><code>AppendMode</code></a></span></dt><dd>
          <p>Controls how a sequence of <a href="#media-segment">media segments</a> are handled. This attribute is initially set by <code><a href="#dom-mediasource-addsourcebuffer">addSourceBuffer()</a></code> after the object is created.</p>
          <p>On getting, Return the initial value or the last value that was successfully set.</p>
          <p>On setting, run the following steps:</p>
          <ol>
            <li>If this object has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of the <a href="#parent-media-source">parent media source</a>, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>Let <var>new mode</var> equal the new value being assigned to this attribute.</li>
            <li>If <var><a href="#sourcebuffer-generate-timestamps-flag">generate timestamps flag</a></var> equals true and <var>new mode</var> equals
              <code><a href="#idl-def-AppendMode.segments">"segments"</a></code>, then throw a <code>TypeError</code>
              exception and abort these steps.</li>
            <li>
              <p>If the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> is in the <code><a href="#idl-def-ReadyState.ended">"ended"</a></code> state then run the following steps:</p>
              <ol>
                <li>Set the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> to <code><a href="#idl-def-ReadyState.open">"open"</a></code></li>
                <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-sourceopen">sourceopen</a></code> at the <a href="#parent-media-source">parent media source</a>.</li>
              </ol>
            </li>
            <li>If the <var><a href="#sourcebuffer-append-state">append state</a></var> equals <a href="#sourcebuffer-parsing-media-segment">PARSING_MEDIA_SEGMENT</a>, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> and abort these steps.</li>
            <li>If the <var>new mode</var> equals <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code>, then set the <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var> to the <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var>.</li>
            <li>Update the attribute to <var>new mode</var>.</li>
          </ol>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-updating" data-idl="attribute" data-title="updating" data-dfn-for="SourceBuffer" data-type="boolean" data-lt="updating" data-local-lt="SourceBuffer.updating"><code>updating</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-boolean">boolean</a></code></span>, readonly       </dt><dd>
          <p>Indicates whether the asynchronous continuation of an <code><a href="#dom-sourcebuffer-appendbuffer">appendBuffer()</a></code> or <code><a href="#dom-sourcebuffer-remove">remove()</a></code>
            operation is still being processed. This attribute is initially set to false when the object is created.</p>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-buffered" data-idl="attribute" data-title="buffered" data-dfn-for="SourceBuffer" data-type="TimeRanges" data-lt="buffered" data-local-lt="SourceBuffer.buffered"><code>buffered</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code></span>, readonly       </dt><dd>
          <p>Indicates what <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code> are buffered in the <a href="#dom-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>. This
          attribute is initially set to an empty <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code> object when the object is
          created.</p>
          <p>When the attribute is read the following steps <em class="rfc2119" title="MUST">MUST</em> occur:</p>
          <ol>
            <li>If this object has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of the <a href="#parent-media-source">parent media source</a> then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>Let <var>highest end time</var> be the largest <a href="#track-buffer-ranges">track buffer ranges</a> end time across all the <a href="#track-buffer">track buffers</a> managed by this <a href="#dom-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
            <li>Let <var>intersection ranges</var> equal a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> object containing a single range from 0 to <var>highest end time</var>.</li>
            <li>For each audio and video <a href="#track-buffer">track buffer</a> managed by this <a href="#dom-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>, run the following steps:
                <div class="note" role="note" id="issue-container-generatedID-34"><div role="heading" class="note-title marker" id="h-note-34" aria-level="4"><span>Note</span></div><p class="">Text <a href="#track-buffer">track-buffers</a> are included in the calculation of <var>highest end time</var>, above, but excluded from the buffered range calculation here. They are not necessarily continuous, nor should any discontinuity within them trigger playback stall when the other media tracks are continuous over the same time range.</p></div>
              <ol>
                <li>Let <var>track ranges</var> equal the <a href="#track-buffer-ranges">track buffer ranges</a> for the current <a href="#track-buffer">track buffer</a>.</li>
                <li>If <code><a href="#dom-readystate">readyState</a></code> is <code><a href="#idl-def-ReadyState.ended">"ended"</a></code>, then set the end time on the last range in <var>track ranges</var> to <var>highest end time</var>.</li>
                <li>Let <var>new intersection ranges</var> equal the intersection between the <var>intersection ranges</var> and the <var>track ranges</var>.</li>
                <li>Replace the ranges in <var>intersection ranges</var> with the <var>new intersection ranges</var>.</li>
              </ol>
            </li>
            <li>If <var>intersection ranges</var> does not contain the exact same range information as the
              current value of this attribute, then update the current value of this attribute to
              <var>intersection ranges</var>.</li>
            <li>Return the current value of this attribute.</li>
          </ol>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-timestampoffset" data-idl="attribute" data-title="timestampOffset" data-dfn-for="SourceBuffer" data-type="double" data-lt="timestampOffset" data-local-lt="SourceBuffer.timestampOffset"><code>timestampOffset</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-double">double</a></code></span></dt><dd>
          <p>Controls the offset applied to timestamps inside subsequent <a href="#media-segment">media segments</a> that are appended to this <a href="#dom-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>. The <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> is initially set to 0 which indicates that no offset is being applied.</p>
          <p>On getting, Return the initial value or the last value that was successfully set.</p>
          <p>On setting, run the following steps:</p>
          <ol>
            <li>Let <var>new timestamp offset</var> equal the new value being assigned to this attribute.</li>
            <li>If this object has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of the <a href="#parent-media-source">parent media source</a>, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>
              <p>If the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> is in the <code><a href="#idl-def-ReadyState.ended">"ended"</a></code> state then run the following steps:</p>
              <ol>
                <li>Set the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> to <code><a href="#idl-def-ReadyState.open">"open"</a></code></li>
                <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-sourceopen">sourceopen</a></code> at the <a href="#parent-media-source">parent media source</a>.</li>
              </ol>
            </li>
            <li>If the <var><a href="#sourcebuffer-append-state">append state</a></var> equals <a href="#sourcebuffer-parsing-media-segment">PARSING_MEDIA_SEGMENT</a>, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-mode">mode</a></code> attribute equals <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code>, then set the <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var> to <var>new timestamp offset</var>.</li>
            <li>Update the attribute to <var>new timestamp offset</var>.</li>
          </ol>
        </dd><dt><dfn data-dfn-type="attribute" data-plurals="audiotrack" data-export="" id="dom-sourcebuffer-audiotracks" data-idl="attribute" data-title="audioTracks" data-dfn-for="SourceBuffer" data-type="AudioTrackList" data-lt="audioTracks" data-local-lt="SourceBuffer.audioTracks"><code>audioTracks</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code></span>, readonly       </dt><dd>
          The list of <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> objects created by this object.
        </dd><dt><dfn data-dfn-type="attribute" data-plurals="videotrack" data-export="" id="dom-sourcebuffer-videotracks" data-idl="attribute" data-title="videoTracks" data-dfn-for="SourceBuffer" data-type="VideoTrackList" data-lt="videoTracks" data-local-lt="SourceBuffer.videoTracks"><code>videoTracks</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code></span>, readonly       </dt><dd>
          The list of <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> objects created by this object.
        </dd><dt><dfn data-dfn-type="attribute" data-plurals="texttrack" data-export="" id="dom-sourcebuffer-texttracks" data-idl="attribute" data-title="textTracks" data-dfn-for="SourceBuffer" data-type="TextTrackList" data-lt="textTracks" data-local-lt="SourceBuffer.textTracks"><code>textTracks</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code></span>, readonly       </dt><dd>
          The list of <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> objects created by this object.
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-appendwindowstart" data-idl="attribute" data-title="appendWindowStart" data-dfn-for="SourceBuffer" data-type="double" data-lt="appendWindowStart" data-local-lt="SourceBuffer.appendWindowStart"><code>appendWindowStart</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-double">double</a></code></span></dt><dd>
          <p>The <a href="#presentation-timestamp">presentation timestamp</a> for the start of the <a href="#append-window">append window</a>. This attribute is initially set to the <a href="#presentation-start-time">presentation start time</a>.</p>
          <p>On getting, Return the initial value or the last value that was successfully set.</p>
          <p>On setting, run the following steps:</p>
          <ol>
            <li>If this object has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of the <a href="#parent-media-source">parent media source</a>, then throw an
              <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the new value is less than 0 or greater than or equal to <code><a href="#dom-sourcebuffer-appendwindowend">appendWindowEnd</a></code> then throw a <code>TypeError</code> exception
              and abort these steps.</li>
            <li>Update the attribute to the new value.</li>
          </ol>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-appendwindowend" data-idl="attribute" data-title="appendWindowEnd" data-dfn-for="SourceBuffer" data-type="unrestricted double" data-lt="appendWindowEnd" data-local-lt="SourceBuffer.appendWindowEnd"><code>appendWindowEnd</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-unrestricted-double">unrestricted double</a></code></span></dt><dd>
          <p>The <a href="#presentation-timestamp">presentation timestamp</a> for the end of the <a href="#append-window">append window</a>. This attribute is initially set to positive Infinity.</p>
          <p>On getting, Return the initial value or the last value that was successfully set.</p>
          <p>On setting, run the following steps:</p>
          <ol>
            <li>If this object has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of the <a href="#parent-media-source">parent media source</a>, then throw an
              <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the new value equals NaN, then throw a <code>TypeError</code> and abort these steps.</li>
            <li>If the new value is less than or equal to <code><a href="#dom-sourcebuffer-appendwindowstart">appendWindowStart</a></code> then throw a <code>TypeError</code> exception and abort these
              steps.</li>
            <li>Update the attribute to the new value.</li>
          </ol>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-onupdatestart" data-idl="attribute" data-title="onupdatestart" data-dfn-for="SourceBuffer" data-type="EventHandler" data-lt="onupdatestart" data-local-lt="SourceBuffer.onupdatestart"><code>onupdatestart</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt><dd>
          <p>The event handler for the <code><a href="#dom-evt-updatestart">updatestart</a></code> event.</p>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-onupdate" data-idl="attribute" data-title="onupdate" data-dfn-for="SourceBuffer" data-type="EventHandler" data-lt="onupdate" data-local-lt="SourceBuffer.onupdate"><code>onupdate</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt><dd>
          <p>The event handler for the <code><a href="#dom-evt-update">update</a></code> event.</p>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-onupdateend" data-idl="attribute" data-title="onupdateend" data-dfn-for="SourceBuffer" data-type="EventHandler" data-lt="onupdateend" data-local-lt="SourceBuffer.onupdateend"><code>onupdateend</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt><dd>
          <p>The event handler for the <code><a href="#dom-evt-updateend">updateend</a></code> event.</p>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-onerror" data-idl="attribute" data-title="onerror" data-dfn-for="SourceBuffer" data-type="EventHandler" data-lt="onerror" data-local-lt="SourceBuffer.onerror"><code>onerror</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt><dd>
          <p>The event handler for the <code><a href="#dom-evt-error">error</a></code> event.</p>
        </dd><dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebuffer-onabort" data-idl="attribute" data-title="onabort" data-dfn-for="SourceBuffer" data-type="EventHandler" data-lt="onabort" data-local-lt="SourceBuffer.onabort"><code>onabort</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt><dd>
          <p>The event handler for the <code><a href="#dom-evt-abort">abort</a></code> event.</p>
        </dd></dl></section><section id="methods-0"><h3 id="x3-2-methods"><bdi class="secno">3.2 </bdi>Methods<a class="self-link" aria-label="§" href="#methods-0"></a></h3><dl class="methods" data-dfn-for="SourceBuffer" data-link-for="SourceBuffer"><dt><dfn id="dom-sourcebuffer-appendbuffer" data-dfn-type="method" data-export="" data-idl="operation" data-title="appendBuffer" data-dfn-for="SourceBuffer" data-type="void" data-lt="appendBuffer()|appendBuffer(data)" data-local-lt="SourceBuffer.appendBuffer|SourceBuffer.appendBuffer()|appendBuffer"><code>appendBuffer</code></dfn></dt><dd>
          <p>Appends the segment data in an <code><a href="https://www.w3.org/TR/WebIDL-1/#common-BufferSource" class="idlType">BufferSource</a></code>[<cite><a class="bibref" data-link-type="biblio" href="#bib-webidl" title="Web IDL">WEBIDL</a></cite>] to the source buffer.</p>

          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">data</td><td class="prmType"><code><a href="https://www.w3.org/TR/WebIDL-1/#common-BufferSource">BufferSource</a></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-void" class="idlType">void</a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>Run the <a href="#sourcebuffer-prepare-append">prepare append</a> algorithm.</li>
            <li>Add <var>data</var> to the end of the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var>.</li>
            <li>Set the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute to true.</li>
            <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-updatestart">updatestart</a></code> at this <a href="#dom-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
            <li>Asynchronously run the <a href="#sourcebuffer-buffer-append">buffer append</a> algorithm.</li>
          </ol></dd><dt><dfn data-dfn-type="method" data-export="" id="dom-sourcebuffer-abort" data-idl="operation" data-title="abort" data-dfn-for="SourceBuffer" data-type="void" data-lt="abort()" data-local-lt="SourceBuffer.abort|SourceBuffer.abort()|abort"><code>abort</code></dfn></dt><dd>
          <p>Aborts the current segment and resets the segment parser.</p>

          
        <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-void" class="idlType">void</a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>If this object has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of the <a href="#parent-media-source">parent media source</a> then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> is not in the <code><a href="#idl-def-ReadyState.open">"open"</a></code> state then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <a href="#sourcebuffer-range-removal">range removal</a> algorithm is running, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true, then run the following steps:
              <ol>
                <li>Abort the <a href="#sourcebuffer-buffer-append">buffer append</a> algorithm if it is running.</li>
                <li>Set the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute to false.</li>
                <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-abort">abort</a></code> at this <a href="#dom-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
                <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-updateend">updateend</a></code> at this <a href="#dom-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
              </ol>
            </li>
            <li>Run the <a href="#sourcebuffer-reset-parser-state">reset parser state algorithm</a>.</li>
            <li>Set <code><a href="#dom-sourcebuffer-appendwindowstart">appendWindowStart</a></code> to the <a href="#presentation-start-time">presentation start time</a>.</li>
            <li>Set <code><a href="#dom-sourcebuffer-appendwindowend">appendWindowEnd</a></code> to positive Infinity.</li>
          </ol></dd><dt><dfn data-dfn-type="method" data-export="" id="dom-sourcebuffer-remove" data-idl="operation" data-title="remove" data-dfn-for="SourceBuffer" data-type="void" data-lt="remove()|remove(start, end)" data-local-lt="SourceBuffer.remove|SourceBuffer.remove()|remove"><code>remove</code></dfn></dt><dd>
        <p>Removes media for a specific time range.</p>
        

      <table class="parameters">
        <tbody>
          <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Nullable</th>
            <th>Optional</th>
            <th>Description</th>
          </tr>
          <tr>
            <td class="prmName">start</td>
            <td class="prmType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-double">double</a></code></td>
            <td class="prmNullFalse"><span aria-label="False" role="img">✘</span></td>
            <td class="prmOptFalse"><span aria-label="False" role="img">✘</span></td>
            <td class="prmDesc">The start of the removal range, in seconds measured from <a href="#presentation-start-time">presentation start time</a>.</td>
          </tr>
          <tr>
            <td class="prmName">end</td>
            <td class="prmType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-unrestricted-double">unrestricted double</a></code></td>
            <td class="prmNullFalse"><span aria-label="False" role="img">✘</span></td>
            <td class="prmOptFalse"><span aria-label="False" role="img">✘</span></td>
            <td class="prmDesc">The end of the removal range, in seconds measured from <a href="#presentation-start-time">presentation start time</a>.</td>
          </tr>
        </tbody>
      </table>
        <div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-void" class="idlType">void</a></code></div>
      <p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>If this object has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of the <a href="#parent-media-source">parent media source</a> then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If <code><a href="#dom-mediasource-duration">duration</a></code> equals NaN, then throw a <code>TypeError</code> exception and abort these steps.</li>
            <li>If <var>start</var> is negative or greater than <code><a href="#dom-mediasource-duration">duration</a></code>, then throw a <code>TypeError</code> exception and abort these steps.</li>
            <li>If <var>end</var> is less than or equal to <var>start</var> or <var>end</var> equals NaN, then throw a <code>TypeError</code> exception and abort these steps.</li>
            <li>
              <p>If the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> is in the <code><a href="#idl-def-ReadyState.ended">"ended"</a></code> state then run
                the following steps:</p>
              <ol>
                <li>Set the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> to <code><a href="#idl-def-ReadyState.open">"open"</a></code></li>
                <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-sourceopen">sourceopen</a></code> at the <a href="#parent-media-source">parent media source</a>.</li>
              </ol>
            </li>
            <li>Run the <a href="#sourcebuffer-range-removal">range removal</a> algorithm with <var>start</var> and <var>end</var> as the start and end of the removal range.</li>
       </ol></dd></dl>
      </section>

      <section id="track-buffers">
        <h3 id="x3-3-track-buffers"><bdi class="secno">3.3 </bdi>Track Buffers<a class="self-link" aria-label="§" href="#track-buffers"></a></h3>
        <p>A <dfn id="track-buffer" data-dfn-type="dfn" data-plurals="track buffers">track buffer</dfn> stores the <a href="#track-description">track descriptions</a> and <a href="#coded-frame">coded frames</a> for an individual
          track. The track buffer is updated as <a href="#init-segment">initialization segments</a> and <a href="#media-segment">media segments</a> are appended to the
          <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>.</p>

        <p>Each <a href="#track-buffer">track buffer</a> has a <dfn id="last-decode-timestamp" data-dfn-type="dfn">last decode timestamp</dfn> variable that stores
          the decode timestamp of the last <a href="#coded-frame">coded frame</a> appended in the current <a href="#coded-frame-group">coded frame group</a>. The variable is initially
          unset to indicate that no <a href="#coded-frame">coded frames</a> have been appended yet.</p>

        <p>Each <a href="#track-buffer">track buffer</a> has a <dfn id="last-frame-duration" data-dfn-type="dfn">last frame duration</dfn> variable that stores
          the <a href="#coded-frame-duration">coded frame duration</a> of the last <a href="#coded-frame">coded frame</a> appended in the current <a href="#coded-frame-group">coded frame group</a>. The variable is initially
          unset to indicate that no <a href="#coded-frame">coded frames</a> have been appended yet.</p>

        <p>Each <a href="#track-buffer">track buffer</a> has a <dfn id="highest-end-timestamp" data-dfn-type="dfn">highest end timestamp</dfn> variable that stores
            the highest <a href="#coded-frame-end-timestamp">coded frame end timestamp</a> across all <a href="#coded-frame">coded frames</a> in
            the current <a href="#coded-frame-group">coded frame group</a> that were appended to this track buffer.
            The variable is initially unset to indicate that no <a href="#coded-frame">coded frames</a> have been appended yet.</p>

        <p>Each <a href="#track-buffer">track buffer</a> has a <dfn id="need-RAP-flag" data-dfn-type="dfn">need random access point flag</dfn> variable that keeps track of whether
          the track buffer is waiting for a <a href="#random-access-point">random access point</a> <a href="#coded-frame">coded frame</a>. The variable is initially set to true to
          indicate that <a href="#random-access-point">random access point</a> <a href="#coded-frame">coded frame</a> is needed before anything can be added to the
          <a href="#track-buffer">track buffer</a>.</p>

        <p>Each <a href="#track-buffer">track buffer</a> has a <dfn id="track-buffer-ranges" data-dfn-type="dfn">track buffer ranges</dfn> variable that represents the presentation time ranges occupied by the <a href="#coded-frame">coded frames</a> currently stored in the track buffer.</p>

          <div class="note" role="note" id="issue-container-generatedID-35"><div role="heading" class="note-title marker" id="h-note-35" aria-level="4"><span>Note</span></div><p class="">For track buffer ranges, these presentation time ranges are based on <a href="#presentation-timestamp">presentation timestamps</a>, frame durations, and potentially coded frame group start times for coded frame groups across track buffers in a muxed <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>.</p></div>

          <p>For specification purposes, this information is treated as if it were stored in a <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#normalized-timeranges-object">normalized TimeRanges object</a>. Intersected <a href="#track-buffer-ranges">track buffer ranges</a> are used to report <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code>, and <em class="rfc2119" title="MUST">MUST</em> therefore support uninterrupted playback within each range of <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code>.</p>

          <div class="note" role="note" id="issue-container-generatedID-36"><div role="heading" class="note-title marker" id="h-note-36" aria-level="4"><span>Note</span></div><p class="">These coded frame group start times differ slightly from those mentioned in the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a> in that they are the earliest <a href="#presentation-timestamp">presentation timestamp</a> across all track buffers following a discontinuity. Discontinuities can occur within the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a> or result from the <a href="#sourcebuffer-coded-frame-removal">coded frame removal algorithm</a>, regardless of <code><a href="#dom-sourcebuffer-mode">mode</a></code>.
          The threshold for determining disjointness of <a href="#track-buffer-ranges">track buffer ranges</a> is implementation-specific. For example, to reduce unexpected playback stalls, implementations <em class="rfc2119" title="MAY">MAY</em> approximate the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a>'s discontinuity detection logic by coalescing adjacent ranges separated by a gap smaller than 2 times the maximum frame duration buffered so far in this <a href="#track-buffer">track buffer</a>. Implementations <em class="rfc2119" title="MAY">MAY</em> also use coded frame group start times as range start times across <a href="#track-buffer">track buffers</a> in a muxed <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> to further reduce unexpected playback stalls.</p></div>
      </section>

      <section id="sourcebuffer-events">
        <h3 id="x3-4-event-summary"><bdi class="secno">3.4 </bdi>Event Summary<a class="self-link" aria-label="§" href="#sourcebuffer-events"></a></h3>
        <table class="old-table">
          <thead>
            <tr>
              <th>Event name</th>
              <th>Interface</th>
              <th>Dispatched when...</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><dfn id="dom-evt-updatestart"><code>updatestart</code></dfn></td>
              <td><code>Event</code></td>
              <td><code><a href="#dom-sourcebuffer-updating">updating</a></code> transitions from false to true.</td>
            </tr>
            <tr>
              <td><dfn id="dom-evt-update"><code>update</code></dfn></td>
              <td><code>Event</code></td>
              <td>The append or remove has successfully completed. <code><a href="#dom-sourcebuffer-updating">updating</a></code> transitions from true to false.</td>
            </tr>
            <tr>
              <td><dfn id="dom-evt-updateend"><code>updateend</code></dfn></td>
              <td><code>Event</code></td>
              <td>The append or remove has ended.</td>
            </tr>
            <tr>
              <td><dfn id="dom-evt-error"><code>error</code></dfn></td>
              <td><code>Event</code></td>
              <td>An error occurred during the append. <code><a href="#dom-sourcebuffer-updating">updating</a></code> transitions from true to false.</td>
            </tr>
            <tr>
              <td><dfn id="dom-evt-abort"><code>abort</code></dfn></td>
              <td><code>Event</code></td>
              <td>The append or remove was aborted by an <code><a href="#dom-sourcebuffer-abort">abort()</a></code> call. <code><a href="#dom-sourcebuffer-updating">updating</a></code> transitions from true to false.</td>
            </tr>
          </tbody>
        </table>
      </section>

      <section id="sourcebuffer-algorithms">
        <h3 id="x3-5-algorithms"><bdi class="secno">3.5 </bdi>Algorithms<a class="self-link" aria-label="§" href="#sourcebuffer-algorithms"></a></h3>

        <section id="sourcebuffer-segment-parser-loop">
          <h4 id="x3-5-1-segment-parser-loop"><bdi class="secno">3.5.1 </bdi>Segment Parser Loop<a class="self-link" aria-label="§" href="#sourcebuffer-segment-parser-loop"></a></h4>
          <p>All SourceBuffer objects have an internal <dfn id="sourcebuffer-append-state" data-dfn-type="dfn">append state</dfn> variable that keeps track of the high-level segment parsing state. It is initially set to <a href="#sourcebuffer-waiting-for-segment">WAITING_FOR_SEGMENT</a> and can transition to the following states as data is appended.</p>
          <table class="old-table">
            <thead>
              <tr>
                <th>Append state name</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><dfn id="sourcebuffer-waiting-for-segment" data-dfn-type="dfn">WAITING_FOR_SEGMENT</dfn></td>
                <td>Waiting for the start of an <a href="#init-segment">initialization segment</a> or <a href="#media-segment">media segment</a> to be appended.</td>
              </tr>
              <tr>
                <td><dfn id="sourcebuffer-parsing-init-segment" data-dfn-type="dfn">PARSING_INIT_SEGMENT</dfn></td>
                <td>Currently parsing an <a href="#init-segment">initialization segment</a>.</td>
              </tr>
              <tr>
                <td><dfn id="sourcebuffer-parsing-media-segment" data-dfn-type="dfn">PARSING_MEDIA_SEGMENT</dfn></td>
                <td>Currently parsing a <a href="#media-segment">media segment</a>.</td>
              </tr>
            </tbody>
          </table>

          <p>The <dfn id="sourcebuffer-input-buffer" data-dfn-type="dfn">input buffer</dfn> is a byte buffer that is used to hold unparsed bytes across <code><a href="#dom-sourcebuffer-appendbuffer">appendBuffer()</a></code> calls. The buffer is empty when the SourceBuffer object is created.</p>

          <p>The <dfn id="sourcebuffer-buffer-full-flag" data-dfn-type="dfn">buffer full flag</dfn> keeps track of whether <code><a href="#dom-sourcebuffer-appendbuffer">appendBuffer()</a></code>
            is allowed to accept more bytes. It is set to false when the SourceBuffer object is created and gets updated
            as data is appended and removed.</p>

          <p>The <dfn id="sourcebuffer-group-start-timestamp" data-dfn-type="dfn">group start timestamp</dfn> variable keeps track of the starting timestamp for a new
            <a href="#coded-frame-group">coded frame group</a> in the <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code> mode.
            It is unset when the SourceBuffer object is created and gets updated when the <code><a href="#dom-sourcebuffer-mode">mode</a></code> attribute equals <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code> and the
            <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> attribute is set, or the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a> runs.
          </p>

          <p>The <dfn id="sourcebuffer-group-end-timestamp" data-dfn-type="dfn">group end timestamp</dfn> variable stores the
            highest <a href="#coded-frame-end-timestamp">coded frame end timestamp</a> across all <a href="#coded-frame">coded frames</a> in
            the current <a href="#coded-frame-group">coded frame group</a>. It is set to 0 when the SourceBuffer object is created and gets updated
            by the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a>.
          </p>
          <div class="note" role="note" id="issue-container-generatedID-37"><div role="heading" class="note-title marker" id="h-note-37" aria-level="5"><span>Note</span></div><p class="">The <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var> stores the highest <a href="#coded-frame-end-timestamp">coded frame end timestamp</a> across all <a href="#track-buffer">track buffers</a> in a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>. Therefore, care should be taken in setting the <code><a href="#dom-sourcebuffer-mode">mode</a></code> attribute when appending multiplexed segments in which the timestamps are not aligned across tracks.
          </p></div>

          <p>The <dfn id="sourcebuffer-generate-timestamps-flag" data-dfn-type="dfn">generate timestamps flag</dfn> is a
            boolean variable that keeps track of whether timestamps need to be generated for the
            <a href="#coded-frame">coded frames</a> passed to the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a>.
            This flag is set by <code><a href="#dom-mediasource-addsourcebuffer">addSourceBuffer()</a></code> when the SourceBuffer object is created.
          </p>
          <p>When the segment parser loop algorithm is invoked, run the following steps:</p>

          <ol>
            <li><i>Loop Top:</i> If the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var> is empty, then jump to the <i>need more data</i> step below.</li>
            <li>If the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var> contains bytes that violate the <a href="#sourcebuffer-byte-stream-format-spec">SourceBuffer byte stream format specification</a>, then run the
              <a href="#sourcebuffer-append-error">append error algorithm</a> and abort this algorithm.</li>
            <li>Remove any bytes that the <a href="#byte-stream-format-specs">byte stream format specifications</a> say <em class="rfc2119" title="MUST">MUST</em> be ignored from the start of the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var>.</li>
            <li>
              <p>If the <var><a href="#sourcebuffer-append-state">append state</a></var> equals <a href="#sourcebuffer-waiting-for-segment">WAITING_FOR_SEGMENT</a>, then run the following steps:</p>
              <ol>
                <li>If the beginning of the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var> indicates the start of an <a href="#init-segment">initialization segment</a>, set the <var><a href="#sourcebuffer-append-state">append state</a></var> to <a href="#sourcebuffer-parsing-init-segment">PARSING_INIT_SEGMENT</a>.</li>
                <li>If the beginning of the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var> indicates the start of a <a href="#media-segment">media segment</a>, set <var><a href="#sourcebuffer-append-state">append state</a></var> to <a href="#sourcebuffer-parsing-media-segment">PARSING_MEDIA_SEGMENT</a>.</li>
                <li>Jump to the <i>loop top</i> step above.</li>
              </ol>
            </li>
            <li>
              <p>If the <var><a href="#sourcebuffer-append-state">append state</a></var> equals <a href="#sourcebuffer-parsing-init-segment">PARSING_INIT_SEGMENT</a>, then run the following steps:</p>
              <ol>
                <li>If the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var> does not contain a complete <a href="#init-segment">initialization segment</a> yet, then jump to the <i>need more data</i> step below.</li>
                <li>Run the <a href="#sourcebuffer-init-segment-received">initialization segment received algorithm</a>.</li>
                <li>Remove the <a href="#init-segment">initialization segment</a> bytes from the beginning of the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var>.</li>
                <li>Set <var><a href="#sourcebuffer-append-state">append state</a></var> to <a href="#sourcebuffer-waiting-for-segment">WAITING_FOR_SEGMENT</a>.</li>
                <li>Jump to the <i>loop top</i> step above.</li>
              </ol>
            </li>
            <li>
              <p>If the <var><a href="#sourcebuffer-append-state">append state</a></var> equals <a href="#sourcebuffer-parsing-media-segment">PARSING_MEDIA_SEGMENT</a>, then run the following steps:</p>
              <ol>
                <li>If the <var><a href="#first-init-segment-received-flag">first initialization segment received flag</a></var> is false, then run the <a href="#sourcebuffer-append-error">append error algorithm</a> and abort this algorithm.</li>
                <li>If the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var> contains one or more complete <a href="#coded-frame">coded frames</a>, then run the
                  <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a>.
                  <div class="note" role="note" id="issue-container-generatedID-38"><div role="heading" class="note-title marker" id="h-note-38" aria-level="5"><span>Note</span></div><p class="">
                    The frequency at which the coded frame processing algorithm is run is implementation-specific. The coded frame processing algorithm <em class="rfc2119" title="MAY">MAY</em>
                    be called when the input buffer contains the complete media segment or it <em class="rfc2119" title="MAY">MAY</em> be called multiple times as complete coded frames are
                    added to the input buffer.
                  </p></div>
                </li>
                <li>If this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> is full and cannot accept more media data, then set the <var><a href="#sourcebuffer-buffer-full-flag">buffer full flag</a></var> to true.</li>
                <li>If the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var> does not contain a complete <a href="#media-segment">media segment</a>, then jump to the <i>need more data</i> step below.</li>
                <li>Remove the <a href="#media-segment">media segment</a> bytes from the beginning of the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var>.</li>
                <li>Set <var><a href="#sourcebuffer-append-state">append state</a></var> to <a href="#sourcebuffer-waiting-for-segment">WAITING_FOR_SEGMENT</a>.</li>
                <li>Jump to the <i>loop top</i> step above.</li>
              </ol>
            </li>
            <li><i>Need more data:</i> Return control to the calling algorithm.</li>
          </ol>
        </section>

        <section id="sourcebuffer-reset-parser-state">
          <h4 id="x3-5-2-reset-parser-state"><bdi class="secno">3.5.2 </bdi>Reset Parser State<a class="self-link" aria-label="§" href="#sourcebuffer-reset-parser-state"></a></h4>
          <p>When the parser state needs to be reset, run the following steps:</p>
          <ol>
            <li>If the <var><a href="#sourcebuffer-append-state">append state</a></var> equals <a href="#sourcebuffer-parsing-media-segment">PARSING_MEDIA_SEGMENT</a> and the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var> contains some
              complete <a href="#coded-frame">coded frames</a>, then run the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a> until all of these complete
              <a href="#coded-frame">coded frames</a> have been processed.</li>
            <li>Unset the <var><a href="#last-decode-timestamp">last decode timestamp</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
            <li>Unset the <var><a href="#last-frame-duration">last frame duration</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
            <li>Unset the <var><a href="#highest-end-timestamp">highest end timestamp</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
            <li>Set the <var><a href="#need-RAP-flag">need random access point flag</a></var> on all <a href="#track-buffer">track buffers</a> to true.</li>
            <li>If the <code><a href="#dom-sourcebuffer-mode">mode</a></code> attribute equals <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code>, then set the <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var> to the <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var></li>
            <li>Remove all bytes from the <var><a href="#sourcebuffer-input-buffer">input buffer</a></var>.</li>
            <li>Set <var><a href="#sourcebuffer-append-state">append state</a></var> to <a href="#sourcebuffer-waiting-for-segment">WAITING_FOR_SEGMENT</a>.</li>
          </ol>
        </section>

        <section id="sourcebuffer-append-error">
          <h4 id="x3-5-3-append-error-algorithm"><bdi class="secno">3.5.3 </bdi>Append Error Algorithm<a class="self-link" aria-label="§" href="#sourcebuffer-append-error"></a></h4>
          <p>This algorithm is called when an error occurs during an append.
          </p><ol>
            <li>Run the <a href="#sourcebuffer-reset-parser-state">reset parser state algorithm</a>.</li>
            <li>Set the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute to false.</li>
            <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-error">error</a></code> at this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
            <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-updateend">updateend</a></code> at this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
            <li>Run the <a href="#end-of-stream-algorithm">end of stream algorithm</a>
              with the <var>error</var> parameter set to <code><a href="#idl-def-EndOfStreamError.decode">"decode"</a></code>.</li>
          </ol>
        </section>

        <section id="sourcebuffer-prepare-append">
            <h4 id="x3-5-4-prepare-append-algorithm"><bdi class="secno">3.5.4 </bdi>Prepare Append Algorithm<a class="self-link" aria-label="§" href="#sourcebuffer-prepare-append"></a></h4>
            <p>When an append operation begins, the follow steps are run to validate and prepare the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>.</p>
            <ol>
            <li>If the <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of the <a href="#parent-media-source">parent media source</a> then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute equals true, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-error">HTMLMediaElement.error</a></code> attribute is not null, then throw an <code><a href="https://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>
            <li>
              <p>If the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> is in the <code><a href="#idl-def-ReadyState.ended">"ended"</a></code> state then run the following steps:</p>
              <ol>
                <li>Set the <code><a href="#dom-readystate">readyState</a></code> attribute of the <a href="#parent-media-source">parent media source</a> to <code><a href="#idl-def-ReadyState.open">"open"</a></code>
                </li>
                <li>
                  <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-sourceopen">sourceopen</a></code> at the <a href="#parent-media-source">parent media source</a>.</li>
              </ol>
            </li>
            <li>Run the <a href="#sourcebuffer-coded-frame-eviction">coded frame eviction algorithm</a>.</li>
            <li>
              <p>If the <var><a href="#sourcebuffer-buffer-full-flag">buffer full flag</a></var> equals true, then throw a <code><a href="https://www.w3.org/TR/WebIDL-1/#quotaexceedederror">QuotaExceededError</a></code> exception and abort these step.</p>
              <div class="note" role="note" id="issue-container-generatedID-39"><div role="heading" class="note-title marker" id="h-note-39" aria-level="5"><span>Note</span></div><p class="">This is the signal that the implementation was unable to evict enough data to accommodate the append or the append is too big. The web
                application <em class="rfc2119" title="SHOULD">SHOULD</em> use <code><a href="#dom-sourcebuffer-remove">remove()</a></code> to explicitly free up space and/or reduce the size of the append.</p></div>
            </li>
            </ol>
        </section>

        <section id="sourcebuffer-buffer-append">
          <h4 id="x3-5-5-buffer-append-algorithm"><bdi class="secno">3.5.5 </bdi>Buffer Append Algorithm<a class="self-link" aria-label="§" href="#sourcebuffer-buffer-append"></a></h4>
          <p>When <code><a href="#dom-sourcebuffer-appendbuffer">appendBuffer()</a></code> is called, the following steps are run to process the appended data.</p>
          <ol>
            <li>Run the <a href="#sourcebuffer-segment-parser-loop">segment parser loop</a> algorithm.</li>
            <li>If the <a href="#sourcebuffer-segment-parser-loop">segment parser loop</a> algorithm in the previous step was aborted, then abort this algorithm.</li>
            <li>Set the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute to false.</li>
            <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-update">update</a></code> at this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
            <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-updateend">updateend</a></code> at this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
          </ol>
        </section>

        <section id="sourcebuffer-range-removal">
          <h4 id="x3-5-6-range-removal"><bdi class="secno">3.5.6 </bdi>Range Removal<a class="self-link" aria-label="§" href="#sourcebuffer-range-removal"></a></h4>
          <p>Follow these steps when a caller needs to initiate a JavaScript visible range removal
            operation that blocks other SourceBuffer updates:</p>
          <ol>
            <li>Let <var>start</var> equal the starting <a href="#presentation-timestamp">presentation timestamp</a> for the removal range, in seconds measured from <a href="#presentation-start-time">presentation start time</a>.</li>
            <li>Let <var>end</var> equal the end <a href="#presentation-timestamp">presentation timestamp</a> for the removal range, in seconds measured from <a href="#presentation-start-time">presentation start time</a>.</li>
            <li>Set the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute to true.</li>
            <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-updatestart">updatestart</a></code> at this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
            <li>Return control to the caller and run the rest of the steps asynchronously.</li>
            <li>Run the <a href="#sourcebuffer-coded-frame-removal">coded frame removal algorithm</a> with <var>start</var> and <var>end</var> as the start and end of the removal range.</li>
            <li>Set the <code><a href="#dom-sourcebuffer-updating">updating</a></code> attribute to false.</li>
            <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-update">update</a></code> at this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
            <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-updateend">updateend</a></code> at this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.</li>
          </ol>
        </section>
        <section id="sourcebuffer-init-segment-received">
          <h4 id="x3-5-7-initialization-segment-received"><bdi class="secno">3.5.7 </bdi>Initialization Segment Received<a class="self-link" aria-label="§" href="#sourcebuffer-init-segment-received"></a></h4>
          <p>The following steps are run when the <a href="#sourcebuffer-segment-parser-loop">segment parser loop</a> successfully parses a complete <a href="#init-segment">initialization segment</a>:</p>
          <p>Each SourceBuffer object has an internal <dfn id="first-init-segment-received-flag" data-dfn-type="dfn">first initialization segment received flag</dfn> that tracks whether the first <a href="#init-segment">initialization segment</a> has been appended and received by this algorithm. This flag is set to false when the SourceBuffer is created and updated by the algorithm below.</p>
          <ol>
            <li>Update the <code><a href="#dom-mediasource-duration">duration</a></code> attribute if it currently equals NaN:
              <dl class="switch">
                <dt>If the initialization segment contains a duration:</dt>
                <dd>Run the <a href="#duration-change-algorithm">duration change algorithm</a> with <var>new duration</var> set to the duration in the initialization segment.</dd>
                <dt>Otherwise:</dt>
                <dd>Run the <a href="#duration-change-algorithm">duration change algorithm</a> with <var>new duration</var> set to positive Infinity.</dd>
              </dl>
            </li>
            <li>If the <a href="#init-segment">initialization segment</a> has no audio, video, or text tracks, then run the <a href="#sourcebuffer-append-error">append error algorithm</a>  and abort these steps.</li>
            <li>If the <var><a href="#first-init-segment-received-flag">first initialization segment received flag</a></var> is true, then run the following steps:
              <ol>
                <li>Verify the following properties. If any of the checks fail then run the <a href="#sourcebuffer-append-error">append error algorithm</a> and abort these steps.
                  <ul>
                    <li>The number of audio, video, and text tracks match what was in the first <a href="#init-segment">initialization segment</a>.</li>
                    <li>The codecs for each track, match what was specified in the first <a href="#init-segment">initialization segment</a>.</li>
                    <li>If more than one track for a single type are present (e.g., 2 audio tracks), then the <a href="#track-id">Track IDs</a> match the ones in the
                      first <a href="#init-segment">initialization segment</a>.</li>
                  </ul>
                </li>
                <li>Add the appropriate <a href="#track-description">track descriptions</a> from this <a href="#init-segment">initialization segment</a> to each of the
                  <a href="#track-buffer">track buffers</a>.</li>
                <li>Set the <var><a href="#need-RAP-flag">need random access point flag</a></var> on all track buffers to true.</li>
              </ol>
            </li>
            <li>Let <var>active track flag</var> equal false.</li>
            <li>
              <p>If the <var><a href="#first-init-segment-received-flag">first initialization segment received flag</a></var> is false, then run the following steps:</p>
              <ol>
                <li>If the <a href="#init-segment">initialization segment</a> contains tracks with codecs the user agent does not support, then run the <a href="#sourcebuffer-append-error">append error algorithm</a> and abort these steps.
                  <div class="note" role="note" id="issue-container-generatedID-40"><div role="heading" class="note-title marker" id="h-note-40" aria-level="5"><span>Note</span></div><p class="">User agents <em class="rfc2119" title="MAY">MAY</em> consider codecs, that would otherwise be supported, as "not supported" here if the codecs were not
                    specified in the <var>type</var> parameter passed to <code><a href="#dom-mediasource-addsourcebuffer">addSourceBuffer()</a></code>. <br>
                    For example, MediaSource.isTypeSupported('video/webm;codecs="vp8,vorbis"') may return true, but if
                    <code><a href="#dom-mediasource-addsourcebuffer">addSourceBuffer()</a></code> was called with 'video/webm;codecs="vp8"' and a Vorbis track appears in the
                    <a href="#init-segment">initialization segment</a>, then the user agent <em class="rfc2119" title="MAY">MAY</em> use this step to trigger a decode error.
                  </p></div>
                </li>
                <li>
                  <p>For each audio track in the <a href="#init-segment">initialization segment</a>, run following steps:</p>
                  <ol>
                    <li>Let <var>audio byte stream track ID</var> be the
                      <a href="#track-id">Track ID</a> for the current track being processed.</li>
                    <li>Let <var>audio language</var> be a BCP 47 language tag for the language
                      specified in the <a href="#init-segment">initialization segment</a> for this track or an empty string if no
                      language info is present.</li>
                    <li>If <var>audio language</var> equals the 'und' BCP 47 value, then assign an empty string to <var>audio language</var>.</li>
                    <li>Let <var>audio label</var> be a label specified in the <a href="#init-segment">initialization segment</a> for this track or an empty string if no
                      label info is present.</li>
                    <li>Let <var>audio kinds</var> be a sequence of kind strings specified in the
                      <a href="#init-segment">initialization segment</a> for this track
                      or a sequence with a single empty string element in it
                      if no kind information is provided.</li>
                    <li>For each value in <var>audio kinds</var>, run the following steps:
                      <ol>
                        <li>Let <var>current audio kind</var> equal the value from <var>audio kinds</var>
                          for this iteration of the loop.</li>
                        <li>Let <var>new audio track</var> be a new <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> object.</li>
                        <li>Generate a unique ID and assign it to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-id">id</a></code> property on <var>new audio track</var>.</li>
                        <li>Assign <var>audio language</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-language">language</a></code>
                          property on <var>new audio track</var>.</li>
                        <li>Assign <var>audio label</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-label">label</a></code>
                          property on <var>new audio track</var>.</li>
                        <li>Assign <var>current audio kind</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-kind">kind</a></code>
                          property on <var>new audio track</var>.</li>
                        <li>
                          <p>
                            If <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-audiotracks">audioTracks</a></code>.<code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotracklist-length">length</a></code> equals 0, then run
                            the following steps:
                          </p>
                          <ol>
                            <li>Set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-audiotrack-enabled">enabled</a></code> property on <var>new audio track</var> to true.</li>
                            <li>Set <var>active track flag</var> to true.</li>
                          </ol>
                        </li>
                        <li>Add <var>new audio track</var> to the <code><a href="#dom-sourcebuffer-audiotracks">audioTracks</a></code> attribute on this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.
                        <div class="note" role="note" id="issue-container-generatedID-41"><div role="heading" class="note-title marker" id="h-note-41" aria-level="5"><span>Note</span></div><p class="">
                          This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onaddtrack">addtrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  <var>new audio track</var>, at the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> object referenced by the <code><a href="#dom-sourcebuffer-audiotracks">audioTracks</a></code> attribute on this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.
                        </p></div>
                        </li>
                        <li>Add <var>new audio track</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-audiotracks">audioTracks</a></code> attribute on the HTMLMediaElement.
                        <div class="note" role="note" id="issue-container-generatedID-42"><div role="heading" class="note-title marker" id="h-note-42" aria-level="5"><span>Note</span></div><p class="">
                          This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onaddtrack">addtrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  <var>new audio track</var>, at the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotracklist-audiotracklist">AudioTrackList</a></code> object referenced by the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-audiotracks">audioTracks</a></code> attribute on the HTMLMediaElement.
                        </p></div>
                        </li>
                      </ol>
                    </li>
                    <li>Create a new <a href="#track-buffer">track buffer</a> to store <a href="#coded-frame">coded frames</a> for this track.</li>
                    <li>Add the <a href="#track-description">track description</a> for this track to the <a href="#track-buffer">track buffer</a>.</li>
                  </ol>
                </li>
                <li>
                  <p>For each video track in the <a href="#init-segment">initialization segment</a>, run following steps:</p>
                  <ol>
                    <li>Let <var>video byte stream track ID</var> be the
                      <a href="#track-id">Track ID</a> for the current track being processed.</li>
                    <li>Let <var>video language</var> be a BCP 47 language tag for the language
                      specified in the <a href="#init-segment">initialization segment</a> for this track or an empty string if no
                      language info is present.</li>
                    <li>If <var>video language</var> equals the 'und' BCP 47 value, then assign an empty string to <var>video language</var>.</li>
                    <li>Let <var>video label</var> be a label specified in the <a href="#init-segment">initialization segment</a> for this track or an empty string if no
                      label info is present.</li>
                    <li>Let <var>video kinds</var> be a sequence of kind strings specified in the
                      <a href="#init-segment">initialization segment</a> for this track
                      or a sequence with a single empty string element in it
                      if no kind information is provided.</li>
                    <li>For each value in <var>video kinds</var>, run the following steps:
                      <ol>
                        <li>Let <var>current video kind</var> equal the value from <var>video kinds</var>
                          for this iteration of the loop.</li>
                        <li>Let <var>new video track</var> be a new <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> object.</li>
                        <li>Generate a unique ID and assign it to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-id">id</a></code> property on <var>new video track</var>.</li>
                        <li>Assign <var>video language</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-language">language</a></code>
                          property on <var>new video track</var>.</li>
                        <li>Assign <var>video label</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-label">label</a></code>
                          property on <var>new video track</var>.</li>
                        <li>Assign <var>current video kind</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-kind">kind</a></code>
                          property on <var>new video track</var>.</li>
                        <li>
                          <p>
                            If <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-videotracks">videoTracks</a></code>.<code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotracklist-length">length</a></code> equals 0, then run
                            the following steps:
                          </p>
                          <ol>
                            <li>Set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-videotrack-selected">selected</a></code> property on <var>new video track</var> to true.</li>
                            <li>Set <var>active track flag</var> to true.</li>
                          </ol>
                        </li>
                        <li>Add <var>new video track</var> to the <code><a href="#dom-sourcebuffer-videotracks">videoTracks</a></code> attribute on this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.
                        <div class="note" role="note" id="issue-container-generatedID-43"><div role="heading" class="note-title marker" id="h-note-43" aria-level="5"><span>Note</span></div><p class="">
                          This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onaddtrack">addtrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  <var>new video track</var>, at the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> object referenced by the <code><a href="#dom-sourcebuffer-videotracks">videoTracks</a></code> attribute on this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.
                        </p></div>
                        </li>
                        <li>Add <var>new video track</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-videotracks">videoTracks</a></code> attribute on the HTMLMediaElement.
                        <div class="note" role="note" id="issue-container-generatedID-44"><div role="heading" class="note-title marker" id="h-note-44" aria-level="5"><span>Note</span></div><p class="">
                          This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-mediatracklist-onaddtrack">addtrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  <var>new video track</var>, at the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotracklist-videotracklist">VideoTrackList</a></code> object referenced by the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-videotracks">videoTracks</a></code> attribute on the HTMLMediaElement.
                        </p></div>
                        </li>
                      </ol>
                    </li>
                    <li>Create a new <a href="#track-buffer">track buffer</a> to store <a href="#coded-frame">coded frames</a> for this track.</li>
                    <li>Add the <a href="#track-description">track description</a> for this track to the <a href="#track-buffer">track buffer</a>.</li>
                  </ol>
                </li>
                <li>
                  <p>For each text track in the <a href="#init-segment">initialization segment</a>, run following steps:</p>
                  <ol>
                    <li>Let <var>text byte stream track ID</var> be the
                      <a href="#track-id">Track ID</a> for the current track being processed.</li>
                    <li>Let <var>text language</var> be a BCP 47 language tag for the language
                      specified in the <a href="#init-segment">initialization segment</a> for this track or an empty string if no
                      language info is present.</li>
                    <li>If <var>text language</var> equals the 'und' BCP 47 value, then assign an empty string to <var>text language</var>.</li>
                    <li>Let <var>text label</var> be a label specified in the <a href="#init-segment">initialization segment</a> for this track or an empty string if no
                      label info is present.</li>
                    <li>Let <var>text kinds</var> be a sequence of kind strings specified in the
                      <a href="#init-segment">initialization segment</a> for this track
                      or a sequence with a single empty string element in it
                      if no kind information is provided.</li>
                    <li>For each value in <var>text kinds</var>, run the following steps:
                      <ol>
                        <li>Let <var>current text kind</var> equal the value from <var>text kinds</var>
                          for this iteration of the loop.</li>
                        <li>
                          Let <var>new text track</var> be a new <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> object.</li>
                        <li>Generate a unique ID and assign it to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-id">id</a></code> property on <var>new text track</var>.</li>
                        <li>Assign <var>text language</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-language">language</a></code>
                          property on <var>new text track</var>.</li>
                        <li>Assign <var>text label</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-label">label</a></code>
                          property on <var>new text track</var>.</li>
                        <li>Assign <var>current text kind</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-kind">kind</a></code>
                          property on <var>new text track</var>.</li>
                        <li>Populate the remaining properties on <var>new text track</var> with the
                          appropriate information from the <a href="#init-segment">initialization segment</a>.
                        </li><li>
                          If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrack-mode">mode</a></code> property on <var>new text track</var> equals <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-showing">"showing"</a></code> or
                          <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttrackmode-hidden">"hidden"</a></code>, then set <var>active track flag</var> to true.
                        </li>
                        <li>Add <var>new text track</var> to the <code><a href="#dom-sourcebuffer-texttracks">textTracks</a></code> attribute on this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.
                        <div class="note" role="note" id="issue-container-generatedID-45"><div role="heading" class="note-title marker" id="h-note-45" aria-level="5"><span>Note</span></div><p class="">
                          This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttracklist-onaddtrack">addtrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  <var>new text track</var>, at the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> object referenced by the <code><a href="#dom-sourcebuffer-texttracks">textTracks</a></code> attribute on this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object.
                        </p></div>
                        </li>
                        <li>Add <var>new text track</var> to the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-texttracks">textTracks</a></code> attribute on the HTMLMediaElement.
                        <div class="note" role="note" id="issue-container-generatedID-46"><div role="heading" class="note-title marker" id="h-note-46" aria-level="5"><span>Note</span></div><p class="">
                          This should trigger <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to fire a <a href="https://www.w3.org/TR/html51/infrastructure.html#trusted">trusted event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-texttracklist-onaddtrack">addtrack</a></code>, that does not bubble and is not cancelable, and that uses the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#trackevent-trackevent">TrackEvent</a></code> interface, with the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-trackevent-track">track</a></code> attribute initialized to  <var>new text track</var>, at the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttracklist-texttracklist">TextTrackList</a></code> object referenced by the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-texttracks">textTracks</a></code> attribute on the HTMLMediaElement.
                        </p></div>
                        </li>
                      </ol>
                    </li>
                    <li>Create a new <a href="#track-buffer">track buffer</a> to store <a href="#coded-frame">coded frames</a> for this track.</li>
                    <li>Add the <a href="#track-description">track description</a> for this track to the <a href="#track-buffer">track buffer</a>.</li>
                  </ol>
                </li>
                <li>If <var>active track flag</var> equals true, then run the following steps:
                  <ol>
                    <li>Add this <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> to <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.</li>
                    <li><a href="https://www.w3.org/TR/html51/webappapis.html#queuing">Queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="#dom-evt-addsourcebuffer">addsourcebuffer</a></code> at <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code></li>
                  </ol>
                </li>
                <li>Set <var><a href="#first-init-segment-received-flag">first initialization segment received flag</a></var> to true.</li>
              </ol>
            </li>
            <li>
              <p>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute is <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_nothing">HAVE_NOTHING</a></code>, then run the following steps:</p>
              <ol>
                <li>
                  If one or more objects in <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> have <var><a href="#first-init-segment-received-flag">first initialization segment received flag</a></var> set to false, then abort
                  these steps.</li>
                <li>Set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code>.
                <div class="note" role="note" id="issue-container-generatedID-47"><div role="heading" class="note-title marker" id="h-note-47" aria-level="5"><span>Note</span></div><p class="">
                  Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement. This particular transition should trigger HTMLMediaElement logic to <a href="https://www.w3.org/TR/html51/webappapis.html#queuing">queue a task</a> to <a href="https://www.w3.org/TR/html51/infrastructure.html#fire">fire a simple event</a> named <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#eventdef-media-loadedmetadata">loadedmetadata</a></code> at the media element.
                </p></div>
                </li>
              </ol>
            </li>
            <li>
              If the <var>active track flag</var> equals true and the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute is greater than
              <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_current_data">HAVE_CURRENT_DATA</a></code>, then set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code>.
            <div class="note" role="note" id="issue-container-generatedID-48"><div role="heading" class="note-title marker" id="h-note-48" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div>
            </li>
          </ol>
        </section>

        <section id="sourcebuffer-coded-frame-processing">
          <h4 id="x3-5-8-coded-frame-processing"><bdi class="secno">3.5.8 </bdi>Coded Frame Processing<a class="self-link" aria-label="§" href="#sourcebuffer-coded-frame-processing"></a></h4>
          <p>When complete <a href="#coded-frame">coded frames</a> have been parsed by the <a href="#sourcebuffer-segment-parser-loop">segment parser loop</a> then the following steps are run:</p>
          <ol>
            <li>
              <p>For each <a href="#coded-frame">coded frame</a> in the <a href="#media-segment">media segment</a> run the following steps:</p>
              <ol>
                <li><i>Loop Top: </i><dl class="switch">
                    <dt>If <var><a href="#sourcebuffer-generate-timestamps-flag">generate timestamps flag</a></var> equals true:</dt>
                    <dd>
                      <ol>
                        <li>Let <var>presentation timestamp</var> equal 0.</li>
                        <li>Let <var>decode timestamp</var> equal 0.</li>
                      </ol>
                    </dd>
                    <dt>Otherwise:</dt>
                    <dd>
                      <ol>
                        <li>Let <var>presentation timestamp</var> be a double precision floating point representation of the coded frame's <a href="#presentation-timestamp">presentation timestamp</a> in seconds.
                          <div class="note" role="note" id="issue-container-generatedID-49"><div role="heading" class="note-title marker" id="h-note-49" aria-level="5"><span>Note</span></div><p class="">Special processing may be needed to determine the presentation and decode timestamps for timed text frames since this information may not be explicitly
                            present in the underlying format or may be dependent on the order of the frames. Some metadata text tracks, like MPEG2-TS PSI data, may only have implied timestamps.
                            Format specific rules for these situations <em class="rfc2119" title="SHOULD">SHOULD</em> be in the <a href="#byte-stream-format-specs">byte stream format specifications</a> or in separate extension specifications.</p></div>
                        </li>
                        <li>Let <var>decode timestamp</var> be a double precision floating point representation of the coded frame's decode timestamp in seconds.
                          <div class="note" role="note" id="issue-container-generatedID-50"><div role="heading" class="note-title marker" id="h-note-50" aria-level="5"><span>Note</span></div><p class="">Implementations don't have to internally store timestamps in a double precision floating point representation. This
                            representation is used here because it is the represention for timestamps in the HTML spec. The intention here is to make the
                            behavior clear without adding unnecessary complexity to the algorithm to deal with the fact that adding a timestampOffset may
                            cause a timestamp rollover in the underlying timestamp representation used by the byte stream format. Implementations can use any
                            internal timestamp representation they wish, but the addition of timestampOffset <em class="rfc2119" title="SHOULD">SHOULD</em> behave in a similar manner to what would happen
                            if a double precision floating point representation was used.
                          </p></div>
                        </li>
                    </ol>
                    </dd>
                  </dl>
                </li>
                <li>Let <var>frame duration</var> be a double precision floating point representation of the <a href="#coded-frame-duration">coded frame's duration</a> in seconds.</li>
                <li>If <code><a href="#dom-sourcebuffer-mode">mode</a></code> equals <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code> and <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var> is set, then run the following steps:
                  <ol>
                    <li>Set <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> equal to <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var> - <var>presentation timestamp</var>.</li>
                    <li>Set <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var> equal to <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var>.</li>
                    <li>Set the <var><a href="#need-RAP-flag">need random access point flag</a></var> on all <a href="#track-buffer">track buffers</a> to true.</li>
                    <li>Unset <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var>.</li>
                  </ol>
                </li>
                <li>
                  <p>If <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> is not 0, then run the following steps:</p>
                  <ol>
                    <li>Add <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> to the <var>presentation timestamp</var>.</li>
                    <li>Add <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> to the <var>decode timestamp</var>.</li>
                  </ol>
                </li>
                <li>Let <var>track buffer</var> equal the <a href="#track-buffer">track buffer</a> that the coded frame will be added to.</li>
                <li>
                  <dl class="switch">
                    <dt>If <var><a href="#last-decode-timestamp">last decode timestamp</a></var> for <var>track buffer</var> is set and <var>decode timestamp</var> is less than
                      <var><a href="#last-decode-timestamp">last decode timestamp</a></var>:</dt>
                    <dd>OR</dd>
                    <dt>If <var><a href="#last-decode-timestamp">last decode timestamp</a></var> for <var>track buffer</var> is set and the difference between <var>decode timestamp</var> and <var><a href="#last-decode-timestamp">last decode timestamp</a></var>
                      is greater than 2 times <var><a href="#last-frame-duration">last frame duration</a></var>:</dt>
                    <dd>
                      <ol>
                        <li>
                          <dl class="switch">
                            <dt>If <code><a href="#dom-sourcebuffer-mode">mode</a></code> equals <code><a href="#idl-def-AppendMode.segments">"segments"</a></code>:</dt>
                            <dd>Set <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var> to <var>presentation timestamp</var>.</dd>
                            <dt>If <code><a href="#dom-sourcebuffer-mode">mode</a></code> equals <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code>:</dt>
                            <dd>Set <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var> equal to the <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var>.</dd>
                          </dl>
                        </li>
                        <li>Unset the <var><a href="#last-decode-timestamp">last decode timestamp</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
                        <li>Unset the <var><a href="#last-frame-duration">last frame duration</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
                        <li>Unset the <var><a href="#highest-end-timestamp">highest end timestamp</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
                        <li>Set the <var><a href="#need-RAP-flag">need random access point flag</a></var> on all <a href="#track-buffer">track buffers</a> to true.</li>
                        <li>Jump to the <i>Loop Top</i> step above to restart processing of the current <a href="#coded-frame">coded frame</a>.</li>
                      </ol>
                    </dd>
                    <dt>Otherwise:</dt>
                    <dd>Continue.</dd>
                  </dl>
                </li>
                <li>Let <var>frame end timestamp</var> equal the sum of <var>presentation timestamp</var> and <var>frame duration</var>.</li>
                <li>If <var>presentation timestamp</var> is less than <code><a href="#dom-sourcebuffer-appendwindowstart">appendWindowStart</a></code>, then set the <var><a href="#need-RAP-flag">need random access point flag</a></var> to true, drop the
                  coded frame, and jump to the top of the loop to start processing the next coded frame.
                  <div class="note" role="note" id="issue-container-generatedID-51"><div role="heading" class="note-title marker" id="h-note-51" aria-level="5"><span>Note</span></div><p class="">Some implementations <em class="rfc2119" title="MAY">MAY</em> choose to collect some of these coded frames with <var>presentation timestamp</var> less than <code><a href="#dom-sourcebuffer-appendwindowstart">appendWindowStart</a></code> and use them
                    to generate a splice at the first coded frame that has a <a href="#presentation-timestamp">presentation timestamp</a> greater than or equal to <code><a href="#dom-sourcebuffer-appendwindowstart">appendWindowStart</a></code> even if
                    that frame is not a <a href="#random-access-point">random access point</a>. Supporting this requires multiple decoders or faster than real-time decoding so for now
                    this behavior will not be a normative requirement.
                  </p></div>
                </li>
                <li>If <var>frame end timestamp</var> is greater than <code><a href="#dom-sourcebuffer-appendwindowend">appendWindowEnd</a></code>, then set the <var><a href="#need-RAP-flag">need random access point flag</a></var> to true, drop the
                  coded frame, and jump to the top of the loop to start processing the next coded frame.
                  <div class="note" role="note" id="issue-container-generatedID-52"><div role="heading" class="note-title marker" id="h-note-52" aria-level="5"><span>Note</span></div><p class="">Some implementations <em class="rfc2119" title="MAY">MAY</em> choose to collect coded frames with <var>presentation timestamp</var> less than <code><a href="#dom-sourcebuffer-appendwindowend">appendWindowEnd</a></code> and <var>frame end timestamp</var> greater than <code><a href="#dom-sourcebuffer-appendwindowend">appendWindowEnd</a></code> and use them
                  to generate a splice across the portion of the collected coded frames within the append window at time of collection, and the beginning portion of later processed frames which only partially overlap the end of the collected coded frames.
                    Supporting this requires multiple decoders or faster than real-time decoding so for now
                    this behavior will not be a normative requirement.
                    In conjunction with collecting coded frames that span <code><a href="#dom-sourcebuffer-appendwindowstart">appendWindowStart</a></code>, implementations <em class="rfc2119" title="MAY">MAY</em> thus support gapless audio splicing.
                  </p></div>
                </li>
                <li>If the <var><a href="#need-RAP-flag">need random access point flag</a></var> on <var>track buffer</var> equals true, then run the following steps:
                  <ol>
                    <li>If the coded frame is not a <a href="#random-access-point">random access point</a>, then drop the coded frame and jump to the top of the loop to start
                      processing the next coded frame.</li>
                    <li>Set the <var><a href="#need-RAP-flag">need random access point flag</a></var> on <var>track buffer</var> to false.</li>
                  </ol>
                </li>
                <li>Let <var>spliced audio frame</var> be an unset variable for holding audio splice information</li>
                <li>Let <var>spliced timed text frame</var> be an unset variable for holding timed text splice information</li>
                <li>If <var><a href="#last-decode-timestamp">last decode timestamp</a></var> for <var>track buffer</var> is unset and <var>presentation timestamp</var> falls within the <a href="#presentation-interval">presentation interval</a> of a <a href="#coded-frame">coded frame</a> in <var>track buffer</var>, then run the following steps:
                  <ol>
                    <li>Let <var>overlapped frame</var> be the <a href="#coded-frame">coded frame</a> in <var>track buffer</var> that matches the condition above.</li>
                    <li>
                      <dl class="switch">
                        <dt>If <var>track buffer</var> contains audio <a href="#coded-frame">coded frames</a>:</dt>
                        <dd>Run the <a href="#sourcebuffer-audio-splice-frame-algorithm">audio splice frame algorithm</a> and if a splice frame is returned, assign it to <var>spliced audio frame</var>.</dd>
                        <dt>If <var>track buffer</var> contains video <a href="#coded-frame">coded frames</a>:</dt>
                        <dd>
                          <ol>
                            <li>Let <var>remove window timestamp</var> equal the <var>overlapped frame</var> <a href="#presentation-timestamp">presentation timestamp</a> plus 1 microsecond.</li>
                            <li>If the <var>presentation timestamp</var> is less than the <var>remove window timestamp</var>, then remove <var>overlapped frame</var> from <var>track buffer</var>.
                              <div class="note" role="note" id="issue-container-generatedID-53"><div role="heading" class="note-title marker" id="h-note-53" aria-level="5"><span>Note</span></div><p class="">
                                This is to compensate for minor errors in frame timestamp computations that can appear when converting back and forth between double precision
                                floating point numbers and rationals. This tolerance allows a frame to replace an existing one as long as it is within 1 microsecond of the existing
                                frame's start time. Frames that come slightly before an existing frame are handled by the removal step below.
                              </p></div>
                            </li>
                          </ol>
                        </dd>
                        <dt>If <var>track buffer</var> contains timed text <a href="#coded-frame">coded frames</a>:</dt>
                        <dd>Run the <a href="#sourcebuffer-text-splice-frame-algorithm">text splice frame algorithm</a> and if a splice frame is returned, assign it to <var>spliced timed text frame</var>.</dd>
                      </dl>
                    </li>
                  </ol>
                </li>
                <li>Remove existing coded frames in <var>track buffer</var>:
                  <dl class="switch">
                    <dt>If <var><a href="#highest-end-timestamp">highest end timestamp</a></var> for <var>track buffer</var> is not set:</dt>
                    <dd>Remove all <a href="#coded-frame">coded frames</a> from <var>track buffer</var> that have a <a href="#presentation-timestamp">presentation timestamp</a> greater than or equal to
                      <var>presentation timestamp</var> and less than <var>frame end timestamp</var>.</dd>
                    <dt>If <var><a href="#highest-end-timestamp">highest end timestamp</a></var> for <var>track buffer</var> is set and less than or equal to <var>presentation timestamp</var>:</dt>
                    <dd>Remove all <a href="#coded-frame">coded frames</a> from <var>track buffer</var> that have a <a href="#presentation-timestamp">presentation timestamp</a> greater than
                      or equal to <var><a href="#highest-end-timestamp">highest end timestamp</a></var> and less than <var>frame end timestamp</var></dd>
                  </dl>
                </li>
                <li>Remove all possible decoding dependencies on the <a href="#coded-frame">coded frames</a> removed in the previous two steps
                  by removing all <a href="#coded-frame">coded frames</a> from <var>track buffer</var> between those frames removed in the previous two steps and the next
                  <a href="#random-access-point">random access point</a> after those removed frames.
                  <div class="note" role="note" id="issue-container-generatedID-54"><div role="heading" class="note-title marker" id="h-note-54" aria-level="5"><span>Note</span></div><p class="">Removing all <a href="#coded-frame">coded frames</a> until the next <a href="#random-access-point">random access point</a> is a conservative
                    estimate of the decoding dependencies since it assumes all frames between the removed frames and the next random access point
                    depended on the frames that were removed.
                  </p></div>
                </li>
                <li>
                  <dl class="switch">
                    <dt>If <var>spliced audio frame</var> is set:</dt>
                    <dd>Add <var>spliced audio frame</var> to the <var>track buffer</var>.</dd>
                    <dt>If <var>spliced timed text frame</var> is set:</dt>
                    <dd>Add <var>spliced timed text frame</var> to the <var>track buffer</var>.</dd>
                    <dt>Otherwise:</dt>
                    <dd>Add the <a href="#coded-frame">coded frame</a> with the <var>presentation timestamp</var>, <var>decode timestamp</var>, and <var>frame duration</var> to the
                      <var>track buffer</var>.</dd>
                  </dl>
                </li><li>Set <var><a href="#last-decode-timestamp">last decode timestamp</a></var> for <var>track buffer</var> to <var>decode timestamp</var>.</li>
                <li>Set <var><a href="#last-frame-duration">last frame duration</a></var> for <var>track buffer</var> to <var>frame duration</var>.</li>
                <li>If <var><a href="#highest-end-timestamp">highest end timestamp</a></var> for <var>track buffer</var> is unset or <var>frame end timestamp</var> is greater
                  than <var><a href="#highest-end-timestamp">highest end timestamp</a></var>, then set <var><a href="#highest-end-timestamp">highest end timestamp</a></var> for <var>track buffer</var>
                  to <var>frame end timestamp</var>.
                  <div class="note" role="note" id="issue-container-generatedID-55"><div role="heading" class="note-title marker" id="h-note-55" aria-level="5"><span>Note</span></div><p class="">The greater than check is needed because bidirectional prediction between coded frames can cause
                    <var>presentation timestamp</var> to not be monotonically increasing even though the decode timestamps are monotonically increasing.</p></div>
                </li>
                <li>If <var>frame end timestamp</var> is greater than <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var>,
                  then set <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var> equal to <var>frame end timestamp</var>.</li>
                <li>If <var><a href="#sourcebuffer-generate-timestamps-flag">generate timestamps flag</a></var> equals true, then set
                  <code><a href="#dom-sourcebuffer-timestampoffset">timestampOffset</a></code> equal to <var>frame end timestamp</var>.</li>
              </ol>
            </li>
            <li>
              <p>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute is <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code> and the new <a href="#coded-frame">coded frames</a> cause <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> to have a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> for the current playback position, then set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_current_data">HAVE_CURRENT_DATA</a></code>.</p>
              <div class="note" role="note" id="issue-container-generatedID-56"><div role="heading" class="note-title marker" id="h-note-56" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div>
            </li>
            <li>
              <p>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute is <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_current_data">HAVE_CURRENT_DATA</a></code> and the new <a href="#coded-frame">coded frames</a> cause <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> to have a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> that includes the current playback position and some time beyond the current playback position, then set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_future_data">HAVE_FUTURE_DATA</a></code>.</p>
              <div class="note" role="note" id="issue-container-generatedID-57"><div role="heading" class="note-title marker" id="h-note-57" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div>
            </li>
            <li>
              <p>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute is <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_future_data">HAVE_FUTURE_DATA</a></code> and the new <a href="#coded-frame">coded frames</a> cause <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> to have a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> that includes the current playback position and <a href="#enough-data">enough data to ensure uninterrupted playback</a>, then set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_enough_data">HAVE_ENOUGH_DATA</a></code>.</p>
              <div class="note" role="note" id="issue-container-generatedID-58"><div role="heading" class="note-title marker" id="h-note-58" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div>
            </li>
            <li>If the <a href="#media-segment">media segment</a> contains data beyond the current <code><a href="#dom-mediasource-duration">duration</a></code>, then run the <a href="#duration-change-algorithm">duration change algorithm</a> with <var>new duration</var> set to the maximum of the current duration and the <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var>.</li>
          </ol>
        </section>

        <section id="sourcebuffer-coded-frame-removal">
          <h4 id="x3-5-9-coded-frame-removal-algorithm"><bdi class="secno">3.5.9 </bdi>Coded Frame Removal Algorithm<a class="self-link" aria-label="§" href="#sourcebuffer-coded-frame-removal"></a></h4>
          <p>Follow these steps when <a href="#coded-frame">coded frames</a> for a specific time range need to be removed from the SourceBuffer:</p>
          <ol>
            <li>Let <var>start</var> be the starting <a href="#presentation-timestamp">presentation timestamp</a> for the removal range.</li>
            <li>Let <var>end</var> be the end <a href="#presentation-timestamp">presentation timestamp</a> for the removal range. </li>
            <li><p>For each <a href="#track-buffer">track buffer</a> in this source buffer, run the following steps:</p>
              <ol>
                <li>Let <var>remove end timestamp</var> be the current value of <code><a href="#dom-mediasource-duration">duration</a></code></li>
                <li>
                  <p>If this <a href="#track-buffer">track buffer</a> has a <a href="#random-access-point">random access point</a> timestamp that is greater than or equal to
                    <var>end</var>, then update <var>remove end timestamp</var> to that random access point timestamp.</p>
                  <div class="note" role="note" id="issue-container-generatedID-59"><div role="heading" class="note-title marker" id="h-note-59" aria-level="5"><span>Note</span></div><p class="">Random access point timestamps can be different across tracks because the dependencies between <a href="#coded-frame">coded frames</a> within a
                    track are usually different than the dependencies in another track.</p></div>
                </li>
                <li>Remove all media data, from this <a href="#track-buffer">track buffer</a>, that contain starting timestamps greater than or equal to <var>start</var> and less than the <var>remove end timestamp</var>.
                <ol>
                  <li><p>For each removed frame, if the frame has a <a href="#decode-timestamp">decode timestamp</a> equal to the <var><a href="#last-decode-timestamp">last decode timestamp</a></var> for the frame's track, run the following steps:</p>
                    <dl class="switch">
                      <dt>If <code><a href="#dom-sourcebuffer-mode">mode</a></code> equals <code><a href="#idl-def-AppendMode.segments">"segments"</a></code>:</dt>
                      <dd>Set <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var> to <a href="#presentation-timestamp">presentation timestamp</a>.</dd>
                      <dt>If <code><a href="#dom-sourcebuffer-mode">mode</a></code> equals <code><a href="#idl-def-AppendMode.sequence">"sequence"</a></code>:</dt>
                      <dd>Set <var><a href="#sourcebuffer-group-start-timestamp">group start timestamp</a></var> equal to the <var><a href="#sourcebuffer-group-end-timestamp">group end timestamp</a></var>.</dd>
                    </dl>
                  </li>
                  <li>Unset the <var><a href="#last-decode-timestamp">last decode timestamp</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
                  <li>Unset the <var><a href="#last-frame-duration">last frame duration</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
                  <li>Unset the <var><a href="#highest-end-timestamp">highest end timestamp</a></var> on all <a href="#track-buffer">track buffers</a>.</li>
                  <li>Set the <var><a href="#need-RAP-flag">need random access point flag</a></var> on all <a href="#track-buffer">track buffers</a> to true.</li>
                </ol>
                </li>
                <li>Remove all possible decoding dependencies on the <a href="#coded-frame">coded frames</a> removed in the previous step
                  by removing all <a href="#coded-frame">coded frames</a> from this <a href="#track-buffer">track buffer</a> between those frames removed in the previous step and the next
                  <a href="#random-access-point">random access point</a> after those removed frames.
                  <div class="note" role="note" id="issue-container-generatedID-60"><div role="heading" class="note-title marker" id="h-note-60" aria-level="5"><span>Note</span></div><p class="">Removing all <a href="#coded-frame">coded frames</a> until the next <a href="#random-access-point">random access point</a> is a conservative
                    estimate of the decoding dependencies since it assumes all frames between the removed frames and the next random access point
                    depended on the frames that were removed.
                  </p></div>
                </li>
                <li>
                  <p>If this object is in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>, the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#current-position">current playback position</a> is greater than or equal to
                    <var>start</var> and less than the <var>remove end timestamp</var>, and <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> is greater than
                    <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code>, then set the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> attribute to <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-have_metadata">HAVE_METADATA</a></code> and stall playback.</p>
                  <div class="note" role="note" id="issue-container-generatedID-61"><div role="heading" class="note-title marker" id="h-note-61" aria-level="5"><span>Note</span></div><p class="">Per <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#ready-states">HTMLMediaElement ready states</a></code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-html51" title="HTML 5.1 2nd Edition">HTML51</a></cite>] logic, <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-readystate">HTMLMediaElement.readyState</a></code> changes may trigger events on the HTMLMediaElement.</p></div>
                  <div class="note" role="note" id="issue-container-generatedID-62"><div role="heading" class="note-title marker" id="h-note-62" aria-level="5"><span>Note</span></div><p class="">This transition occurs because media data for the current position has been removed. Playback cannot progress until media for the
                    <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#current-position">current playback position</a> is appended or the <a href="#active-source-buffer-changes">selected/enabled tracks change</a>.</p></div>
                </li>
              </ol>
            </li>
            <li>If <var><a href="#sourcebuffer-buffer-full-flag">buffer full flag</a></var> equals true and this object is ready to accept more bytes, then set
              the <var><a href="#sourcebuffer-buffer-full-flag">buffer full flag</a></var> to false.</li>
          </ol>
        </section>

        <section id="sourcebuffer-coded-frame-eviction">
          <h4 id="x3-5-10-coded-frame-eviction-algorithm"><bdi class="secno">3.5.10 </bdi>Coded Frame Eviction Algorithm<a class="self-link" aria-label="§" href="#sourcebuffer-coded-frame-eviction"></a></h4>
          <p>This algorithm is run to free up space in this source buffer when new data is appended.</p>
          <ol>
            <li>Let <var>new data</var> equal the data that is about to be appended to this SourceBuffer.</li>
            <li>If the <var><a href="#sourcebuffer-buffer-full-flag">buffer full flag</a></var> equals false, then abort these steps.</li>
            <li>Let <var>removal ranges</var> equal a list of presentation time ranges that can be evicted from the presentation to make room for the
              <var>new data</var>.
              <div class="note" role="note" id="issue-container-generatedID-63"><div role="heading" class="note-title marker" id="h-note-63" aria-level="5"><span>Note</span></div><p class="">Implementations <em class="rfc2119" title="MAY">MAY</em> use different methods for selecting <var>removal ranges</var> so web applications <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> depend on a
                specific behavior. The web application can use the <code><a href="#dom-sourcebuffer-buffered">buffered</a></code> attribute to observe whether portions of the buffered data have been evicted.
              </p></div>
            </li>
            <li>For each range in <var>removal ranges</var>, run the <a href="#sourcebuffer-coded-frame-removal">coded frame removal algorithm</a> with <var>start</var> and <var>end</var> equal to
              the removal range start and end timestamp respectively.</li>
          </ol>
        </section>

        <section id="sourcebuffer-audio-splice-frame-algorithm">
          <h4 id="x3-5-11-audio-splice-frame-algorithm"><bdi class="secno">3.5.11 </bdi>Audio Splice Frame Algorithm<a class="self-link" aria-label="§" href="#sourcebuffer-audio-splice-frame-algorithm"></a></h4>
          <p>Follow these steps when the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a> needs to generate a splice frame for two overlapping audio
            <a href="#coded-frame">coded frames</a>:</p>
          <ol>
            <li>Let <var>track buffer</var> be the <a href="#track-buffer">track buffer</a> that will contain the splice.</li>
            <li>Let <var>new coded frame</var> be the new <a href="#coded-frame">coded frame</a>, that is being added to <var>track buffer</var>, which triggered the need for a splice.</li>
            <li>Let <var>presentation timestamp</var> be the <a href="#presentation-timestamp">presentation timestamp</a> for <var>new coded frame</var></li>
            <li>Let <var>decode timestamp</var> be the decode timestamp for <var>new coded frame</var>.</li>
            <li>Let <var>frame duration</var> be the <a href="#coded-frame-duration">coded frame duration</a> of <var>new coded frame</var>.</li>
            <li>Let <var>overlapped frame</var> be the <a href="#coded-frame">coded frame</a> in <var>track buffer</var> with a <a href="#presentation-interval">presentation interval</a> that contains <var>presentation timestamp</var>.
            </li>
            <li>Update <var>presentation timestamp</var> and <var>decode timestamp</var> to the nearest audio sample timestamp based on sample rate of the
              audio in <var>overlapped frame</var>. If a timestamp is equidistant from both audio sample timestamps, then use the higher timestamp (e.g.,
              <code>floor(x * sample_rate + 0.5) / sample_rate</code>).
              <div class="note" role="note" id="issue-container-generatedID-64"><div role="heading" class="note-title marker" id="h-note-64" aria-level="5"><span>Note</span></div><div class="">
                <p>For example, given the following values:</p>
                <ul>
                  <li>The <a href="#presentation-timestamp">presentation timestamp</a> of <var>overlapped frame</var> equals 10.</li>
                  <li>The sample rate of <var>overlapped frame</var> equals 8000 Hz</li>
                  <li><var>presentation timestamp</var> equals 10.01255</li>
                  <li><var>decode timestamp</var> equals 10.01255</li>
                </ul>
                <p><var>presentation timestamp</var> and <var>decode timestamp</var> are updated to 10.0125 since 10.01255 is closer to
                10 + 100/8000 (10.0125) than 10 + 101/8000 (10.012625)</p>
              </div></div>
            </li>
            <li>If the user agent does not support crossfading then run the following steps:
              <ol>
                <li>Remove <var>overlapped frame</var> from <var>track buffer</var>.</li>
                <li>Add a silence frame to <var>track buffer</var> with the following properties:
                  <ul>
                    <li>The <a href="#presentation-timestamp">presentation timestamp</a> set to the <var>overlapped frame</var> <a href="#presentation-timestamp">presentation timestamp</a>.</li>
                    <li>The <a href="#decode-timestamp">decode timestamp</a> set to the <var>overlapped frame</var> <a href="#decode-timestamp">decode timestamp</a>.</li>
                    <li>The <a href="#coded-frame-duration">coded frame duration</a> set to difference between <var>presentation timestamp</var> and the <var>overlapped frame</var> <a href="#presentation-timestamp">presentation timestamp</a>.</li>
                  </ul>
                  <div class="note" role="note" id="issue-container-generatedID-65"><div role="heading" class="note-title marker" id="h-note-65" aria-level="5"><span>Note</span></div><p class="">
                    Some implementations <em class="rfc2119" title="MAY">MAY</em> apply fades to/from silence to coded frames on either side of the inserted silence to make the transition less
                    jarring.
                  </p></div>
                </li>
                <li>Return to caller without providing a splice frame.
                  <div class="note" role="note" id="issue-container-generatedID-66"><div role="heading" class="note-title marker" id="h-note-66" aria-level="5"><span>Note</span></div><p class="">
                    This is intended to allow <var>new coded frame</var> to be added to the <var>track buffer</var> as if
                    <var>overlapped frame</var> had not been in the <var>track buffer</var> to begin with.
                  </p></div>
                </li>
              </ol>
            </li>
            <li>Let <var>frame end timestamp</var> equal the sum of <var>presentation timestamp</var> and <var>frame duration</var>.</li>
            <li>Let <var>splice end timestamp</var> equal the sum of <var>presentation timestamp</var> and the splice duration of 5 milliseconds.</li>
            <li>Let <var>fade out coded frames</var> equal <var>overlapped frame</var> as well as any additional frames in <var>track buffer</var> that
              have a <a href="#presentation-timestamp">presentation timestamp</a> greater than <var>presentation timestamp</var> and less than <var>splice end timestamp</var>.</li>
            <li>Remove all the frames included in <var>fade out coded frames</var> from <var>track buffer</var>.
            </li><li>Return a splice frame with the following properties:
              <ul>
                <li>The <a href="#presentation-timestamp">presentation timestamp</a> set to the <var>overlapped frame</var> <a href="#presentation-timestamp">presentation timestamp</a>.</li>
                <li>The <a href="#decode-timestamp">decode timestamp</a> set to the <var>overlapped frame</var> <a href="#decode-timestamp">decode timestamp</a>.</li>
                <li>The <a href="#coded-frame-duration">coded frame duration</a> set to difference between <var>frame end timestamp</var> and the <var>overlapped frame</var> <a href="#presentation-timestamp">presentation timestamp</a>.</li>
                <li>The fade out coded frames equals <var>fade-out coded frames</var>.</li>
                <li>The fade in coded frame equal <var>new coded frame</var>.
                  <div class="note" role="note" id="issue-container-generatedID-67"><div role="heading" class="note-title marker" id="h-note-67" aria-level="5"><span>Note</span></div><p class="">If the <var>new coded frame</var> is less than 5 milliseconds in duration, then coded frames that are appended after the
                    <var>new coded frame</var> will be needed to properly render the splice.</p></div>
                </li>
                <li>The splice timestamp equals <var>presentation timestamp</var>.</li>
              </ul>
              <div class="note" role="note" id="issue-container-generatedID-68"><div role="heading" class="note-title marker" id="h-note-68" aria-level="5"><span>Note</span></div><p class="">See the <a href="#sourcebuffer-audio-splice-rendering-algorithm">audio splice rendering algorithm</a> for details on how this splice frame is rendered.</p></div>
            </li>
          </ol>
        </section>
        <section id="sourcebuffer-audio-splice-rendering-algorithm">
          <h4 id="x3-5-12-audio-splice-rendering-algorithm"><bdi class="secno">3.5.12 </bdi>Audio Splice Rendering Algorithm<a class="self-link" aria-label="§" href="#sourcebuffer-audio-splice-rendering-algorithm"></a></h4>
          <p>The following steps are run when a spliced frame, generated by the <a href="#sourcebuffer-audio-splice-frame-algorithm">audio splice frame algorithm</a>, needs to be rendered by the
            media element:</p>
          <ol>
            <li>Let <var>fade out coded frames</var> be the <a href="#coded-frame">coded frames</a> that are faded out during the splice.</li>
            <li>Let <var>fade in coded frames</var> be the <a href="#coded-frame">coded frames</a> that are faded in during the splice.</li>
            <li>Let <var>presentation timestamp</var> be the <a href="#presentation-timestamp">presentation timestamp</a> of the first coded frame in <var>fade out coded frames</var>.</li>
            <li>Let <var>end timestamp</var> be the sum of the <a href="#presentation-timestamp">presentation timestamp</a> and the <a href="#coded-frame-duration">coded frame duration</a> of the last frame in <var>fade in coded frames</var>.</li>
            <li>Let <var>splice timestamp</var> be the <a href="#presentation-timestamp">presentation timestamp</a> where the splice starts. This corresponds with the <a href="#presentation-timestamp">presentation timestamp</a> of the first frame in
              <var>fade in coded frames</var>.</li>
            <li>Let <var>splice end timestamp</var> equal <var>splice timestamp</var> plus five milliseconds.</li>
            <li>Let <var>fade out samples</var> be the samples generated by decoding <var>fade out coded frames</var>.</li>
            <li>Trim <var>fade out samples</var> so that it only contains samples between <var>presentation timestamp</var> and <var>splice end timestamp</var>.</li>
            <li>Let <var>fade in samples</var> be the samples generated by decoding <var>fade in coded frames</var>.</li>
            <li>If <var>fade out samples</var> and <var>fade in samples</var> do not have a common sample rate and channel layout, then convert
              <var>fade out samples</var> and <var>fade in samples</var> to a common sample rate and channel layout.</li>
            <li>Let <var>output samples</var> be a buffer to hold the output samples.</li>
            <li>Apply a linear gain fade out with a starting gain of 1 and an ending gain of 0 to the samples between
              <var>splice timestamp</var> and <var>splice end timestamp</var> in <var>fade out samples</var>.</li>
            <li>Apply a linear gain fade in with a starting gain of 0 and an ending gain of 1 to the samples between <var>splice timestamp</var> and
              <var>splice end timestamp</var> in <var>fade in samples</var>.</li>
            <li>Copy samples between <var>presentation timestamp</var> to <var>splice timestamp</var> from <var>fade out samples</var> into <var>output samples</var>.</li>
            <li>For each sample between <var>splice timestamp</var> and <var>splice end timestamp</var>, compute the sum of a sample from <var>fade out samples</var> and the
              corresponding sample in <var>fade in samples</var> and store the result in <var>output samples</var>.</li>
            <li>Copy samples between <var>splice end timestamp</var> to <var>end timestamp</var> from <var>fade in samples</var> into <var>output samples</var>.</li>
            <li>Render <var>output samples</var>.</li>
          </ol>
          <div class="note" role="note" id="issue-container-generatedID-69"><div role="heading" class="note-title marker" id="h-note-69" aria-level="5"><span>Note</span></div><div class="">
            <p>Here is a graphical representation of this algorithm.</p>
            <img src="audio_splice.png" alt="Audio splice diagram">
          </div></div>
        </section>
        <section id="sourcebuffer-text-splice-frame-algorithm">
          <h4 id="x3-5-13-text-splice-frame-algorithm"><bdi class="secno">3.5.13 </bdi>Text Splice Frame Algorithm<a class="self-link" aria-label="§" href="#sourcebuffer-text-splice-frame-algorithm"></a></h4>
          <p>Follow these steps when the <a href="#sourcebuffer-coded-frame-processing">coded frame processing algorithm</a> needs to generate a splice frame for two overlapping timed text
            <a href="#coded-frame">coded frames</a>:</p>
          <ol>
            <li>Let <var>track buffer</var> be the <a href="#track-buffer">track buffer</a> that will contain the splice.</li>
            <li>Let <var>new coded frame</var> be the new <a href="#coded-frame">coded frame</a>, that is being added to <var>track buffer</var>, which triggered the need for a splice.</li>
            <li>Let <var>presentation timestamp</var> be the <a href="#presentation-timestamp">presentation timestamp</a> for <var>new coded frame</var></li>
            <li>Let <var>decode timestamp</var> be the decode timestamp for <var>new coded frame</var>.</li>
            <li>Let <var>frame duration</var> be the <a href="#coded-frame-duration">coded frame duration</a> of <var>new coded frame</var>.</li>
            <li>Let <var>frame end timestamp</var> equal the sum of <var>presentation timestamp</var> and <var>frame duration</var>.</li>
            <li>Let <var>first overlapped frame</var> be the <a href="#coded-frame">coded frame</a> in <var>track buffer</var> with a <a href="#presentation-interval">presentation interval</a> that contains <var>presentation timestamp</var>.
            </li>
            <li>Let <var>overlapped presentation timestamp</var> be the <a href="#presentation-timestamp">presentation timestamp</a> of the <var>first overlapped frame</var>.</li>
            <li>Let <var>overlapped frames</var> equal <var>first overlapped frame</var> as well as any additional frames in <var>track buffer</var> that
              have a <a href="#presentation-timestamp">presentation timestamp</a> greater than <var>presentation timestamp</var> and less than <var>frame end timestamp</var>.</li>
            <li>Remove all the frames included in <var>overlapped frames</var> from <var>track buffer</var>.
            </li><li>Update the <a href="#coded-frame-duration">coded frame duration</a> of the <var>first overlapped frame</var> to <var>presentation timestamp</var> - <var>overlapped presentation timestamp</var>.</li>
            <li>Add <var>first overlapped frame</var> to the <var>track buffer</var>.
            </li><li>Return to caller without providing a splice frame.
              <div class="note" role="note" id="issue-container-generatedID-70"><div role="heading" class="note-title marker" id="h-note-70" aria-level="5"><span>Note</span></div><p class="">This is intended to allow <var>new coded frame</var> to be added to the <var>track buffer</var> as if
                it hadn't overlapped any frames in <var>track buffer</var> to begin with.</p></div>
            </li>
          </ol>
        </section>
      </section>
    </section>

    <section id="sourcebufferlist">
      <h2 id="x4-sourcebufferlist-object"><bdi class="secno">4. </bdi>SourceBufferList Object<a class="self-link" aria-label="§" href="#sourcebufferlist"></a></h2>
      <p>SourceBufferList is a simple container object for <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects. It provides read-only array access and fires events when the list is modified.</p>
<pre class="idl def respec-offending-element" id="webidl-x137638376" title="Interfaces must have `[Exposed]` extended attribute. To fix, add, for example, `[Exposed=Window]`. Please also consider carefully if your interface should also be exposed in a Worker scope. Refer to the [WebIDL spec section on Exposed](https://heycam.github.io/webidl/#Exposed) for more information."><span class="idlHeader"><a class="self-link" href="#webidl-x137638376">WebIDL</a></span><span data-idl="" class="idlInterface" id="idl-def-sourcebufferlist" data-title="SourceBufferList">interface <dfn data-export="" data-dfn-type="interface" id="dom-sourcebufferlist" data-idl="interface" data-title="SourceBufferList" data-dfn-for="SourceBufferList" class="idlID"><code>SourceBufferList</code></dfn> : <span class="idlSuperclass"><a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-14">EventTarget</a></span> {<span data-idl="" class="idlAttribute" id="idl-def-sourcebufferlist-length" data-title="length" data-dfn-for="SourceBufferList">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-for="SourceBufferList" data-link-type="attribute" href="#dom-sourcebufferlist-length"><code>length</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebufferlist-onaddsourcebuffer" data-title="onaddsourcebuffer" data-dfn-for="SourceBufferList">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-15">EventHandler</a></span>  <a class="internalDFN idlName" data-link-for="SourceBufferList" data-link-type="attribute" href="#dom-sourcebufferlist-onaddsourcebuffer"><code>onaddsourcebuffer</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-sourcebufferlist-onremovesourcebuffer" data-title="onremovesourcebuffer" data-dfn-for="SourceBufferList">
                    attribute<span class="idlType"> <a data-xref-type="_IDL_" class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-16">EventHandler</a></span>  <a class="internalDFN idlName" data-link-for="SourceBufferList" data-link-type="attribute" href="#dom-sourcebufferlist-onremovesourcebuffer"><code>onremovesourcebuffer</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-sourcebufferlist--index" data-title="" data-dfn-for="SourceBufferList">
    getter<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a></span> (<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">index</span>);</span>
};</span></pre>
      <section id="attributes-1">
        <h3 id="x4-1-attributes"><bdi class="secno">4.1 </bdi>Attributes<a class="self-link" aria-label="§" href="#attributes-1"></a></h3>
        <dl class="attributes" data-dfn-for="SourceBufferList" data-link-for="SourceBufferList">
          <dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebufferlist-length" data-idl="attribute" data-title="length" data-dfn-for="SourceBufferList" data-type="unsigned long" data-lt="length" data-local-lt="SourceBufferList.length"><code>length</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-unsigned-long">unsigned long</a></code></span>, readonly       </dt>
          <dd>
            <p>Indicates the number of <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects in the list.</p>
          </dd>
          <dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebufferlist-onaddsourcebuffer" data-idl="attribute" data-title="onaddsourcebuffer" data-dfn-for="SourceBufferList" data-type="EventHandler" data-lt="onaddsourcebuffer" data-local-lt="SourceBufferList.onaddsourcebuffer"><code>onaddsourcebuffer</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt>
          <dd>
            <p>The event handler for the <code><a href="#dom-evt-addsourcebuffer">addsourcebuffer</a></code> event.</p>
          </dd>
          <dt><dfn data-dfn-type="attribute" data-export="" id="dom-sourcebufferlist-onremovesourcebuffer" data-idl="attribute" data-title="onremovesourcebuffer" data-dfn-for="SourceBufferList" data-type="EventHandler" data-lt="onremovesourcebuffer" data-local-lt="SourceBufferList.onremovesourcebuffer"><code>onremovesourcebuffer</code></dfn> of type <span class="idlAttrType"><code><a href="https://www.w3.org/TR/html51/webappapis.html#typedefdef-eventhandlernonnull-eventhandler">EventHandler</a></code></span></dt>
          <dd>
            <p>The event handler for the <code><a href="#dom-evt-removesourcebuffer">removesourcebuffer</a></code> event.</p>
          </dd>
        </dl>
      </section>
      <section id="methods-1">
        <h3 id="x4-2-methods"><bdi class="secno">4.2 </bdi>Methods<a class="self-link" aria-label="§" href="#methods-1"></a></h3>
        <dl class="methods" data-dfn-for="SourceBufferList" data-link-for="SourceBufferList">
          <dt><dfn data-lt-nodefault="" data-lt="sourcebufferlist-getter" data-dfn-type="dfn" id="dfn-sourcebufferlist-getter"><code>getter</code></dfn></dt>
          <dd>
            <p>Allows the SourceBuffer objects in the list to be accessed with an array operator (i.e., []).</p>

            
            <table class="parameters">
              <tbody>
                <tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr>
                <tr>
                  <td class="prmName">index</td>
                  <td class="prmType"><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-unsigned-long">unsigned long</a></code></td>
                  <td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td>
                  <td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td>
                  <td class="prmDesc"></td>
                </tr>
              </tbody>
            </table>
            <div><em>Return type: </em><a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code><code>SourceBuffer</code></code></a></div>
          <p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
              <li>If <var>index</var> is greater than or equal to the <code><a href="#dom-sourcebufferlist-length">length</a></code> attribute then return undefined and abort these steps.</li>
              <li>Return the <var>index</var>'th <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object in the list.</li>
            </ol></dd>
        </dl>
      </section>

      <section id="sourcebufferlist-events">
        <h3 id="x4-3-event-summary"><bdi class="secno">4.3 </bdi>Event Summary<a class="self-link" aria-label="§" href="#sourcebufferlist-events"></a></h3>
        <table class="old-table">
          <thead>
            <tr>
              <th>Event name</th>
              <th>Interface</th>
              <th>Dispatched when...</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><dfn id="dom-evt-addsourcebuffer"><code>addsourcebuffer</code></dfn></td>
              <td><code>Event</code></td>
              <td>When a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> is added to the list.</td>
            </tr>
            <tr>
              <td><dfn id="dom-evt-removesourcebuffer"><code>removesourcebuffer</code></dfn></td>
              <td><code>Event</code></td>
              <td>When a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> is removed from the list.</td>
            </tr>
          </tbody>
        </table>
      </section>
    </section>

    <section id="url">
      <h2 id="x5-url-object-extensions"><bdi class="secno">5. </bdi>URL Object Extensions<a class="self-link" aria-label="§" href="#url"></a></h2>
      <p>This section specifies extensions to the <a href="https://www.w3.org/TR/FileAPI/#URL-object">URL</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-file-api" title="File API">FILE-API</a></cite>] object definition.</p>

<pre class="idl def" id="webidl-x2063149554"><span class="idlHeader"><a class="self-link" href="#webidl-x2063149554">WebIDL</a></span><span data-idl="" class="idlInterface" id="idl-def-url-partial-1" data-title="URL">[<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a></span>]
partial interface <a data-idl="partial" data-link-type="interface" data-title="URL" data-xref-type="interface" class="idlID respec-offending-element" data-dfn-for="URL" id="dfn-url" title="Error: No matching dfn found."><code>URL</code></a> {<span data-idl="" class="idlMethod" id="idl-def-url-createobjecturl-mediasource" data-title="createObjectURL" data-dfn-for="URL">
    static<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-for="URL" data-link-type="method" href="#dom-url-createobjecturl"><code>createObjectURL</code></a> (<span class="idlType"><a data-xref-type="_IDL_" href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a></span> <span class="idlParamName">mediaSource</span>);</span>
};</span></pre><section id="methods-2"><h3 id="x5-1-methods"><bdi class="secno">5.1 </bdi>Methods<a class="self-link" aria-label="§" href="#methods-2"></a></h3><dl class="methods" data-dfn-for="URL" data-link-for="URL"><dt><dfn data-dfn-type="method" data-export="" id="dom-url-createobjecturl" data-idl="operation" data-title="createObjectURL" data-dfn-for="URL" data-type="DOMString" data-lt="createObjectURL()|createObjectURL(mediaSource)" data-local-lt="URL.createObjectURL|URL.createObjectURL()|createObjectURL"><code>createObjectURL</code></dfn>, static</dt><dd>
          <p>Creates URLs for <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> objects.</p>

          
          <div class="note" role="note" id="issue-container-generatedID-71"><div role="heading" class="note-title marker" id="h-note-71" aria-level="4"><span>Note</span></div><p class="">This algorithm is intended to mirror the behavior of the <a href="https://www.w3.org/TR/FileAPI/#dfn-createObjectURL">createObjectURL()</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-file-api" title="File API">FILE-API</a></cite>] method, which does not auto-revoke the created URL. Web authors are encouraged to use <a href="https://www.w3.org/TR/FileAPI/#dfn-revokeObjectURL">revokeObjectURL()</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-file-api" title="File API">FILE-API</a></cite>] for any <a href="#mediasource-object-url">MediaSource object URL</a> that is no longer needed for attachment to a media element.</p></div>
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">mediaSource</td><td class="prmType"><code>MediaSource</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code><a href="https://www.w3.org/TR/WebIDL-1/#idl-DOMString" class="idlType">DOMString</a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li>Return a unique <a href="#mediasource-object-url">MediaSource object URL</a> that can be used to dereference the <var>mediaSource</var> argument.</li>
          </ol></dd></dl></section>
    </section>

    <section id="htmlmediaelement-extensions">
      <h2 id="x6-htmlmediaelement-extensions"><bdi class="secno">6. </bdi>HTMLMediaElement Extensions<a class="self-link" aria-label="§" href="#htmlmediaelement-extensions"></a></h2>
      <p>This section specifies what existing attributes on the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#htmlmediaelement-htmlmediaelement">HTMLMediaElement</a></code> <em class="rfc2119" title="MUST">MUST</em> return when a <a href="#idl-def-mediasource" class="internalDFN" data-link-type="idl"><code>MediaSource</code></a> is attached to the element.</p>

      <p>The <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-seekable">HTMLMediaElement.seekable</a></code> attribute returns a new static <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#normalized-timeranges-object">normalized TimeRanges object</a> created based on the following steps:</p>
      <dl class="switch">
        <dt>If <code><a href="#dom-mediasource-duration">duration</a></code> equals NaN:</dt>
        <dd>Return an empty <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code> object.</dd>
        <dt>If <code><a href="#dom-mediasource-duration">duration</a></code> equals positive Infinity:</dt>
        <dd>
          <ol>
            <li>If <var><a href="#live-seekable-range">live seekable range</a></var> is not empty:
              <ol>
                <li>Let <var>union ranges</var> be the union of <var><a href="#live-seekable-range">live seekable range</a></var> and the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> attribute.</li>
                <li>Return a single range with a start time equal to the earliest start time in <var>union ranges</var> and an end time equal to the highest end time in <var>union ranges</var> and abort these steps.</li>
              </ol>
            </li>
            <li>If the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> attribute returns an empty <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code>
              object, then return an empty <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code> object and abort these steps.</li>
            <li>Return a single range with a start time of 0 and an end time equal to the highest end time reported by the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> attribute.
        </li></ol></dd>
        <dt>Otherwise:</dt>
        <dd>Return a single range with a start time of 0 and an end time equal to <code><a href="#dom-mediasource-duration">duration</a></code>.</dd>
      </dl>

      <p id="dom-htmlmediaelement.buffered">The <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#dom-htmlmediaelement-buffered">HTMLMediaElement.buffered</a></code> attribute returns a static <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#normalized-timeranges-object">normalized TimeRanges object</a> based on the following steps.</p>
      <ol>
        <li>Let <var>intersection ranges</var> equal an empty <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRanges</a></code> object.</li>
        <li>If <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.length does not equal 0 then run the following steps:
          <ol>
            <li>Let <var>active ranges</var> be the ranges returned by <code><a href="#dom-sourcebuffer-buffered">buffered</a></code> for each <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code>.</li>
            <li>Let <var>highest end time</var> be the largest range end time in the <var>active ranges</var>.</li>
            <li>Let <var>intersection ranges</var> equal a <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#timeranges-timeranges">TimeRange</a></code> object containing a single range from 0 to <var>highest end time</var>.</li>
            <li>For each <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> object in <code><a href="#dom-mediasource-activesourcebuffers">activeSourceBuffers</a></code> run the following steps:
              <ol>
                <li>Let <var>source ranges</var> equal the ranges returned by the <code><a href="#dom-sourcebuffer-buffered">buffered</a></code> attribute on the current <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>.</li>
                <li>If <code><a href="#dom-readystate">readyState</a></code> is <code><a href="#idl-def-ReadyState.ended">"ended"</a></code>, then set the end time on the last range in <var>source ranges</var> to
                  <var>highest end time</var>.</li>
                <li>Let <var>new intersection ranges</var> equal the intersection between the <var>intersection ranges</var> and the <var>source ranges</var>.</li>
                <li>Replace the ranges in <var>intersection ranges</var> with the <var>new intersection ranges</var>.</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>If the current value of this attribute has not been set by this algorithm or
          <var>intersection ranges</var> does not contain the exact same range information as the
          current value of this attribute, then update the current value of this attribute to
          <var>intersection ranges</var>.
        </li><li>Return the current value of this attribute.</li>
      </ol>
    </section>

    <section id="audio-track-extensions">
      <h2 id="x7-audiotrack-extensions"><bdi class="secno">7. </bdi>AudioTrack Extensions<a class="self-link" aria-label="§" href="#audio-track-extensions"></a></h2>
      <p>This section specifies extensions to the HTML <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#audiotrack-audiotrack">AudioTrack</a></code> definition.</p>

      <div><pre class="idl def" id="webidl-x1816565074"><span class="idlHeader"><a class="self-link" href="#webidl-x1816565074">WebIDL</a></span><span data-idl="" class="idlInterface" id="idl-def-audiotrack-partial-1" data-title="AudioTrack">partial interface <a data-idl="partial" data-link-type="interface" data-title="AudioTrack" data-xref-type="interface" class="idlID respec-offending-element" data-dfn-for="AudioTrack" id="dfn-audiotrack" title="Error: No matching dfn found."><code>AudioTrack</code></a> {<span data-idl="" class="idlAttribute" id="idl-def-audiotrack-sourcebuffer" data-title="sourceBuffer" data-dfn-for="AudioTrack">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>?</span> <a class="internalDFN idlName" data-link-for="AudioTrack" data-link-type="attribute" href="#dom-audiotrack-sourcebuffer"><code>sourceBuffer</code></a>;</span>
};</span></pre><section><h3 id="attributes-2">Attributes<a class="self-link" aria-label="§" href="#attributes-2"></a></h3><dl class="attributes" data-dfn-for="AudioTrack" data-link-for="AudioTrack"><dt><dfn data-dfn-type="attribute" data-export="" id="dom-audiotrack-sourcebuffer" data-idl="attribute" data-title="sourceBuffer" data-dfn-for="AudioTrack" data-type="SourceBuffer" data-lt="sourceBuffer" data-local-lt="AudioTrack.sourceBuffer"><code>sourceBuffer</code></dfn> of type <span class="idlAttrType"><a href="#dom-audiotrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a></span>, readonly       , nullable</dt><dd>
          <p>Returns the <a href="#dom-audiotrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> that created this track. Returns null if this track was not created by a <a href="#dom-audiotrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> or the <a href="#dom-audiotrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of its <a href="#parent-media-source">parent media source</a>.</p>
        </dd></dl></section></div>
    </section>

    <section id="video-track-extensions">
      <h2 id="x8-videotrack-extensions"><bdi class="secno">8. </bdi>VideoTrack Extensions<a class="self-link" aria-label="§" href="#video-track-extensions"></a></h2>
      <p>This section specifies extensions to the HTML <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#videotrack-videotrack">VideoTrack</a></code> definition.</p>

      <div><pre class="idl def" id="webidl-x1794440115"><span class="idlHeader"><a class="self-link" href="#webidl-x1794440115">WebIDL</a></span><span data-idl="" class="idlInterface" id="idl-def-videotrack-partial-1" data-title="VideoTrack">partial interface <a data-idl="partial" data-link-type="interface" data-title="VideoTrack" data-xref-type="interface" class="idlID respec-offending-element" data-dfn-for="VideoTrack" id="dfn-videotrack" title="Error: No matching dfn found."><code>VideoTrack</code></a> {<span data-idl="" class="idlAttribute" id="idl-def-videotrack-sourcebuffer" data-title="sourceBuffer" data-dfn-for="VideoTrack">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>?</span> <a class="internalDFN idlName" data-link-for="VideoTrack" data-link-type="attribute" href="#dom-videotrack-sourcebuffer"><code>sourceBuffer</code></a>;</span>
};</span></pre><section><h3 id="attributes-3">Attributes<a class="self-link" aria-label="§" href="#attributes-3"></a></h3><dl class="attributes" data-dfn-for="VideoTrack" data-link-for="VideoTrack"><dt><dfn data-dfn-type="attribute" data-export="" id="dom-videotrack-sourcebuffer" data-idl="attribute" data-title="sourceBuffer" data-dfn-for="VideoTrack" data-type="SourceBuffer" data-lt="sourceBuffer" data-local-lt="VideoTrack.sourceBuffer"><code>sourceBuffer</code></dfn> of type <span class="idlAttrType"><a href="#dom-videotrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a></span>, readonly       , nullable</dt><dd>
          <p>Returns the <a href="#dom-videotrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> that created this track. Returns null if this track was not created by a <a href="#dom-videotrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> or the <a href="#dom-videotrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of its <a href="#parent-media-source">parent media source</a>.</p>
        </dd></dl></section></div>
    </section>

    <section id="text-track-extensions">
      <h2 id="x9-texttrack-extensions"><bdi class="secno">9. </bdi>TextTrack Extensions<a class="self-link" aria-label="§" href="#text-track-extensions"></a></h2>
      <p>This section specifies extensions to the HTML <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#texttrack-texttrack">TextTrack</a></code> definition.</p>

      <div><pre class="idl def" id="webidl-x890989617"><span class="idlHeader"><a class="self-link" href="#webidl-x890989617">WebIDL</a></span><span data-idl="" class="idlInterface" id="idl-def-texttrack-partial-1" data-title="TextTrack">partial interface <a data-idl="partial" data-link-type="interface" data-title="TextTrack" data-xref-type="interface" class="idlID respec-offending-element" data-dfn-for="TextTrack" id="dfn-texttrack" title="Error: No matching dfn found."><code>TextTrack</code></a> {<span data-idl="" class="idlAttribute" id="idl-def-texttrack-sourcebuffer" data-title="sourceBuffer" data-dfn-for="TextTrack">
    readonly        attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a>?</span> <a class="internalDFN idlName" data-link-for="TextTrack" data-link-type="attribute" href="#dom-texttrack-sourcebuffer"><code>sourceBuffer</code></a>;</span>
};</span></pre><section><h3 id="attributes-4">Attributes<a class="self-link" aria-label="§" href="#attributes-4"></a></h3><dl class="attributes" data-dfn-for="TextTrack" data-link-for="TextTrack"><dt><dfn data-dfn-type="attribute" data-export="" id="dom-texttrack-sourcebuffer" data-idl="attribute" data-title="sourceBuffer" data-dfn-for="TextTrack" data-type="SourceBuffer" data-lt="sourceBuffer" data-local-lt="TextTrack.sourceBuffer"><code>sourceBuffer</code></dfn> of type <span class="idlAttrType"><a href="#dom-texttrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a></span>, readonly       , nullable</dt><dd>
          <p>Returns the <a href="#dom-texttrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> that created this track. Returns null if this track was not created by a <a href="#dom-texttrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> or the <a href="#dom-texttrack-sourcebuffer" class="internalDFN" data-link-type="idl">SourceBuffer</a> has been removed from the <code><a href="#dom-mediasource-sourcebuffers">sourceBuffers</a></code> attribute of its <a href="#parent-media-source">parent media source</a>.</p>
        </dd></dl></section></div>
    </section>

    <section id="byte-stream-formats">
      <h2 id="x10-byte-stream-formats"><bdi class="secno">10. </bdi>Byte Stream Formats<a class="self-link" aria-label="§" href="#byte-stream-formats"></a></h2>
      <p>The bytes provided through <code><a href="#dom-sourcebuffer-appendbuffer">appendBuffer()</a></code> for a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> form a logical byte stream. The format and
        semantics of these byte streams are defined in <dfn id="byte-stream-format-specs" data-dfn-type="dfn">byte stream format specifications</dfn>.
        The byte stream format registry [<cite><a class="bibref" data-link-type="biblio" href="#bib-mse-registry" title="Media Source Extensions™ Byte Stream Format Registry">MSE-REGISTRY</a></cite>] provides mappings between a MIME type that may be passed to <code><a href="#dom-mediasource-addsourcebuffer">addSourceBuffer()</a></code> or
        <code><a href="#dom-mediasource-istypesupported">isTypeSupported()</a></code> and the byte stream format expected by a <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> created with that MIME type. Implementations are encouraged to register
        mappings for byte stream formats they support to facilitate interoperability. The byte stream format registry [<cite><a class="bibref" data-link-type="biblio" href="#bib-mse-registry" title="Media Source Extensions™ Byte Stream Format Registry">MSE-REGISTRY</a></cite>] is the authoritative source for these
        mappings. If an implementation claims to support a MIME type listed in the registry, its <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> implementation <em class="rfc2119" title="MUST">MUST</em> conform to the
        <a href="#byte-stream-format-specs">byte stream format specification</a> listed in the registry entry.</p>
      <div class="note" role="note" id="issue-container-generatedID-72"><div role="heading" class="note-title marker" id="h-note-72" aria-level="3"><span>Note</span></div><p class="">The byte stream format specifications in the registry are not intended to define new storage formats. They simply outline the subset of
        existing storage format structures that implementations of this specification will accept.</p></div>
      <div class="note" role="note" id="issue-container-generatedID-73"><div role="heading" class="note-title marker" id="h-note-73" aria-level="3"><span>Note</span></div><p class="">Byte stream format parsing and validation is implemented in the <a href="#sourcebuffer-segment-parser-loop">segment parser loop</a> algorithm.</p></div>

      <p>This section provides general requirements for all byte stream format specifications:</p>
      <ul>
        <li>A byte stream format specification <em class="rfc2119" title="MUST">MUST</em> define <a href="#init-segment">initialization segments</a> and <a href="#media-segment">media segments</a>.</li>
        <li>A byte stream format <em class="rfc2119" title="SHOULD">SHOULD</em> provide references for sourcing <a href="#idl-def-audiotrack-partial-1" class="internalDFN" data-link-type="idl"><code>AudioTrack</code></a>, <a href="#idl-def-videotrack-partial-1" class="internalDFN" data-link-type="idl"><code>VideoTrack</code></a>, and <a href="#idl-def-texttrack-partial-1" class="internalDFN" data-link-type="idl"><code>TextTrack</code></a> attribute values
          from data in <a href="#init-segment">initialization segments</a>.
          <div class="note" role="note" id="issue-container-generatedID-74"><div role="heading" class="note-title marker" id="h-note-74" aria-level="3"><span>Note</span></div><p class="">If the byte stream format covers a format similar to one covered in the in-band tracks spec [<cite><a class="bibref" data-link-type="biblio" href="#bib-inbandtracks" title="Sourcing In-band Media Resource Tracks from Media Containers into HTML">INBANDTRACKS</a></cite>], then
            it <em class="rfc2119" title="SHOULD">SHOULD</em> try to use the same attribute mappings so that Media Source Extensions playback and non-Media Source Extensions playback provide the
            same track information.</p></div>
        </li>
        <li>It <em class="rfc2119" title="MUST">MUST</em> be possible to identify segment boundaries and segment type (initialization or media) by examining the byte stream alone.</li>
        <li>The user agent <em class="rfc2119" title="MUST">MUST</em> run the <a href="#sourcebuffer-append-error">append error algorithm</a> when any of the following conditions are met:
          <ol>
            <li>
              <p>The number and type of tracks are not consistent.</p>
              <div class="note" role="note" id="issue-container-generatedID-75"><div role="heading" class="note-title marker" id="h-note-75" aria-level="3"><span>Note</span></div><p class="">For example, if the first <a href="#init-segment">initialization segment</a> has 2 audio tracks and 1 video track, then all <a href="#init-segment">initialization segments</a> that follow it in the byte stream <em class="rfc2119" title="MUST">MUST</em> describe 2 audio tracks and 1 video track.</p></div>
            </li>
            <li><a href="#track-id">Track IDs</a> are not the same across <a href="#init-segment">initialization segments</a>, for segments describing multiple tracks of a single type (e.g., 2 audio tracks).</li>
            <li>
              <p>Codecs changes across <a href="#init-segment">initialization segments</a>.</p>
              <div class="note" role="note" id="issue-container-generatedID-76"><div role="heading" class="note-title marker" id="h-note-76" aria-level="3"><span>Note</span></div><p class="">For example, a byte stream that starts with an <a href="#init-segment">initialization segment</a> that specifies a single AAC track and later contains an <a href="#init-segment">initialization segment</a> that specifies a single AMR-WB track is not allowed. Support for multiple codecs is handled with multiple <a href="#idl-def-sourcebuffer" class="internalDFN" data-link-type="idl"><code>SourceBuffer</code></a> objects.</p></div>
            </li>
          </ol>
        </li>
        <li>The user agent <em class="rfc2119" title="MUST">MUST</em> support the following:
          <ol>
            <li><a href="#track-id">Track IDs</a> changing across <a href="#init-segment">initialization segments</a> if the segments describes only one track of each type.</li>
            <li>
              <p>Video frame size changes. The user agent <em class="rfc2119" title="MUST">MUST</em> support seamless playback.</p>
              <div class="note" role="note" id="issue-container-generatedID-77"><div role="heading" class="note-title marker" id="h-note-77" aria-level="3"><span>Note</span></div><p class="">This will cause the &lt;video&gt; display region to change size if the web application does not use CSS or HTML attributes (width/height) to constrain the element size.</p></div>
            </li>
            <li>
              <p>Audio channel count changes. The user agent <em class="rfc2119" title="MAY">MAY</em> support this seamlessly and could trigger downmixing.</p>
              <div class="note" role="note" id="issue-container-generatedID-78"><div role="heading" class="note-title marker" id="h-note-78" aria-level="3"><span>Note</span></div><p class="">This is a quality of implementation issue because changing the channel count may require reinitializing the audio device, resamplers, and channel mixers which tends to be audible.</p></div>
            </li>
          </ol>
        </li>
        <li>The following rules apply to all <a href="#media-segment">media segments</a> within a byte stream. A user agent <em class="rfc2119" title="MUST">MUST</em>:
          <ol>
            <li>Map all timestamps to the same <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#media-timeline">media timeline</a>.</li>
            <li>Support seamless playback of <a href="#media-segment">media segments</a> having a timestamp gap smaller than the audio frame size. User agents <em class="rfc2119" title="MUST NOT">MUST NOT</em> reflect these gaps in the <code><a href="#dom-sourcebuffer-buffered">buffered</a></code> attribute.
              <div class="note" role="note" id="issue-container-generatedID-79"><div role="heading" class="note-title marker" id="h-note-79" aria-level="3"><span>Note</span></div><p class="">This is intended to simplify switching between audio streams where the frame boundaries don't always line up across encodings (e.g., Vorbis).</p></div>
            </li>
          </ol>
        </li>
        <li>The user agent <em class="rfc2119" title="MUST">MUST</em> run the <a href="#sourcebuffer-append-error">append error algorithm</a> when any combination of an <a href="#init-segment">initialization segment</a> and any contiguous sequence of <a href="#media-segment">media segments</a> satisfies the
          following conditions:
          <ol>
            <li>The number and type (audio, video, text, etc.) of all tracks in the <a href="#media-segment">media segments</a> are not identified.</li>
            <li>The decoding capabilities needed to decode each track (i.e., codec and codec parameters) are not provided.</li>
            <li>Encryption parameters necessary to decrypt the content (except the encryption key itself) are not provided for all encrypted tracks.</li>
            <li>All information necessary to decode and render the earliest <a href="#random-access-point">random access point</a> in the sequence of <a href="#media-segment">media segments</a> and all subsequence samples in the sequence
              (in presentation time) are not provided. This includes in particular,
              <ul>
                <li>Information that determines the <a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#video-intrinsic-width">intrinsic width and height</a> of the video (specifically, this requires either the picture or pixel aspect ratio, together with the encoded
                  resolution).</li>
                <li>Information necessary to convert the video decoder output to a format suitable for display</li>
              </ul>
            </li>
            <li>Information necessary to compute the global <a href="#presentation-timestamp">presentation timestamp</a> of every sample in the sequence of <a href="#media-segment">media segments</a> is not provided.</li>
          </ol>
          <p>For example, if I1 is associated with M1, M2, M3 then the above <em class="rfc2119" title="MUST">MUST</em> hold for all the combinations I1+M1, I1+M2, I1+M1+M2, I1+M2+M3, etc.</p>
        </li>
      </ul>
      <p>Byte stream specifications <em class="rfc2119" title="MUST">MUST</em> at a minimum define constraints which ensure that the above requirements hold. Additional constraints <em class="rfc2119" title="MAY">MAY</em> be defined, for example to simplify implementation.</p>

    </section>

    <section id="conformance"><h2 id="x11-conformance"><bdi class="secno">11. </bdi>Conformance<a class="self-link" aria-label="§" href="#conformance"></a></h2><p>
      As well as sections marked as non-normative, all authoring guidelines,
      diagrams, examples, and notes in this specification are non-normative.
      Everything else in this specification is normative.
    </p><p>
            The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">SHOULD</em>, and <em class="rfc2119">SHOULD NOT</em> in this document
            are to be interpreted as described in
            <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>]
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>] when, and only when, they appear
            in all capitals, as shown here.
          </p></section>

    <section id="examples">
      <h2 id="x12-examples"><bdi class="secno">12. </bdi>Examples<a class="self-link" aria-label="§" href="#examples"></a></h2>
      <p>Example use of the Media Source Extensions</p>
      <div class="block">
        <div class="blockContent">
          <pre class="code" aria-busy="false"><code class="hljs">&lt;script&gt;
  function onSourceOpen(videoTag, e) {
    var mediaSource = e.target;

    if (mediaSource.sourceBuffers.length &gt; 0)
        return;

    var sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vorbis,vp8"');

    videoTag.addEventListener('seeking', onSeeking.bind(videoTag, mediaSource));
    videoTag.addEventListener('progress', onProgress.bind(videoTag, mediaSource));

    var initSegment = GetInitializationSegment();

    if (initSegment == null) {
      // Error fetching the initialization segment. Signal end of stream with an error.
      mediaSource.endOfStream("network");
      return;
    }

    // Append the initialization segment.
    var firstAppendHandler = function(e) {
      var sourceBuffer = e.target;
      sourceBuffer.removeEventListener('updateend', firstAppendHandler);

      // Append some initial media data.
      appendNextMediaSegment(mediaSource);
    };
    sourceBuffer.addEventListener('updateend', firstAppendHandler);
    sourceBuffer.appendBuffer(initSegment);
  }

  function appendNextMediaSegment(mediaSource) {
    if (mediaSource.readyState == "closed")
      return;

    // If we have run out of stream data, then signal end of stream.
    if (!HaveMoreMediaSegments()) {
      mediaSource.endOfStream();
      return;
    }

    // Make sure the previous append is not still pending.
    if (mediaSource.sourceBuffers[0].updating)
        return;

    var mediaSegment = GetNextMediaSegment();

    if (!mediaSegment) {
      // Error fetching the next media segment.
      mediaSource.endOfStream("network");
      return;
    }

    // NOTE: If mediaSource.readyState == “ended”, this appendBuffer() call will
    // cause mediaSource.readyState to transition to "open". The web application
    // should be prepared to handle multiple “sourceopen” events.
    mediaSource.sourceBuffers[0].appendBuffer(mediaSegment);
  }

  function onSeeking(mediaSource, e) {
    var video = e.target;

    if (mediaSource.readyState == "open") {
      // Abort current segment append.
      mediaSource.sourceBuffers[0].abort();
    }

    // Notify the media segment loading code to start fetching data at the
    // new playback position.
    SeekToMediaSegmentAt(video.currentTime);

    // Append a media segment from the new playback position.
    appendNextMediaSegment(mediaSource);
  }

  function onProgress(mediaSource, e) {
    appendNextMediaSegment(mediaSource);
  }
&lt;/script&gt;

&lt;video id="v" autoplay&gt; &lt;/video&gt;

&lt;script&gt;
  var video = document.getElementById('v');
  var mediaSource = new MediaSource();
  mediaSource.addEventListener('sourceopen', onSourceOpen.bind(this, video));
  video.src = window.URL.createObjectURL(mediaSource);
&lt;/script&gt;</code></pre>
        </div>
      </div>
    </section>

    <section id="acknowledgements">
      <h2 id="x13-acknowledgments"><bdi class="secno">13. </bdi>Acknowledgments<a class="self-link" aria-label="§" href="#acknowledgements"></a></h2>
      The editors would like to thank Alex Giladi, Bob Lund, Chris Poole, Cyril Concolato, David Dorwin, David Singer, Duncan Rowden, Frank Galligan, Glenn Adams, Jer Noble, Joe Steele, John Simmons, Kevin Streeter, Mark Vickers, Matt Ward, Matthew Gregan, Michael Thornburgh, Philip Jägenstedt, Pierre Lemieux, Ralph Giles, Steven Robertson, and Tatsuya Igarashi for their contributions to this specification.
    </section>

    <section id="VideoPlaybackQuality" class="appendix informative">
      <h2 id="a-videoplaybackquality"><bdi class="secno">A. </bdi>VideoPlaybackQuality<a class="self-link" aria-label="§" href="#VideoPlaybackQuality"></a></h2><p><em>This section is non-normative.</em></p>
      The video playback quality metrics described in previous revisions of this specification (e.g., sections 5 and 10 of the <a href="https://www.w3.org/TR/2016/CR-media-source-20160705/">Candidate Recommendation</a>) are now being developed as part of [<cite><a class="bibref" data-link-type="biblio" href="#bib-media-playback-quality" title="Media Playback Quality">MEDIA-PLAYBACK-QUALITY</a></cite>]. Some implementations may have implemented the earlier draft <code>VideoPlaybackQuality</code> object and the <code><a href="https://www.w3.org/TR/html51/semantics-embedded-content.html#htmlvideoelement-htmlvideoelement">HTMLVideoElement</a></code> extension method <code>getVideoPlaybackQuality()</code> described in those previous revisions.
    </section>
  

<section id="references" class="appendix"><h2 id="b-references"><bdi class="secno">B. </bdi>References<a class="self-link" aria-label="§" href="#references"></a></h2><section id="normative-references">
        <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>Normative references<a class="self-link" aria-label="§" href="#normative-references"></a></h3>
      <dl class="bibliography">
        <dt id="bib-file-api">[FILE-API]</dt><dd><a href="https://www.w3.org/TR/FileAPI/"><cite>File API</cite></a>. Marijn Kruisselbrink; Arun Ranganathan.  W3C. 11 September 2019. W3C Working Draft. URL: <a href="https://www.w3.org/TR/FileAPI/">https://www.w3.org/TR/FileAPI/</a></dd><dt id="bib-html">[HTML]</dt><dd><a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren; Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters.  WHATWG. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a></dd><dt id="bib-html51">[HTML51]</dt><dd><a href="https://www.w3.org/TR/html51/"><cite>HTML 5.1 2nd Edition</cite></a>. Steve Faulkner; Arron Eicholz; Travis Leithead; Alex Danilo.  W3C. 3 October 2017. W3C Recommendation. URL: <a href="https://www.w3.org/TR/html51/">https://www.w3.org/TR/html51/</a></dd><dt id="bib-mse-registry">[MSE-REGISTRY]</dt><dd><a href="byte-stream-format-registry.html"><cite>Media Source Extensions™ Byte Stream Format Registry</cite></a>. Matthew Wolenetz; Jerry Smith; Aaron Colwell.  W3C. URL: <a href="byte-stream-format-registry.html">byte-stream-format-registry.html</a></dd><dt id="bib-rfc2119">[RFC2119]</dt><dd><a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a></dd><dt id="bib-rfc8174">[RFC8174]</dt><dd><a href="https://tools.ietf.org/html/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc8174">https://tools.ietf.org/html/rfc8174</a></dd><dt id="bib-webidl">[WEBIDL]</dt><dd><a href="https://heycam.github.io/webidl/"><cite>Web IDL</cite></a>. Boris Zbarsky.  W3C. 15 December 2016. W3C Editor's Draft. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a></dd>
      </dl></section><section id="informative-references">
        <h3 id="b-2-informative-references"><bdi class="secno">B.2 </bdi>Informative references<a class="self-link" aria-label="§" href="#informative-references"></a></h3>
      <dl class="bibliography">
        <dt id="bib-inbandtracks">[INBANDTRACKS]</dt><dd><a href="https://dev.w3.org/html5/html-sourcing-inband-tracks/"><cite>Sourcing In-band Media Resource Tracks from Media Containers into HTML</cite></a>. Bob Lund; Silvia Pfeiffer.  W3C. URL: <a href="https://dev.w3.org/html5/html-sourcing-inband-tracks/">https://dev.w3.org/html5/html-sourcing-inband-tracks/</a></dd><dt id="bib-media-playback-quality">[MEDIA-PLAYBACK-QUALITY]</dt><dd><a href="https://wicg.github.io/media-playback-quality/"><cite>Media Playback Quality</cite></a>. Mounir Lamouri.  W3C. URL: <a href="https://wicg.github.io/media-playback-quality/">https://wicg.github.io/media-playback-quality/</a></dd>
      </dl></section></section><p role="navigation" id="back-to-top"><a href="#title"><abbr title="Back to Top">↑</abbr></a></p><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script></body></html>